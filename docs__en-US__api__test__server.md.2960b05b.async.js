"use strict";(self.webpackChunknocobase_docs=self.webpackChunknocobase_docs||[]).push([[44411],{931060:function(i,d,s){s.r(d);var l=s(572269),u=s(793359),h=s(861788),v=s(719977),I=s(20190),n=s(24268),t=s(496057),_=s(585939),j=s(28484),p=s(635206),m=s(375553),f=s(156266),E=s(572333),g=s(841118),b=s(39297),D=s(868526),k=s(605019),r=s(614651),c=s(280936),o=s(667294),a=s(320589),e=s(785893);function x(){return(0,e.jsx)(r.dY,{children:(0,e.jsx)(o.Suspense,{fallback:(0,e.jsx)(c.Z,{}),children:(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)("div",{className:"markdown",children:[(0,e.jsxs)("h1",{id:"server",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#server",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"Server"]}),(0,e.jsxs)("h2",{id:"overview",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#overview",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"Overview"]}),(0,e.jsxs)("p",{children:[a.texts[0].value,(0,e.jsx)("a",{href:"https://vitest.dev/",children:a.texts[1].value}),a.texts[2].value,(0,e.jsx)("code",{children:a.texts[3].value}),a.texts[4].value]}),(0,e.jsxs)("h3",{id:"basic-usage",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#basic-usage",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"Basic Usage"]}),(0,e.jsx)(n.Z,{lang:"ts",children:a.texts[5].value}),(0,e.jsxs)("h2",{id:"api",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#api",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"API"]}),(0,e.jsxs)("h3",{id:"defineconfig",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#defineconfig",children:(0,e.jsx)("span",{className:"icon icon-link"})}),(0,e.jsx)("code",{children:a.texts[6].value})]}),(0,e.jsx)("p",{children:a.texts[7].value}),(0,e.jsx)(n.Z,{lang:"ts",children:a.texts[8].value}),(0,e.jsxs)("h3",{id:"mockdatabase",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#mockdatabase",children:(0,e.jsx)("span",{className:"icon icon-link"})}),(0,e.jsx)("code",{children:a.texts[9].value})]}),(0,e.jsxs)("p",{children:[a.texts[10].value,(0,e.jsx)("code",{children:a.texts[11].value}),a.texts[12].value]}),(0,e.jsxs)("h4",{id:"signature",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#signature",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"Signature"]}),(0,e.jsx)("ul",{children:(0,e.jsx)("li",{children:(0,e.jsx)("code",{children:a.texts[13].value})})}),(0,e.jsxs)("h4",{id:"details",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#details",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"Details"]}),(0,e.jsxs)(t.Z,{children:[(0,e.jsx)("thead",{children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{children:a.texts[14].value}),(0,e.jsx)("th",{children:a.texts[15].value}),(0,e.jsx)("th",{children:a.texts[16].value})]})}),(0,e.jsx)("tbody",{children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{children:(0,e.jsx)("code",{children:a.texts[17].value})}),(0,e.jsx)("td",{children:(0,e.jsx)("code",{children:a.texts[18].value})}),(0,e.jsxs)("td",{children:[a.texts[19].value,(0,e.jsx)(r.rU,{to:"/api/database",children:a.texts[20].value})]})]})})]}),(0,e.jsxs)("h3",{id:"mockserver",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#mockserver",children:(0,e.jsx)("span",{className:"icon icon-link"})}),(0,e.jsx)("code",{children:a.texts[21].value})]}),(0,e.jsxs)("p",{children:[a.texts[22].value,(0,e.jsx)("code",{children:a.texts[23].value}),a.texts[24].value]}),(0,e.jsxs)("h4",{id:"signature-1",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#signature-1",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"Signature"]}),(0,e.jsx)("ul",{children:(0,e.jsx)("li",{children:(0,e.jsx)("code",{children:a.texts[25].value})})}),(0,e.jsxs)("h4",{id:"details-1",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#details-1",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"Details"]}),(0,e.jsxs)(t.Z,{children:[(0,e.jsx)("thead",{children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{children:a.texts[26].value}),(0,e.jsx)("th",{children:a.texts[27].value}),(0,e.jsx)("th",{children:a.texts[28].value})]})}),(0,e.jsx)("tbody",{children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{children:(0,e.jsx)("code",{children:a.texts[29].value})}),(0,e.jsx)("td",{children:(0,e.jsx)("code",{children:a.texts[30].value})}),(0,e.jsxs)("td",{children:[a.texts[31].value,(0,e.jsx)(r.rU,{to:"/api/server/application",children:a.texts[32].value})]})]})})]}),(0,e.jsxs)("h3",{id:"createmockserver",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#createmockserver",children:(0,e.jsx)("span",{className:"icon icon-link"})}),(0,e.jsx)("code",{children:a.texts[33].value})]}),(0,e.jsxs)("p",{children:[a.texts[34].value,(0,e.jsx)("code",{children:a.texts[35].value}),a.texts[36].value]}),(0,e.jsxs)("h4",{id:"signature-2",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#signature-2",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"Signature"]}),(0,e.jsx)(n.Z,{lang:"ts",children:a.texts[37].value}),(0,e.jsxs)("h4",{id:"details-2",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#details-2",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"Details"]}),(0,e.jsxs)(t.Z,{children:[(0,e.jsx)("thead",{children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{children:a.texts[38].value}),(0,e.jsx)("th",{children:a.texts[39].value}),(0,e.jsx)("th",{children:a.texts[40].value})]})}),(0,e.jsxs)("tbody",{children:[(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{children:(0,e.jsx)("code",{children:a.texts[41].value})}),(0,e.jsx)("td",{children:(0,e.jsx)("code",{children:a.texts[42].value})}),(0,e.jsxs)("td",{children:[a.texts[43].value,(0,e.jsx)(r.rU,{to:"/api/server/application",children:a.texts[44].value})]})]}),(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{children:(0,e.jsx)("code",{children:a.texts[45].value})}),(0,e.jsx)("td",{children:(0,e.jsx)("code",{children:a.texts[46].value})}),(0,e.jsx)("td",{children:a.texts[47].value})]}),(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{children:(0,e.jsx)("code",{children:a.texts[48].value})}),(0,e.jsx)("td",{children:(0,e.jsx)("code",{children:a.texts[49].value})}),(0,e.jsx)("td",{children:a.texts[50].value})]}),(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{children:(0,e.jsx)("code",{children:a.texts[51].value})}),(0,e.jsx)("td",{children:(0,e.jsx)("code",{children:a.texts[52].value})}),(0,e.jsx)("td",{children:a.texts[53].value})]}),(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{children:(0,e.jsx)("code",{children:a.texts[54].value})}),(0,e.jsx)("td",{children:(0,e.jsx)("code",{children:a.texts[55].value})}),(0,e.jsx)("td",{children:a.texts[56].value})]})]})]}),(0,e.jsxs)("h3",{id:"mockserver-1",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#mockserver-1",children:(0,e.jsx)("span",{className:"icon icon-link"})}),(0,e.jsx)("code",{children:a.texts[57].value})]}),(0,e.jsxs)("p",{children:[(0,e.jsx)("code",{children:a.texts[58].value}),a.texts[59].value,(0,e.jsx)("code",{children:a.texts[60].value}),a.texts[61].value]}),(0,e.jsxs)("h4",{id:"class-methods",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#class-methods",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"Class Methods"]}),(0,e.jsxs)("h5",{id:"loadandinstall",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#loadandinstall",children:(0,e.jsx)("span",{className:"icon icon-link"})}),(0,e.jsx)("code",{children:a.texts[62].value})]}),(0,e.jsx)("p",{children:a.texts[63].value}),(0,e.jsxs)("h5",{id:"cleandb",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#cleandb",children:(0,e.jsx)("span",{className:"icon icon-link"})}),(0,e.jsx)("code",{children:a.texts[64].value})]}),(0,e.jsx)("p",{children:a.texts[65].value}),(0,e.jsxs)("h5",{id:"quickstart",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#quickstart",children:(0,e.jsx)("span",{className:"icon icon-link"})}),(0,e.jsx)("code",{children:a.texts[66].value})]}),(0,e.jsxs)("p",{children:[a.texts[67].value,(0,e.jsx)("code",{children:a.texts[68].value}),a.texts[69].value]}),(0,e.jsxs)("h5",{id:"destroy",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#destroy",children:(0,e.jsx)("span",{className:"icon icon-link"})}),(0,e.jsx)("code",{children:a.texts[70].value})]}),(0,e.jsx)("p",{children:a.texts[71].value}),(0,e.jsxs)("h5",{id:"agent",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#agent",children:(0,e.jsx)("span",{className:"icon icon-link"})}),(0,e.jsx)("code",{children:a.texts[72].value})]}),(0,e.jsx)("p",{children:a.texts[73].value}),(0,e.jsx)("p",{children:(0,e.jsx)("strong",{children:a.texts[74].value})}),(0,e.jsx)("ul",{children:(0,e.jsx)("li",{children:(0,e.jsx)("code",{children:a.texts[75].value})})}),(0,e.jsx)("p",{children:(0,e.jsx)("strong",{children:a.texts[76].value})}),(0,e.jsx)(n.Z,{lang:"ts",children:a.texts[77].value}),(0,e.jsx)("p",{children:(0,e.jsx)("strong",{children:a.texts[78].value})}),(0,e.jsx)("ul",{children:(0,e.jsx)("li",{children:(0,e.jsx)("code",{children:a.texts[79].value})})}),(0,e.jsxs)("p",{children:[a.texts[80].value,(0,e.jsx)("a",{href:"https://github.com/ladjs/superagent",children:a.texts[81].value}),a.texts[82].value]}),(0,e.jsx)("ul",{children:(0,e.jsx)("li",{children:(0,e.jsx)("code",{children:a.texts[83].value})})}),(0,e.jsx)("p",{children:a.texts[84].value}),(0,e.jsx)("ul",{children:(0,e.jsx)("li",{children:(0,e.jsx)("code",{children:a.texts[85].value})})}),(0,e.jsx)("p",{children:a.texts[86].value}),(0,e.jsx)("ul",{children:(0,e.jsx)("li",{children:(0,e.jsx)("code",{children:a.texts[87].value})})}),(0,e.jsx)("p",{children:a.texts[88].value}),(0,e.jsxs)(t.Z,{children:[(0,e.jsx)("thead",{children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{children:a.texts[89].value}),(0,e.jsx)("th",{children:a.texts[90].value}),(0,e.jsx)("th",{children:a.texts[91].value})]})}),(0,e.jsxs)("tbody",{children:[(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{children:(0,e.jsx)("code",{children:a.texts[92].value})}),(0,e.jsx)("td",{children:(0,e.jsx)("code",{children:a.texts[93].value})}),(0,e.jsxs)("td",{children:[a.texts[94].value,(0,e.jsx)("code",{children:a.texts[95].value}),a.texts[96].value,(0,e.jsx)("br",{}),a.texts[97].value,(0,e.jsx)("code",{children:a.texts[98].value})]})]}),(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{children:(0,e.jsx)("code",{children:a.texts[99].value})}),(0,e.jsx)("td",{children:(0,e.jsx)("code",{children:a.texts[100].value})}),(0,e.jsxs)("td",{children:[a.texts[101].value,(0,e.jsx)("code",{children:a.texts[102].value}),a.texts[103].value,(0,e.jsx)("code",{children:a.texts[104].value}),a.texts[105].value,(0,e.jsx)("code",{children:a.texts[106].value}),a.texts[107].value]})]})]})]}),(0,e.jsxs)("h3",{id:"sleep",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#sleep",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"sleep"]})]})})})})}d.default=x},320589:function(i,d,s){s.r(d),s.d(d,{texts:function(){return l}});const l=[{value:"NocoBase conducts server-side testing based on ",paraId:0,tocIndex:1},{value:"Vitest",paraId:0,tocIndex:1},{value:". ",paraId:0,tocIndex:1},{value:"@nocobase/test",paraId:0,tocIndex:1},{value:" provides convenient methods for server-side testing to mock services and databases.",paraId:0,tocIndex:1},{value:`describe('actions', () => {
  let app: MockServer;
  let db: Database;
  let agent: any;

  beforeAll(async () => {
    app = await createMockServer({
      plugins: ['acl', 'users', 'data-source-manager'],
    });
    db = app.db;
    agent = app.agent();
  });

  afterAll(async () => {
    await app.destroy();
  });
});
`,paraId:1,tocIndex:2},{value:"defineConfig()",paraId:2},{value:"Retrieve the Vitest configuration.",paraId:3,tocIndex:4},{value:`import { defineConfig } from '@nocobase/test/vitest.mjs';

const config = defineConfig();
`,paraId:4,tocIndex:4},{value:"mockDatabase()",paraId:2},{value:"Create a ",paraId:5,tocIndex:5},{value:"MockDataBase",paraId:5,tocIndex:5},{value:" instance for testing.",paraId:5,tocIndex:5},{value:"mockDatabase(options: IDatabaseOptions = {}): MockDatabase",paraId:6,tocIndex:6},{value:"Parameter",paraId:7,tocIndex:7},{value:"Type",paraId:7,tocIndex:7},{value:"Description",paraId:7,tocIndex:7},{value:"options",paraId:7,tocIndex:7},{value:"IDatabaseOptions",paraId:7,tocIndex:7},{value:"Refer to ",paraId:7,tocIndex:7},{value:"DataBase",paraId:8,tocIndex:7},{value:"mockServer()",paraId:2},{value:"Create a ",paraId:9,tocIndex:8},{value:"MockServer",paraId:9,tocIndex:8},{value:" instance.",paraId:9,tocIndex:8},{value:"mockServer(options?: ApplicationOptions): MockServer",paraId:10,tocIndex:9},{value:"Parameter",paraId:11,tocIndex:10},{value:"Type",paraId:11,tocIndex:10},{value:"Description",paraId:11,tocIndex:10},{value:"options",paraId:11,tocIndex:10},{value:"ApplicationOptions",paraId:11,tocIndex:10},{value:"Refer to ",paraId:11,tocIndex:10},{value:"Application",paraId:12,tocIndex:10},{value:"createMockServer()",paraId:2},{value:"Create a ",paraId:13,tocIndex:11},{value:"MockServer",paraId:13,tocIndex:11},{value:" instance, perform forced installation, and start it.",paraId:13,tocIndex:11},{value:`createMockServer(options?: ApplicationOptions & {
    version?: string;
    beforeInstall?: BeforeInstallFn;
    skipInstall?: boolean;
    skipStart?: boolean;
}): Promise<MockServer>
`,paraId:14,tocIndex:12},{value:"Parameter",paraId:15,tocIndex:13},{value:"Type",paraId:15,tocIndex:13},{value:"Description",paraId:15,tocIndex:13},{value:"options",paraId:15,tocIndex:13},{value:"ApplicationOptions",paraId:15,tocIndex:13},{value:"Refer to ",paraId:15,tocIndex:13},{value:"Application",paraId:16,tocIndex:13},{value:"options.version",paraId:15,tocIndex:13},{value:"string",paraId:15,tocIndex:13},{value:"Application version",paraId:15,tocIndex:13},{value:"options.beforeInstall",paraId:15,tocIndex:13},{value:"BeforeInstallFn",paraId:15,tocIndex:13},{value:"Function to execute before installation",paraId:15,tocIndex:13},{value:"options.skipInstall",paraId:15,tocIndex:13},{value:"boolean",paraId:15,tocIndex:13},{value:"Whether to skip forced installation",paraId:15,tocIndex:13},{value:"options.skipStart",paraId:15,tocIndex:13},{value:"boolean",paraId:15,tocIndex:13},{value:"Whether to skip application startup",paraId:15,tocIndex:13},{value:"MockServer",paraId:2},{value:"MockServer",paraId:17,tocIndex:14},{value:" inherits from ",paraId:17,tocIndex:14},{value:"Application",paraId:17,tocIndex:14},{value:" and is a class for server-side testing applications.",paraId:17,tocIndex:14},{value:"loadAndInstall()",paraId:2},{value:"Load and install the application.",paraId:18,tocIndex:16},{value:"cleanDb()",paraId:2},{value:"Clear the database.",paraId:19,tocIndex:17},{value:"quickstart()",paraId:2},{value:"Execute ",paraId:20,tocIndex:18},{value:"nocobase start --quickstart",paraId:20,tocIndex:18},{value:".",paraId:20,tocIndex:18},{value:"destroy()",paraId:2},{value:"Destroy the application.",paraId:21,tocIndex:19},{value:"agent()",paraId:2},{value:"Initiate API requests in test cases.",paraId:22,tocIndex:20},{value:"Signature",paraId:23,tocIndex:20},{value:"agent(): ExtendedAgent",paraId:24,tocIndex:20},{value:"Type",paraId:25,tocIndex:20},{value:`interface ExtendedAgent extends SuperAgentTest {
  login: (user: any) => ExtendedAgent;
  loginUsingId: (userId: number) => ExtendedAgent;
  resource: (name: string, resourceOf?: any) => Resource;
}
`,paraId:26,tocIndex:20},{value:"Details",paraId:27,tocIndex:20},{value:"SuperAgentTest",paraId:28,tocIndex:20},{value:"Refer to ",paraId:29,tocIndex:20},{value:"superagent",paraId:29,tocIndex:20},{value:".",paraId:29,tocIndex:20},{value:"login()",paraId:30,tocIndex:20},{value:"Log in with a user model.",paraId:31,tocIndex:20},{value:"loginUsingId()",paraId:32,tocIndex:20},{value:"Log in with a user ID.",paraId:33,tocIndex:20},{value:"resource()",paraId:34,tocIndex:20},{value:"Retrieve a resource.",paraId:35,tocIndex:20},{value:"Parameter",paraId:36,tocIndex:20},{value:"Type",paraId:36,tocIndex:20},{value:"Description",paraId:36,tocIndex:20},{value:"name",paraId:36,tocIndex:20},{value:"string",paraId:36,tocIndex:20},{value:"1. Resource name, e.g., ",paraId:36,tocIndex:20},{value:"a",paraId:36,tocIndex:20},{value:" ",paraId:36,tocIndex:20},{value:" 2. Associated object name of the resource, e.g., ",paraId:36,tocIndex:20},{value:"a.b",paraId:36,tocIndex:20},{value:"resourceOf",paraId:36,tocIndex:20},{value:"any",paraId:36,tocIndex:20},{value:"Primary key value of the resource when ",paraId:36,tocIndex:20},{value:"resource",paraId:36,tocIndex:20},{value:" is the associated object name of the resource. For example, when ",paraId:36,tocIndex:20},{value:"a.b",paraId:36,tocIndex:20},{value:" is specified, it represents the primary key value of ",paraId:36,tocIndex:20},{value:"a",paraId:36,tocIndex:20},{value:".",paraId:36,tocIndex:20}]}}]);
