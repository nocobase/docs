# 审批节点

在审批工作流中，需要使用专用的“审批”节点为审批人配置用于处理（通过、拒绝或退回）发起的审批的操作逻辑，“审批”节点也仅可在审批流程中使用。

:::info{title=提示}
与普通的“人工处理”节点的区别：普通的“人工处理”节点针对的场景更加泛化，可以用于更多类型的工作流的人工输入数据、人工决策流程是否继续等场景。“审批节点”是特化的专用于审批流程的处理节点，不能在其他工作流中使用。
:::

## 创建节点

点击流程中的加号（“+”）按钮，添加“审批”节点，再选择其中一种通过模式，创建审批节点：

![审批节点_创建](https://static-docs.nocobase.com/f15d61208a3918d005cd2031fc9b6ce7.png)

## 通过模式

通过模式有两种：

1.  直通模式：通常用于较为简单的流程，审批节点通过与否只决定流程是否结束，未通过的情况下直接退出流程。

    ![审批节点_通过模式_直通模式](https://static-docs.nocobase.com/a9d446a186f61c546607cf1c2534b287.png)

2.  分支模式：通常用于更复杂的数据逻辑，审批节点产生任何结果后，可在其结果分支内继续执行其他节点。

    ![审批节点_通过模式_分支模式](https://static-docs.nocobase.com/57dc6a8907f3bb02fb28c354c241e4e5.png)

    其中如果节点配置了“退回”操作，才会产生“退回”分支，且退回分支执行完以后会强制退出当前流程。

    该节点被“通过”后，除执行通过分支，也会继续执行后续流程。“拒绝”操作后默认也可以继续执行后续流程，也可以在节点中配置执行分支后结束流程。

:::info{title=提示}
通过模式在节点创建后不可修改。
:::

## 审批人

审批人是负责该节点审批行为的用户集合，可以是一个或多个用户，选择的来源可以是从用户列表选择的静态值，也可以是由变量指定的动态值。

![审批节点_审批人](https://static-docs.nocobase.com/29c64297d577b9ca9457b1d7ac62287d.png)

选择变量时，仅可选择上下文和节点结果中用户数据的主键或外键。如果选择的变量在执行中是数组（对多关系），那么数组中的每个用户都会合并到整个审批人集合中。

## 协商模式

如果审批人在最终执行时只有一个（包含多个变量去重后的情况），那么无论选择何种协商模式，都只由该用户执行审批操作，结果也仅由该用户决定。

当审批人集合中有多个用户时，选择不同协商模式代表不同的处理方式：

1. 或签：只需其中一人通过即代表节点通过，所有人都拒绝才代表节点拒绝。
2. 会签：需要所有人通过才代表节点通过，只需其中一人拒绝即代表节点拒绝。
3. 投票：需要超过设定比例的人数通过才代表节点通过，否则代表节点拒绝。

针对退回操作，在任何模式下，如果审批人集合中有用户处理为退回，那么节点会直接退出流程。

## 处理顺序

同样的，在审批人集合中有多个用户时，选择不同的处理顺序代表不同的处理方式：

1. 并行：所有审批人可以以任意顺序处理，先后处理无关。
2. 顺序：审批人按照审批人集合中的顺序依次处理，审批人中的上一个提交后，下一个才能处理。

无论是否设置为“顺序”处理，根据实际处理的先后顺序产生的结果也遵循上述“协商模式”中的规则，达到对应条件后该节点即完成执行。

## 拒绝分支结束后退出工作流

“通过模式”设置为“分支模式”时，可以选择在拒绝分支结束后退出工作流。勾选以后，拒绝分支的末尾会显示一个“✗”，表示该分支结束后不再继续后续节点：

![审批节点_拒绝后退出](https://static-docs.nocobase.com/1e740df93c128fb6fe54bf85a740e683.png)

## 审批人界面配置

审批人界面配置用于提供审批人对审批工作流执行到该节点时的操作界面，点击配置按钮打开弹窗：

![审批节点_界面配置_弹窗](https://static-docs.nocobase.com/2c321ae164b436f1c572305ff27cc9dd.png)

在配置弹窗中可以添加提交审批的详情、操作栏和自定义提示文字等区块：

![审批节点_界面配置_添加区块](https://static-docs.nocobase.com/9f8f11926e935ad8f8fbeec368edebfe.png)

### 详情区块

其中审批内容详情区块即发起人提交的数据区块，与普通的数据区块类似，可以任意添加数据表的字段组件，并且可以任意排列，以组织审批人需要查看的内容：

![审批节点_界面配置_详情区块](https://static-docs.nocobase.com/1140ec13caeea1b364d12e057720a29c.png)

### 表单区块

操作表单区块中可以添加该节点支持的操作按钮，包括“通过”、“否决”、“退回”、“转签”和“加签”：

![审批节点_界面配置_操作表单区块](https://static-docs.nocobase.com/20241226232013.png)

<!-- 
另外，操作表单中也可以添加可由审批人修改的字段。这些字段在审批人处理审批时会显示在操作表单中，审批人可以修改这些字段的值，提交后会同时更新用于审批的数据，以及审批流程中对应数据的快照。

![审批节点_界面配置_操作表单_修改审批内容字段](https://static-docs.nocobase.com/20241226232124.png)
-->

### “通过”、“否决”和“退回”

审批操作按钮中，“通过”、“否决”和“退回”是决定性操作，提交后则对应审批人在该节点的处理完成，提交时需要填写的额外字段可以在操作按钮的“处理配置”弹窗中添加，如“评论”等。

![审批节点_界面配置_操作表单_处理配置](https://static-docs.nocobase.com/20241226232225.png)

### “转签”和“加签”

“转签”和“加签”是非决定性操作，用于动态调整审批流程中的审批人，“转签”是将当前用户的审批任务交给另一个用户代为处理，“加签”是在当前审批人之前或之后增加一个审批人，由新增的审批人一同继续审批。

启用“转签”或“加签”操作按钮后，需要在按钮的配置菜单中选择“指派人员范围”，对可指派新审批人的范围进行设置：

![审批节点_界面配置_操作表单_指派人员范围](https://static-docs.nocobase.com/20241226232321.png)

与节点原始的审批人配置一样，指派人员范围也可以是直接选择的审批人，或者基于用户表的查询条件，最终会合并成一个集合，且不包含已经在审批人集合中的用户。

:::warning{title=重要}
如果开启或关闭了某个操作按钮，或者修改了指派人员范围，需要在关闭操作界面配置的弹窗后保存该节点的配置，否则该操作按钮的变动不会生效。
:::
