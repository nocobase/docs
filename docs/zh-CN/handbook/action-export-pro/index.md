# 导出 Pro

<PluginInfo commercial="true" name="action-export-pro"></PluginInfo>

## 介绍

导出 Pro 插件在普通导出功能的基础上提供了增强功能。

## 安装

此插件依赖异步任务管理插件，使用前需先开启异步任务管理插件。

## 功能增强

- 支持异步导出操作，独立线程执行，支持大量数据导出。
- 支持附件导出。

## 使用手册

### 导出模式配置

![index-2025-01-13-20-58-39](https://static-docs.nocobase.com/index-2025-01-13-20-58-39.png)

在导出按钮上，可以配置导出模式，可选的三种导出模式：

- 自动：根据导出时的数据量判断导出的模式，如果数据量小于 1000 条 （附件导出时为 100 条），则使用同步导出，如果数据量大于 1000 条（附件导出时为 100 条），则使用异步导出。
- 同步：使用同步导出，导出时会将会在主线程中运行，适合小规模数据，若在同步模式下执行大规模的数据导出，可能会导致系统阻塞、卡顿且无法处理其他用户的请求。
- 异步：使用异步导出，导出时将会在独立的后台线程中执行，不会阻塞当前系统的使用。

### 异步导出

在执行导出之后，导出的流程将在独立的后台线程中执行，无需用户手动配置。在用户界面中，执行导出操作后，右上方会显示当前正在执行的导出任务，并且实时展示任务进度。

![index-2024-12-30-09-35-34](https://static-docs.nocobase.com/index-2024-12-30-09-35-34.png)

导出结束后，可在导出任务中下载导出文件。

#### 并发导出
并发导出任务较多时，会受服务器配置的影响，从而导致系统响应变慢，所以推荐系统开发者配置最大任务导出并发数（默认为 3），当超过配置的并发数时，进入排队状态。
![20250505171706](https://nocobase-docs.oss-cn-beijing.aliyuncs.com/20250505171706.png)

并发数配置方式：环境变量，如：ASYNC_TASK_MAX_CONCURRENCY=4，[如何配置环境变量？](../../welcome/getting-started/env)

在不同配置与数据复杂度综合测试下，推荐并发数：
- 2核 CPU，并发数 3。
- 4核 CPU，并发数 5。

#### 关于性能 
当您发现导出过程异常缓慢时，可能是数据表结构导致的性能问题。为确保高效导出，您的数据表须满足以下条件：

| 条件类型 | 必要条件 | 其他说明 |
|---------|------------------------|------|
| 表结构（至少满足一项） | 有主键<br>有唯一约束<br>有索引（唯一、普通、联合） | 优先级：主键 > 唯一约束 > 索引
| 字段特性 | 主键/唯一约束/索引（其中之一）必须具有可排序特性，如：自增ID、雪花ID、UUID v1、时间戳、数字等<br>（注意：UUID v3/v4/v5、普通字符串等不可排序字段会影响性能） | 无 |

如果均满足以上条件，仍出现导出缓慢，**尽可能收缩不必要的字段，尤其是关系字段**。
![20250506003557](https://nocobase-docs.oss-cn-beijing.aliyuncs.com/20250506003557.png)
可进行日志分析，或反馈至官方。
![20250505182122](https://nocobase-docs.oss-cn-beijing.aliyuncs.com/20250505182122.png)

### 附件导出

附件导出支持将附件相关的字段导出为压缩包格式。

#### 附件导出配置

![index-2024-12-30-09-37-09](https://static-docs.nocobase.com/index-2024-12-30-09-37-09.png)

- 配置要导出的附件字段，支持多选。
- 可以选择是否为每条记录生成一个文件夹。

文件的命名规则：

- 如果选择为每条记录生成一个文件夹，则文件的命名规则为： `{记录的标题字段值}/{附件字段名}[-{文件序号}].{文件后缀名}`。
- 如果选择不生成文件夹，则文件的命名规则为： `{记录的标题字段值}-{附件字段名}[-{文件序号}].{文件后缀名}`。

文件序号在附件字段中存在多个附件时，会自动生成.
