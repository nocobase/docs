# 表单事件

表单提交事件针对 UI 界面中新增和更新数据的表单操作按钮，在表单中点击对应已绑定工作流的按钮后，将触发对应绑定的工作流执行。例如对某个活动发起报名的表单，报名（表单提交）成功后触发相应的流程处理。

## 基本使用

针对“提交”按钮（含“保存数据”按钮）配置的工作流，将在用户提交对应表单且数据操作完成后被触发。

<figure>
  <img alt="表单事件_提交按钮" src="https://github.com/nocobase/nocobase/assets/525658/d321f964-859f-4d72-86a6-57301fb471fc" width="510">
</figure>

针对自定义的“提交至工作流”按钮配置的工作流，将在用户点击对应按钮时，直接将已配置的表单数据提交到对应工作流进行处理。

<figure>
  <img alt="表单事件_提交至工作流按钮" src="https://github.com/nocobase/nocobase/assets/525658/2b4a37bc-ca5c-4bea-b864-1b59bc17df32" width="504">
</figure>

从按钮配置的菜单中选择“绑定工作流”，即可打开绑定配置弹窗。弹窗中可以配置任意多个要触发的工作流，如果一个都不配置，则代表无需触发。针对每一个工作流，需要先限定触发的数据是整个表单的数据还是表单中的某个关系字段的数据，之后再根据所选的数据模型对应的数据表，选择已配置了匹配该表模型的表单工作流。

<figure>
  <img alt="表单事件_绑定工作流配置_上下文选择" src="https://github.com/nocobase/nocobase/assets/525658/d0e410c9-ab98-43f7-8431-1fe4c8731f01" width="589">
</figure>

<figure>
  <img alt="表单事件_绑定工作流配置_工作流选择" src="https://github.com/nocobase/nocobase/assets/525658/ceb114ba-5aa7-4f00-971c-6426e5bd2390" width="581">
</figure>

## 相关提示

### 与数据表事件的区别

表单提交事件与数据表事件不同的地方在于，表单事件只在配置了绑定工作流的按钮点击后才触发，而如果针对一个数据表有多个不同的新增或更新表单（如针对不同角色的不同界面上），未配置绑定工作流按钮的表单提交时，不会触发。而如果配置了针对数据表事件的工作流，则在任意对应表单提交后，都会触发该工作流。

### “提交至工作流”按钮的区别

而且针对“提交至工作流”的自定义按钮点击时，提交的数据不会被直接保存到数据表中，而是交给对应的工作流作为上下文数据，由已定义的流程进行特定的处理。上下文中除了表单数据，还会包含提交表单的“当前用户”对象，可以在后续流程中使用。后续处理过程中可以根据提交数据的条件，选择保存到对应数据表，也可以不保存。这种直接交给工作流的表单提交事件，在一定程度上，可以配置为提交申请和审批场景中的流程。

<!-- “提交至工作流”的表单数据还有一点区别，由于提交的数据不会先保存在数据库中，所以如果要用到部分关系字段的数据，必须在表单中配置好关系字段，且保证提交的数据中已经包含对应字段的值，然后也需要在工作流配置中勾选相应的关系字段，否则在节点中将无法获取到关系字段的数据。 -->

## 示例

普通的“提交”触发与数据表事件类似，这里主要针对“提交至工作流”的方式进行演示。

假设一个“报销申请”的场景，我们需要在员工提交费用报销后，进行额度的自动审核和超出额度的人工审核，审核成功的才通过申请，并在之后交由财务处理。

首先，我们可以先创建一张“费用报销”数据表，有以下字段：

- 项目名称：单行文本
- 申请人：多对一（用户）
- 金额：数字
- 状态：单选（“审核通过”、“处理完成”）

之后先创建一个“表单事件”类型的工作流，并且把触发器中的数据表模型配置为“费用报销”表：

<figure>
  <img alt="配置表单事件工作流的数据模型" src="https://github.com/nocobase/nocobase/assets/525658/e8665221-b7d3-40a0-ab6e-de7a77cb47d0" width="478">
</figure>

将工作流设置为启用状态后，流程的具体处理节点稍后再回来配置。

然后我们在界面上创建“费用报销”数据表的表格区块，并且在工具栏增加一个“添加”按钮，配置对应的表单字段。这里我们不使用默认的“提交”按钮，而是移除后重新添加一个“提交至工作流”的按钮：

<figure>
  <img alt="配置提交表单" src="https://github.com/nocobase/nocobase/assets/525658/c339aaa5-d116-4f05-b911-241a4e414ea2" width="510">
</figure>

并打开按钮的“绑定工作流”配置对话框，选择整个表单数据作为上下文，以及工作流为我们之前创建的工作流：

<figure>
  <img alt="配置绑定工作流" src="https://github.com/nocobase/nocobase/assets/525658/d0e410c9-ab98-43f7-8431-1fe4c8731f01" width="589">
</figure>

表单配置完成后，再回到工作流的逻辑编排。比如我们需要金额大于 500 元时要求管理员进行人工审核，否则直接通过，审核通过后才创建报销记录，并由财务进一步处理（略）。

<figure>
  <img alt="配置绑定工作流" src="https://github.com/nocobase/nocobase/assets/525658/d68c9275-203d-4794-b503-0adc22f7ab37" width="597">
</figure>

忽略后续财务的处理的话，这样就完成了申请报销流程的配置，当员工填写报销申请并提交后，会触发对应的工作流，如果费用金额小于 500，会自动创建记录并等待财务进一步处理，否则会由主管审核，审核通过后也是一样创建记录并交给财务处理。

该示例的流程也可以配置在普通“提交”按钮上，可以根据具体的业务场景决定是否需要先创建记录再执行后续的流程。
