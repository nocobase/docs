# 設定パネル

グラフの設定パネルは、全体で3つの部分に分かれています：データ設定、グラフ設定、グラフプレビュー。

<img src="https://static-docs.nocobase.com/202404192019222.png"/>

## データ設定

<img src="https://static-docs.nocobase.com/202404192020544.png"/>

- 上部のドロップダウンボックスは、現在設定中のデータテーブル（コレクション）を示しており、ドロップダウンメニューから切り替えることができます。
- 設定が完了したら、「クエリを実行」をクリックすることで、設定に基づいてデータを取得できます。「データ」パネルにデータが表示されます。

### メジャー（Measures）

<img src="https://static-docs.nocobase.com/202404192023854.png"/>

メジャーフィールドは、通常、グラフが表示する核心データです。メジャーデータは集計関数を使用して統計を行うことができ、一般的なデータベースの統計関数 `合計（Sum）`、`カウント（Count）`、`平均（Avg）`、`最大（Max）`、`最小（Min）` をサポートしています。メジャーフィールドは複数設定可能で、エイリアスを設定できます。

### ディメンション（Dimensions）

<img src="https://static-docs.nocobase.com/202404192025717.png"/>

ディメンションフィールドは、通常、グラフデータのグループ化の基準となります。日付型フィールドに対しては、図に示されたフォーマット方法をサポートしており、フォーマットはデータベース関数によって実現されます（例：MySQLの `date_format`）。他のデータ型のフォーマットについては[データ変換](#データ変換)の部分を参照してください。

:::info
**ディメンションフォーマット（Dimensions Format） VS データ変換（Transformation）**

- ディメンションフォーマットは、最終データを取得する前に発生し、データのグループ化はフォーマット後の値に基づいて行われます。通常、時間帯でデータをフィルタリングする際にこのニーズがあります。
- データ変換は、レスポンスデータに対してさらに処理を行い、可読性を高めて適切なデータを表示します。データ変換はフロントエンドで行われます。
:::

### フィルタ（Filter）

<img src="https://static-docs.nocobase.com/202404192029597.png"/>

フィルタ設定は、グループ化前のデータに対してフィルタリングを行います。変数を使用してグラフ設定に動的なフィルタ範囲を提供することができます：

- 現在のユーザー：現在ログインしているユーザーに関する情報です。
- 日付変数：現在の日付に基づいて動的に計算される日付範囲です。
- 現在のフィルター：現在のグラフブロックで設定されているカスタムフィルターの項目です。参考：[フィルターブロック](./filter.md)

### ソート (Sort) と制限 (Limit)

<img src="https://static-docs.nocobase.com/202404192034106.png"/>

デフォルトのデータセット件数上限は2000件です。

### キャッシュ

<img src="https://static-docs.nocobase.com/202404192035918.png"/>

キャッシュを有効にすると、グラフはキャッシュされたデータを表示します。データキャッシュの保持時間を設定できます。

## グラフ設定

### コンテナ設定

グラフを表示するコンテナコンポーネントに関連する属性を設定します。

- グラフタイトル
- グラフの境界線を表示するかどうか

<img src="https://static-docs.nocobase.com/202404192037644.png"/>

グラフタイトルの表示効果：

<img src="https://static-docs.nocobase.com/202404192048473.png"/>

グラフの境界線を表示した場合の効果：

<img src="https://static-docs.nocobase.com/202404192048223.png"/>

### グラフ設定

<img src="https://static-docs.nocobase.com/202404192050696.png"/>

- チャートタイプ - 表示するチャートの種類を選択します。NocoBaseはデフォルトのチャートライブラリとして <a href="https://g2plot.antv.antgroup.com/" target="_blank">Ant Design Charts</a> 2.x を使用しています。他のチャートライブラリやコンポーネントを拡張して使用したい場合は、[開発ガイド](../dev/index.md)を参照してください。
- 基本設定 - チャートを選択すると、それに応じた基本的な可視化設定が表示されます。例えば、x軸フィールド、y軸フィールド、カテゴリーフィールドなどです。フィールド設定は通常、ドロップダウンメニューから選択でき、選択肢にはコレクションの基本フィールドやフィールドエイリアスが含まれています。
- JSON設定 - 基本設定が要件を満たさない場合、チャートコンポーネントの関連文書を参照し、JSON設定を使用してチャートコンポーネントの他の属性を設定できます。JSON設定でJavaScript式を使用したい場合は、対応する式を`{{}}`で囲みます。例：

```json
{
  "label": {
    "type": "inner",
    "content": "{{ ({ percent }) => `${(percent * 100).toFixed(0)}%` }}"
  }
}
```

## データ変換

<img src="https://static-docs.nocobase.com/202404192109597.png"/>

データ変換を使用すると、APIレスポンスのデータをさらに処理できます。現在、変換処理がサポートされているデータタイプは `number`, `date`, `time`, `datetime` です。サポートされていないデータタイプのフィールドは、手動でこれらのタイプのいずれかを選択し、対応する変換方法を使用できます。

同じフィールドに複数の変換方法を適用することができ、プログラムは順に変換を実行します。前の変換方法の処理結果は次の変換方法に渡され、ドラッグ＆ドロップで変換の順序を調整できます。

:::warning
注意が必要なのは、一部の変換方法が元のデータタイプを変更する可能性があることです。複数の変換方法を適用する際は、各変換後のデータタイプに応じて適切な変換方法を選択する必要があります。例えば、精度とプレフィックスを組み合わせて数字を通貨表示に処理する場合、まず精度変換を適用し、その後プレフィックスを結合すべきです。プレフィックス結合処理後の数字は文字列に変換され、精度変換を適用できなくなります。
:::

現在サポートされている変換方法：

| タイプ                                  | メソッド       | 説明                                                                                                                           | 変換後のタイプ         |
| ------------------------------------- | ---------- | ------------------------------------------------------------------------------------------------------------------------------ | ------------------ |
| 数字 (`number`)                       | プレフィックス       |                                                                                                                                | `string`           |
|                                       | サフィックス       |                                                                                                                                | `string`           |
|                                       | 精度     | `1`, `1.0`, `1.00`, `1.000`                                                                                                    | `number`           |
|                                       | 区切り文字     | `100,000.00`, `100.000,00`, `100 000.00`                                                                                       | `string`           |
|                                       | パーセンテージ     |                                                                                                                                | `string`           |
|                                       | 科学的表記法 |                                                                                                                                | `number`           |
|                                       | 略語       | `1K`, `1M`, `1千`, `1億` など                                                                                                   | `string`           |
| 日時 (`datetime`, `date`, `time`) | フォーマット     | 予め定義されたフォーマットには `YYYY-MM-DD` などがあり、自由に入力することもできます。参考 <a href="https://day.js.org/docs/en/display/format" target="_blank">dayjs</a> | `string`           |
|                                       | プレフィックス       |                                                                                                                                | `string`           |
|                                       | サフィックス       |                                                                                                                                | `string`           |
| 文字列 (`string`)                     | タイプ変換   | 日時や数字に変換                                                                                                           | `Date` \| `number` |
|                                       | プレフィックス       |                                                                                                                                | `string`           |
|                                       | サフィックス       |                                                                                                                                | `string`           |

