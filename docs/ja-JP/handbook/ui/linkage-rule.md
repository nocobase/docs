# リンク規則

## イントロダクション

NocoBaseにおけるリンク規則は、フロントエンドのインターフェース要素のインタラクション動作を制御するためのメカニズムです。ユーザーは、異なる条件に基づいてインターフェース内のブロック、フィールド、操作の表示や動作ロジックを調整し、柔軟でローコードのインタラクション体験を実現できます。この機能は継続的に改善されています。

リンク規則を構成することで、以下のようなことが可能になります：

- 現在のユーザーの役割に応じて、特定のブロックを非表示にする/表示する。異なる役割ごとに表示されるデータ範囲を異なるブロックに分け、例えば管理者はすべての情報を表示し、一般ユーザーは基本情報のみを表示する。
- フォームで特定のオプションを選択した際に、他のフィールドの値を自動で入力したりリセットしたりする。
- フォームで特定のオプションを選択した際に、いくつかの入力項目を無効化する。
- 条件に基づいてフィールドの背景色、フォントサイズ、フォントの太さなどを設定し、特定の条件を満たした際にフィールドをハイライトする。
- 特定の条件下で操作ボタンの表示/非表示やクリック可能/不可能を制御する。

## 条件設定

![20250417214217](https://static-docs.nocobase.com/20250417214217.png)
### 左側の変数

条件の左側の変数は、リンク規則内で「判断対象」となるオブジェクトを定義するために使用されます。つまり、この変数の値を基に条件を判断し、リンク動作をトリガーするかどうかを決定します。

選択可能な変数には以下が含まれます：

- コンテキスト内のフィールド、例: `「現在のフォーム/xxx」`、`「現在のレコード/xxx」`、`「現在のポップアップレコード/xxx」` など
- システム全体の変数、例: `現在のユーザー`、`現在の役割` など。これらは、ユーザーの役職や権限情報に基づいて動的に制御する際に使用されます。
  > ✅ 左側の変数として選択できるものは、ブロックのコンテキストによって決まります。ビジネスニーズに応じて左側の変数を適切に使用することが重要です：
  >
  > - 「現在のユーザー」：現在のログインユーザー情報を表します。
  > - 「現在のフォーム」：フォームでリアルタイムに入力される値を表します。
  > - 「現在のレコード」：保存されたレコードの値、例えばテーブルの行の記録などを表します。

### 演算子

演算子は、条件判断のロジックを設定するために使用されます。つまり、左側の変数と右側の値をどのように比較するかを決定します。異なるタイプの左側変数には異なる演算子が対応しており、代表的なものは以下の通りです：

- **テキスト型**：`$includes`、`$eq`、`$ne`、`$empty`、`$notEmpty` など
- **数値型**：`$eq`、`$gt`、`$lt`、`$gte`、`$lte` など
- **ブール型**：`$isTruly`、`$isFalsy`
- **配列型**：`$match`、`$anyOf`、`$empty`、`$notEmpty` など

> ✅ システムは左側の変数のタイプに基づいて自動的に使用可能な演算子を推奨し、論理設定が正しいことを保証します。

### 右側の値

左側の変数と比較するために使用される、条件が成立するかどうかを判断する参照値です。

サポートされる内容は以下を含みます：

- 定数値：固定の数値、テキスト、日付などを入力する。
- コンテキスト変数：現在のフォームの他のフィールド、現在のレコードなど。
- システム変数：現在のユーザー、現在の時間、現在の役割など。

> ✅ システムは左側の変数のタイプに基づいて、右側の入力方法を自動的に適応します。例えば：
>
> - 左側が「選択フィールド」の場合、対応する選択肢の選択器が表示されます。
> - 左側が「日付フィールド」の場合、日付選択器が表示されます。
> - 左側が「テキストフィールド」の場合、テキスト入力ボックスが表示されます。

> 💡 右側の値（特に動的変数）を柔軟に使用することで、現在のユーザー、データ状態、コンテキストに基づくリンクロジックを構築し、より強力なインタラクション体験を実現できます。

## 規則の実行ロジック

### 条件のトリガー

規則内の条件が満たされると（必須ではない）、下記の属性変更操作が自動で実行されます。条件が設定されていない場合、規則は常に満たされていると見なされ、属性変更操作が自動で実行されます。

### 複数の規則

1つのフォームに対して複数のリンク規則を設定することができます。複数の規則条件が同時に満たされると、システムは規則の順番に従って結果を実行します。つまり、最後の結果が実行基準となります。

例：規則1でフィールドを「無効」に設定し、規則2でフィールドを「編集可能」に設定した場合、両方の条件が満たされるとフィールドは「編集可能」状態になります。

> 複数の規則の実行順序は非常に重要です。規則を設計する際には、優先順位や相互関係を明確にして、規則の衝突を避けるようにしてください。

## 規則の管理

各規則に対して以下の操作が可能です：

- カスタム命名：規則に理解しやすい名前を付け、管理および識別を容易にする。
- 並べ替え：規則の実行優先順位に基づいて順序を調整し、システムが正しい順序で規則を処理できるようにする。
- 削除：不要な規則を削除する。
- 有効化/無効化：規則を一時的に無効化し、削除せずに特定の条件下で一時的に規則を停止する。
- 規則のコピー：既存の規則をコピーして新しい規則を作成し、重複した設定を避ける。

## 変数について

フィールドの値設定および条件設定では、定数の使用だけでなく、変数の使用もサポートしています。変数リストは異なるブロックの位置によって異なり、変数を適切に選択して使用することで、ビジネスニーズに柔軟に対応できます。変数に関する詳細は[変数](/handbook/ui/variables)をご覧ください。

## ブロックリンク規則

> **注意**: この機能は**v1.7.0-beta.24バージョン以降でサポートされています**

ブロック連動ルールは、システム変数（例：現在のユーザー、役割）やコンテキスト変数（例：現在のポップアップレコード）に基づいて、ブロックの表示を動的に制御できます。例えば、管理者は完全な注文情報を表示できますが、カスタマーサービスの役割では特定の注文データのみ表示できます。ブロック連動ルールを使用すると、役割に応じて適切なブロックを構成し、そのブロック内で異なるフィールド、操作ボタン、およびデータ範囲を設定できます。ログインした役割がターゲット役割の場合、システムは対応するブロックを表示します。

👉 詳細については：[ブロック/ブロックリンク規則](/handbook/ui/blocks/block-settings/block-linkage-rule)を参照してください。

## フィールドリンク規則

フィールドリンク規則は、ユーザーの操作に基づいてフォームまたは詳細ブロック内のフィールドの状態を動的に調整します。主に以下の操作が可能です：

- フィールドの **表示/非表示**
- フィールドを **必須** に設定
- **値の設定**
- オプションフィールドの **オプション範囲** の設定
- 時間フィールドの **選択可能な時間範囲** の設定

👉 詳細については：[ブロック/フィールドリンク規則](/handbook/ui/blocks/block-settings/field-linkage-rule)を参照してください。

## 操作リンク規則

操作リンク規則は、現在のレコード値やシステム変数を使って操作の動作（表示/無効化など）を制御します。

👉 詳細については：[操作/リンク規則](/handbook/ui/actions/action-settings/linkage-rule)を参照してください。

## フィールドスタイルリンク規則

フィールドスタイルリンク規則は、条件に基づいてフィールドのスタイル属性を動的に設定することを可能にします。主に以下のスタイル属性を設定できます：

- `color`
- `background-color`
- `text-align`
- `font-size`
- `font-weight`
- `font-style`

フィールドの状態に基づいて重要な情報をハイライトしたり、異常を示したり、視覚的に誘導するために使用されます。

👉 詳細については：[フィールド/スタイル](/handbook/ui/fields/field-settings/style)を参照してください。
