# ブロック連動ルール

> **注意**: この機能はv1.7.0-beta.24バージョンからサポートされています。

## 概要

ブロック連動ルールは、ユーザーがブロックの表示と非表示を動的に制御できる機能です。特定の条件が満たされると、対応するブロックが自動的に非表示または表示されます。

![20250427140619](https://static-docs.nocobase.com/20250427140619.png)

![20250427144259](https://static-docs.nocobase.com/20250427144259.png)

> **注意**: ブロック連動ルールを実行する前に、ブロックの表示はまず **ACL権限の確認** を通過する必要があります。ユーザーが適切なアクセス権を持っている場合のみ、ブロック連動ルールのロジックが適用されます。言い換えれば、ブロック連動ルールは、ACLの表示権限の要件を満たした後にのみ有効になります。ブロック連動ルールがない場合、ブロックはデフォルトで表示されます。

### グローバル変数でブロックを制御

ブロック連動ルールは、グローバル変数を使ってブロックの表示内容を制御できます。例えば、異なる役割が同じ注文表の表示権限を持っていても、表示されるデータは個別にカスタマイズされ、差別化できます。異なる役割に応じて、ブロックの表示フィールドや操作ボタンを設定することにより、柔軟なデータ表示と操作権限の制御を実現できます。

#### カスタマーサービス役割

- **データ範囲**：出荷待ちの注文のみを表示し、支払い情報や割引顧客情報などの機密データを非表示にします。
- **操作可能なボタン**：
  - 注文詳細の表示
  - 返品/交換の処理
  - 返金リクエストの生成
- **表示可能なフィールド**：OrderNumber、OrderDate、OrderStatus、ShippingAddress（TotalAmount、Discount、Customersなどの機密フィールドは含まれません）。

  ![20250427141800](https://static-docs.nocobase.com/20250427141800.png)

#### 財務役割

- **データ範囲**：支払い済みまたは返金中の注文のみを表示し、商品詳細や顧客情報は表示しません。
- **操作可能なボタン**：
  - 返金の監査
  - 請求書の生成
- **表示可能なフィールド**：OrderNumber、OrderDate、OrderStatus、ShippingAddress、TotalAmount（Items、Customersなどの機密フィールドは含まれません）。

  ![20250427142420](https://static-docs.nocobase.com/20250427142420.png)

### コンテキスト変数でブロックを制御

ブロックはコンテキスト内の変数を使用して制御することもできます。例えば、「現在のレコード」、「現在のフォーム」、「現在のポップアップレコード」などのコンテキスト変数を使って、ブロックを動的に表示または非表示にすることができます。

例：注文の状態が「発送済み」の場合にのみ、「発送情報」ブロックを表示します。

![20250427143707](https://static-docs.nocobase.com/20250427143707.png)

![20250427143951](https://static-docs.nocobase.com/20250427143951.png)

### ブロック内のMarkdown

例：詳細ブロックにMarkdownを設定して、追跡情報を表示します。
![20250427150236](https://static-docs.nocobase.com/20250427150236.png)

![20250427150308](https://static-docs.nocobase.com/20250427150308.png)
Markdown情報は、注文の状態が「発送済み」の場合にのみ表示されます。
![20250427150341](https://static-docs.nocobase.com/20250427150341.png)

以下のように表示されます：
<video width="100%" height="440" controls>
  <source src="https://static-docs.nocobase.com/20250427150738.mp4" type="video/mp4">
</video>

連動ルールの詳細については、[連動ルール](/handbook/ui/linkage-rule)をご参照ください。
