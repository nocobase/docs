# 認証：企業微信

<PluginInfo commercial="true" name="wecom"></PluginInfo>

## 紹介

**企業微信**プラグインは、ユーザーが企業微信アカウントを使用してNocoBaseにログインすることをサポートします。

## プラグインの有効化

![](https://static-docs.nocobase.com/202406272056962.png)

## 企業微信自建アプリの作成と設定

企業微信管理バックエンドに進み、企業微信自建アプリを作成します。

![](https://static-docs.nocobase.com/202406272101321.png)

![](https://static-docs.nocobase.com/202406272102087.png)

アプリをクリックして詳細ページに進み、ページをスクロールダウンして「企業微信認証ログイン」をクリックします。

![](https://static-docs.nocobase.com/202406272104655.png)

認証コールバックドメインをNocoBaseアプリのドメインに設定します。

![](https://static-docs.nocobase.com/202406272105662.png)

アプリの詳細ページに戻り、「ウェブ認証及びJS-SDK」をクリックします。

![](https://static-docs.nocobase.com/202406272107063.png)

アプリのOAuth2.0ウェブ認証機能のコールバックドメインとして設定し、検証します。

![](https://static-docs.nocobase.com/202406272107899.png)

アプリの詳細ページで、「企業信頼IP」をクリックします。

![](https://static-docs.nocobase.com/202406272108834.png)

NocoBaseアプリのIPを設定します。

![](https://static-docs.nocobase.com/202406272109805.png)

## 企業微信管理バックエンドからシークレットキーを取得

企業微信管理バックエンド - 私の企業で、「企業ID」をコピーします。

![](https://static-docs.nocobase.com/202406272111637.png)

企業微信管理バックエンド - アプリ管理で、前のステップで作成したアプリの詳細ページに進み、AgentIdとSecretをコピーします。

![](https://static-docs.nocobase.com/202406272122322.png)

## NocoBaseに企業微信認証を追加

ユーザー認証プラグイン管理ページに進みます。

![](https://static-docs.nocobase.com/202406272115044.png)

追加 - 企業微信

![](https://static-docs.nocobase.com/202406272115805.png)

### 設定

![](https://static-docs.nocobase.com/202412041459250.png)

| 設定項目                                                                                                | 説明                                                                                                 | バージョン要件 |
| ----------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------- | -------- |
| 電話番号が既存のユーザーと一致しない場合、<br />新しいユーザーを自動的に作成するかどうか | 電話番号を使用して既存のユーザーと一致しない場合、新しいユーザーを自動的に作成するかどうか                                                   | -        |
| 企業ID                                                                                            | 企業ID, 企業微信管理バックエンドから取得                                                                      | -        |
| AgentId                                                                                               | 企業微信管理バックエンドの自建アプリ設定から取得                                                                   | -        |
| Secret                                                                                                | 企業微信管理バックエンドの自建アプリ設定から取得                                                                   | -        |
| Origin                                                                                                | 現在のアプリのドメイン                                                                                         | -        |
| ワークベンチアプリのリダイレクトリンク                                                                   | ログイン成功後にリダイレクトするアプリのパス                                                                             | `v1.4.0` |
| 自動ログイン                                                                                       | 企業微信ブラウザでアプリリンクを開く際に、自動的にログインします。複数の企業微信認証器が設定されている場合、このオプションを有効にできるのは1つのみです。 | `v1.4.0` |
| ワークベンチアプリのホームページリンク                                                                   | ワークベンチアプリのホームページリンク                                                                                   | -        |

## 企業微信アプリのホームページを設定

:::info
`v1.4.0` 以上のバージョンでは、「自動ログイン」オプションを有効にしている場合、アプリのホームページリンクは `https://<url>/<path>` のように簡略化できます。例えば `https://example.nocobase.com/admin`。

また、モバイルとPCの設定を別々にすることもできます。例えば `https://example.nocobase.com/m` と `https://example.nocobase.com/admin`。
:::

企業微信管理者バックエンドに進み、コピーしたワークベンチアプリのホームページリンクを対応するアプリのホームページアドレス欄に記入します。

![](https://static-docs.nocobase.com/202406272123631.png)

![](https://static-docs.nocobase.com/202406272123048.png)

## ログイン

ログインページにアクセスし、ログインフォームの下部にあるボタンをクリックしてサードパーティログインを開始します。

![](https://static-docs.nocobase.com/202406272124608.png)

:::warning
企業微信は電話番号などの機密情報に対する権限制限があるため、企業微信クライアント内でのみ認証を完了できます。初めて企業微信でログインする際は、以下の手順を参考にして企業微信クライアント内で初回ログイン認証を完了してください。
:::

## 初回ログイン

企業微信クライアントからワークベンチに進み、下部までスクロールしてアプリをクリックし、前に記入したアプリのホームページに進むと、初回認証ログインが完了します。その後、NocoBaseアプリ内で企業微信を使用してログインできます。

<img src="https://static-docs.nocobase.com/202406272131113.png" width="400" />
