# HTTP API を利用したユーザーデータの同期

## APIキーの取得

[APIキー](../api-keys) をご参照ください。APIキーに関連付けられたロールが、ユーザーデータ同期の権限を持っていることを確認してください。

## API の説明

### 使用例

```bash
curl 'https://localhost:13000/api/userData:push' \
  -H 'Authorization: Bearer <token>' \
  --data-raw '{"dataType":"user","records":[]}' # リクエストボディの詳細は以下をご参照ください
```

### エンドポイント

```bash
POST /api/userData:push
```

### ユーザーデータフォーマット

#### UserData

| パラメータ     | タイプ                              | 説明                                                                          |
|----------------|------------------------------------|-------------------------------------------------------------------------------|
| `dataType`     | `'user' \| 'department'`           | 必須。送信するデータの種類。ユーザーデータを送信する場合は `user` を指定。       |
| `matchKey`     | `'username' \| 'email' \| 'phone'` | 任意。指定したフィールドと送信データを基に、既存のシステムユーザーを照合します。 |
| `records`      | `UserRecord[]`                     | 必須。ユーザーデータの配列。                                                   |

#### UserRecord

| パラメータ       | タイプ       | 説明                                                                          |
|------------------|--------------|--------------------------------------------------------------------------------|
| `uid`           | `string`     | 必須。送信元のユーザーデータの一意識別子。1ユーザーにつき変更不可です。        |
| `nickname`      | `string`     | 任意。ユーザーのニックネーム。                                                 |
| `username`      | `string`     | 任意。ユーザー名。                                                             |
| `email`         | `string`     | 任意。ユーザーのメールアドレス。                                               |
| `phone`         | `string`     | 任意。ユーザーの電話番号。                                                     |
| `departments`   | `string[]`   | 任意。ユーザーが所属する部署の UID 配列。                                       |
| `isDeleted`     | `boolean`    | 任意。このレコードが削除済みであるかを示します。                               |
| `<field>`       | `any`        | 任意。ユーザーテーブル内のカスタムフィールドのデータ。                         |

---

### 部署データフォーマット

:::info
部署データを送信するには、[部署プラグイン](../../departments) がインストールされ、有効化されている必要があります。
:::

#### DepartmentData

| パラメータ     | タイプ                    | 説明                                                                         |
|----------------|---------------------------|------------------------------------------------------------------------------|
| `dataType`     | `'user' \| 'department'`  | 必須。送信するデータの種類。部署データを送信する場合は `department` を指定。   |
| `records`      | `DepartmentRecord[]`      | 必須。部署データの配列。                                                     |

#### DepartmentRecord

| パラメータ       | タイプ      | 説明                                                                          |
|------------------|-------------|-------------------------------------------------------------------------------|
| `uid`           | `string`    | 必須。送信元の部署データの一意識別子。1部署につき変更不可です。                |
| `title`         | `string`    | 必須。部署のタイトル。                                                        |
| `parentUid`     | `string`    | 任意。親部署の UID。                                                          |
| `isDeleted`     | `boolean`   | 任意。このレコードが削除済みであるかを示します。                               |
| `<field>`       | `any`       | 任意。部署テーブル内のカスタムフィールドのデータ。                             |

---

:::info

1. データ送信は冪等性が保証されており、同じデータを複数回送信しても結果が変わることはありません。
2. 親部署がまだ作成されていない場合、その部署を関連付けることができません。親部署を作成後、再度データを送信してください。
3. 部署が作成されていない場合、ユーザーの所属部署を関連付けることができません。先に部署データを送信し、その後、再度ユーザーデータを送信してください。

:::
