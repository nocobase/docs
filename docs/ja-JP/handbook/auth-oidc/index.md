# 認証：OIDC

<PluginInfo commercial="true" name="auth-oidc"></PluginInfo>

## 紹介

認証：OIDCプラグインは、OIDC (OpenID Connect)プロトコル標準に従い、認可コードフロー (Authorization Code Flow)を使用して、ユーザーが第三者のアイデンティティプロバイダー (IdP)が提供するアカウントでNocoBaseにログインできるようにします。

## プラグインの有効化

![](https://static-docs.nocobase.com/a494476c352a949a276d64e96e6ac587.png)

## OIDC認証の追加

ユーザー認証プラグイン管理ページにアクセスします。

![](https://static-docs.nocobase.com/4e598e7df963d7d23188afe3576456d6.png)

追加 - OIDC

![](https://static-docs.nocobase.com/1efbde1c0e2f4967efc1c4336be45ca2.png)

## 設定

### 基本設定

![](https://static-docs.nocobase.com/d80715319639e1681a28a97ad3131f21.png)

- ユーザーが存在しない場合は自動的にサインアップ - 一致する既存のユーザーが見つからない場合、新しいユーザーを自動的に作成するかどうかを選択します。
- 発行者 - 発行者はIdPによって提供され、通常は `/.well-known/openid-configuration`で終わります。
- クライアントID - クライアントIDを入力します。
- クライアントシークレット - クライアントシークレットを入力します。
- スコープ - 任意。デフォルトは `openid email profile`です。
- id_tokenの署名応答アルゴリズム - id_tokenの署名方法。デフォルトは `RS256`です。

### フィールドマッピング

![](https://static-docs.nocobase.com/92d63c8f6f4082b50d9f475674cb5650.png)

- フィールドマップ - フィールドマッピング。NocoBaseでは、現在マッピング可能なフィールドはニックネーム、メールアドレス、電話番号です。デフォルトのニックネームは `openid`です。
- ユーザーとバインドするためのフィールド - 既存ユーザーとマッチングするためのフィールドで、メールアドレスまたはユーザー名を選択できます。デフォルトはメールアドレスです。IdPが持っているユーザー情報には `email` または `username` フィールドが含まれている必要があります。

### 高度な設定

![](https://static-docs.nocobase.com/d9e8040118e8e2ecdc3c847f72bbb5a9.png)

- HTTP - NocoBaseのコールバックアドレスがHTTPプロトコルかどうか。デフォルトは `https`です。
- ポート - NocoBaseのコールバックアドレスのポート。デフォルトは `443/80`です。
- ステートトークン - リクエストの出所を検証し、CSRF攻撃を防ぐために使用します。固定値を入力することもできますが、**空白のままにすることを強くお勧めします。そうするとランダムな値が自動生成されます。固定値を使用する場合は、自身の使用環境とセキュリティリスクを評価してください。**
- 認証コードグラント交換時にパラメータを渡す - コードを使用してトークンを交換する際、一部のIdPはClient IDまたはClient Secretをパラメータとして渡すことを要求する場合があります。チェックを入れて対応するパラメータ名を記入できます。
- ユーザー情報エンドポイントの呼び出し方法 - ユーザー情報を取得するAPIを呼び出すときのHTTPメソッドです。
- ユーザー情報エンドポイント呼び出し時にアクセストークンを配置する場所 - ユーザー情報を取得するAPIへのアクセストークンの渡し方です。
  - ヘッダー - リクエストヘッダー、デフォルトです。
  - ボディ - リクエストボディ、`POST`メソッドと合わせて使用します。
  - クエリパラメータ - リクエストパラメータ、`GET`メソッドと合わせて使用します。

### 使用

![](https://static-docs.nocobase.com/2edbea211232cea6d38c79630132418c.png)

- 使用 (Usage) - コールバックURL (Redirect URL) はコピーしてIdPの該当設定に記入するために使用します。

:::info
ローカルテスト時は、URLに `127.0.0.1` を使用してください。`localhost` は使用しないでください。OIDCログイン方式では、クライアントのクッキーに安全検証用のステートを書き込む必要があります。ログイン時にウィンドウが一瞬表示されてログインに失敗した場合、サーバーにステート不一致のログがないか、リクエストクッキーにステートパラメータが含まれているかを確認してください。このような状況は、クライアントのクッキー内のステートとリクエストに含まれるステートが一致しないことが原因です。
:::

## ログイン

ログインページにアクセスし、ログインフォームの下にあるボタンをクリックして、サードパーティログインを開始します。

![](https://static-docs.nocobase.com/e493d156254c2ac0b6f6e1002e6a2e6b.png)

