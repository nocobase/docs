# データのインポート

<PluginInfo name="action-import"></PluginInfo>

## イントロダクション

## インストール

## インポートの説明

### 数値タイプフィールド

数値とパーセンテージをサポートし、`N/A` または `-` の値はフィルタリングされます。

| 数値1 | パーセンテージ | 数値2 | 数値3 |
| ----- | ------ | ----- | ----- |
| 123   | 25%    | N/A   | -     |

JSONに変換すると次のようになります。

```ts
{
  "数値1": 123,
  "パーセンテージ": 0.25,
  "数値2": null,
  "数値3": null,
}
```

### ブールタイプフィールド

入力文は（英語は大文字と小文字を区別しません）次の値をサポートします：

- `Yes` `Y` `True` `1` `はい`
- `No` `N` `False` `0` `いいえ`

| フィールド1 | フィールド2 | フィールド3 | フィールド4 | フィールド5 |
| ----- | ----- | ----- | ----- | ----- |
| いいえ   | はい    | Y     | true  | 0     |

JSONに変換すると次のようになります。

```ts
{
  "フィールド1": false,
  "フィールド2": true,
  "フィールド3": true,
  "フィールド4": true,
  "フィールド5": false,
}
```

### 日付タイプフィールド

| 日付のみ            | ローカル (+08:00)       | GMT                 |
| ------------------- | ------------------- | ------------------- |
| 2023-01-18 22:22:22 | 2023-01-18 22:22:22 | 2023-01-18 22:22:22 |

JSONに変換すると次のようになります。

```ts
{
  "日付のみ": "2023-01-18T00:00:00.000Z",
  "ローカル(+08:00)": "2023-01-18T14:22:22.000Z",
  "GMT": "2023-01-18T22:22:22.000Z",
}
```

### 選択タイプフィールド

オプション値とオプションラベルは、インポート文書として使用できます。複数のオプションは、コンマ（`,` または `、`）で区切ります。

フィールド `優先度` の選択肢は以下の通りです：

| オプション値 | オプションラベル |
| ------------ | ---------------- |
| low          | 低               |
| medium       | 中               |
| high         | 高               |

オプション値とオプションラベルは、インポート文書として使用できます。

| 優先度 |
| ------ |
| 高     |
| low    |

JSONに変換すると、以下のようになります：

```ts
[{ "優先度": "高" }, { "優先度": "low" }];
```

### 中国行政区フィールド

| 地区1         | 地区2         |
| ------------- | ------------- |
| 北京市/市辖区 | 天津市/市辖区 |

JSONに変換すると、以下のようになります：

```ts
{
  "地区1": ["11", "1101"],
  "地区2": ["12", "1201"]
}
```

### 添付ファイルフィールド

| 添付ファイル                               |
| ----------------------------------------- |
| https://www.nocobase.com/images/logo.png |

JSONに変換すると、以下のようになります：

```ts
{
  "添付ファイル": [
    {
      "filename": "logo.png",
      "title": "logo.png",
      "extname": ".png",
      "url": "https://www.nocobase.com/images/logo.png"
    }
  ]
}
```

### 関係タイプフィールド

複数のデータはコンマ（`,` または `、`）で区切ります。

| 部門/名称 | 分類/タイトル   |
| --------- | --------------- |
| 開発グループ | 分類1、分類2   |

JSONに変換すると、以下のようになります：

```ts
{
  "部署": [1], // 1 は「開発グループ」という部署名のレコード ID
  "分類": [1, 2], // 1,2 は「分類1」と「分類2」という分類タイトルのレコード ID
}
```

### JSON タイプフィールド

| JSON1           |
| --------------- |
| {"key":"value"} |

JSONに変換すると、

```ts
{
  "JSON": {"key":"value"}
}
```

### 地図幾何形状タイプ

| ポイント | 線          | ポリゴン           | 円    |
| ------- | ----------- | ----------------- | ---- |
| 1,2     | (1,2),(3,4) | (1,2),(3,4),(1,2) | 1,2,3 |

JSONに変換すると、

```ts
{
  "Point": [1, 2],
  "Line": [[1, 2], [3, 4]],
  "Polygon": [[1, 2], [3, 4], [1, 2]],
  "Circle": [1, 2, 3]
}
```

## カスタムインポートフォーマット

`db.registerFieldValueParsers()` メソッドを使用してカスタム `ValueParser` を登録します。例えば：

```ts
import { BaseValueParser } from '@nocobase/database';

class PointValueParser extends BaseValueParser {
  async setValue(value) {
    if (Array.isArray(value)) {
      this.value = value;
    } else if (typeof value === 'string') {
      this.value = value.split(',');
    } else {
      this.errors.push('値が無効です');
    }
  }
}

const db = new Database();

// type=point のフィールドをインポートする際、PointValueParser によってデータが解析されます
db.registerFieldValueParsers({
  point: PointValueParser,
});
```

### インポート例

| ポイント |
| ------- |
| 1,2     |

JSONに変換すると、次のようになります。

```ts
{
  "Point": [1, 2]
}
```

