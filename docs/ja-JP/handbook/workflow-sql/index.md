# SQL操作

特定のシーンでは、上記のシンプルなデータテーブル操作ノードでは複雑な操作ができない場合があります。そのため、SQLノードを直接使用して、データベースで複雑なSQL文を実行し、データ操作を行うことができます。

アプリケーション外部でデータベースに直接接続してSQL操作を行うのとは異なり、ワークフロー内ではプロセスコンテキストの変数を使用して、SQL文の一部のパラメータとして利用できます。

## FAQ

### SQLノードの結果はどのように使用しますか？

`SELECT`文を使用した場合、クエリ結果はSequelizeのJSON形式でノードに保存され、[JSON-query](../workflow-json-query/index.md)プラグインを通じて解析および使用できます。

### SQL操作はデータテーブルイベントをトリガーしますか？

**いいえ**。SQL操作はSQL文をデータベースに直接送信して処理を行います。関連する`CREATE` / `UPDATE` / `DELETE`操作はデータベース内で発生し、データテーブルイベントはNode.jsのアプリケーション層（ORM処理）で発生するため、データテーブルのイベントはトリガーされません。

## インストール

内蔵プラグインで、インストールは不要です。

## 使用マニュアル

### ノードの作成

ワークフロー構成画面で、プロセス内のプラス（“+”）ボタンをクリックして「SQL操作」ノードを追加します：

![SQL 操作_追加](https://static-docs.nocobase.com/0ce40a226d7a5bf3717813e27da40e62.png)

### ノード設定

![SQLノード_ノード設定](https://static-docs.nocobase.com/20240904002334.png)

#### データソース

SQLを実行するデータソースを選択します。

データソースはデータベースタイプである必要があります。たとえば、主データソース、PostgreSQLタイプなど、Sequelize互換のデータソースです。

#### SQL内容

SQL文を編集します。現在のところ、一文のSQLのみがサポートされています。

編集ボックス右上の変数ボタンを使って必要な変数を挿入できます。実行前にテキストが対応する変数の値に置き換えられ、置き換えられたテキストが最終的なSQL文としてデータベースに送信され、クエリが実行されます。

### ノードの実行結果

`v1.3.15-beta`以降、SQLノードの実行結果は純粋なデータで構成された配列となります。それ以前は、Sequelizeがクエリのメタ情報を含む構造を返していました（詳細は [こちら](https://sequelize.org/api/v6/class/src/sequelize.js~sequelize#instance-method-query) を参照）。

例えば、以下のクエリ：

```sql
select count(id) from posts;
```

`v1.3.15-beta`より前の結果：

```json
[
    [
        { "count": 1 }
    ],
    {
        // メタ情報
    }
]
```

`v1.3.15-beta`以降の結果：

```json
[
    { "count": 1 }
]
```

