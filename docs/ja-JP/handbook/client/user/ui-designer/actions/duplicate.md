# コピー

コピー操作は、ユーザーが新しいデータレコードを作成するために行のデータをコピーすることを許可し、**直接コピー**と**フォームにコピーして続けて記入**する2つの方法をサポートします。

#### 直接コピー

![](https://static-docs.nocobase.com/2c0ac5d1a539de4b72b49b7d966d8c09.png)

- デフォルトでは、データは直接コピーされます。
- 目標データテーブル：コピーして追加する目標データテーブルを指します（継承のシナリオでは子テーブルにコピーできますが、直接コピーは本テーブルにのみ追加できます）。
- テンプレートフィールド：コピーするフィールドを指定するために使用され、全選択可能で必須です。

設定を完了したら、ボタンをクリックしてデータをコピーします。

#### フォームにコピーして続けて記入

設定したテンプレートフィールドがデフォルト値としてフォームに入力され、変更後に提出できます。

本テーブルまたは子テーブルをコピーして追加する目標テーブルとして設定できます。

![](https://static-docs.nocobase.com/a072aa572fd0a0fe643eadf95471da2a.png)

テンプレートフィールドの設定：テンプレートフィールドはデフォルト値としてフォームに入力され、チェックされたフィールド値のみが表示されます。

![](https://static-docs.nocobase.com/8032fa2025180ade275da55b97774b4d.png)

「運行票」（o2m）はコピーの関係であり、そのフィールドコンポーネントを子フォームに調整し、子フォーム内のフィールドを設定できます。

![](https://static-docs.nocobase.com/b13c9287bae8601646727a2e78b81be7.png)

フォームフィールドの同期：フォームの設定が完了したら、フォームフィールドを同期するボタンをクリックすると、フォーム内で設定されたフィールドが自動的にすべてチェックされます（フォームフィールド設定の変更後は手動で再同期する必要があります）。フォームフィールドを同期した後、テンプレートフィールドをカスタマイズして調整できます。

![](https://static-docs.nocobase.com/156b6d8d741521e63d12e49092414d58.png)

コピー操作をクリックすると、ポップアップが開き、テンプレートフィールドに基づいてテンプレートデータがフォームのデフォルト値として入力されます。データを変更した後、提出してデータコピーを完了します。

![](https://static-docs.nocobase.com/1c0a0ae0c59971f48b2282a68831d44b.png)

以下の図は、注文リスト設定のコピー操作の完全な例です。

![](https://static-docs.nocobase.com/fa8a89abf0ba136df04b6d0d838eae4e.gif)

#### コピー、引用、プリロードの説明

異なるフィールド（異なる関係タイプ）には、それぞれ異なる処理ロジック（コピー、引用、プリロード）が存在し、関係フィールドのフィールドコンポーネントの設定も処理ロジックに影響を与えます。具体的には、SelectおよびRecord pickerは引用関係を処理するために使用され、Sub-formおよびSub-tableはコピー関係を処理するために使用されます。

- **コピー**

  - 通常のフィールドはコピーされます。
  - hasOneおよびhasManyの関係フィールドはコピーのみ可能です。このタイプの関係フィールドにはSelectやRecord pickerをフィールドコンポーネントとして使用することはできず、Sub-formやSub-tableなどを使用する必要があります。

    - hasOneおよびhasManyフィールドコンポーネントの変更は処理ロジック（コピー）には影響しません。
    - コピーされた関係フィールドでは、すべての子フィールドが選択可能です。

- **引用**

  - belongsToおよびbelongsToManyは引用です。
  - <strong>引用はコピーに変化する可能性があります。たとえば、フィールドコンポーネントがselectからsub-formに変更されると、関係が引用からコピーに変わります（コピーに変わった後は、すべての子フィールドが選択可能です）。</strong>

- **プリロード：引用フィールド内の関係フィールド**

  - 引用の関係フィールドに下位の関係フィールドがプリロードされます。
  - プリロードされた関係フィールドはフィールドコンポーネントの変更後、引用またはコピーに変化する可能性があります。

#### 全選択について

- すべてのコピーされたフィールドを選択します。
- すべての引用されたフィールドを選択します。

#### テンプレートデータの処理ロジック

- すべての関係の外部キー（fk）はフィルタリングされます。
- コピーされた関係データの主キー（pk）もフィルタリングされます。
- 引用とプリロードには主キー（pk）フィールドがあります。

#### 同期フォームフィールドを理解する方法

ほとんどのシーンでは、フォーム設定に関与するフィールドが非常に多くなります。このような複雑なフォームシーンを処理する際、手動でテンプレートフィールドを設定することは非常に手間がかかります。この問題を解決するために、強力な同期フォームフィールドボタンが導入されました。このボタンの役割は、フォームフィールドの設定を自動的に解析し、フィールドタイプと関係フィールドコンポーネントの設定に基づいてフィールドコピーのロジックを処理することです。これにはコピー、引用、プリロードが含まれます。この過程で、すでに設定されたフィールドはデフォルトで選択されます。

ユーザーがフォームフィールドの設定を変更するたびに、システムはこれらの変更を自動的に同期しません。したがって、ユーザーは手動で同期フォームフィールドボタンをクリックし、最新の設定情報をテンプレート設定に適用する必要があります。

