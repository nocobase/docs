# 概要

<PluginInfo name="workflow-action-trigger" link="/handbook/workflow-action-trigger"></PluginInfo>

システム内のすべてのユーザーが生み出すデータの変動は、通常、特定の操作を通じて行われます。具体的には、フォーム内の送信ボタンやデータブロック内の操作ボタンをクリックする形を取ります。操作後のイベントは、これらのボタン操作に関連するワークフローをバインドするために使用され、ユーザーの操作が成功した後に特定のプロセスをトリガーする効果を達成します。

例えば、新規データの追加や更新時に、ユーザーはボタンの「ワークフローをバインド」オプションを設定することで、操作を完了した後にバインドされたワークフローがトリガーされます。

実装面では、操作後のイベントの処理はミドルウェア層（Koaのミドルウェア）に存在するため、NocoBaseのHTTP API呼び出しも定義された操作後のイベントをトリガーすることができます。

:::info{title="ヒント"}
操作後のイベントは、元々「フォームイベント」と呼ばれており、以前のバージョンではこの機能はフォームボタンにのみ適用されていました。`v0.20`バージョンからは、データブロック内の操作ボタンにも対応するようになったため、「操作後のイベント」に名称が変更されました。
:::

## FAQ

### 操作前のイベントとの違い

操作後のイベントと操作前のイベントの違いは、全操作リクエストが発信され、応答を受け取る過程において、前者は操作処理の前にトリガーされ、後者は操作処理の後にトリガーされる点です。以下の図をご覧ください：

![操作実行順序](https://static-docs.nocobase.com/7c901be2282067d785205b70391332b7.png)

操作前のイベントは操作実行前にトリガーされ、リクエストの実行前にデータの検証や処理を行うことができます。リクエストが遮断された場合、その操作は実行されません。

一方、操作後のイベントはユーザーの操作が成功した後にトリガーされ、この時点でデータは正常に提出されており、その成功の結果に基づいて関連するプロセスを継続的に処理することができます。

### データテーブルイベントとの違い

操作後のイベントとデータテーブルイベントには類似点がありますが、いずれもデータの変動後にトリガーされるプロセスという点で共通しています。しかし、実装の面では異なります。操作後のイベントはAPI層に関連し、データテーブルイベントはデータテーブルのデータ変動に関連します。

データテーブルイベントはシステムの底層により近く、あるイベントによって引き起こされたデータ変動が別のイベントをトリガーする場合があります。特に、一部の関連データテーブルが現在のテーブルの操作中に変動する場合、関連テーブルに関連するイベントもトリガーされることがあります。

データテーブルイベントのトリガーには、ユーザーに関連する情報は含まれていません。一方、操作後のイベントはユーザーの操作により発生し、プロセスのコンテキストにユーザーに関連する情報が含まれます。これにより、ユーザーの操作によるデータの変動を処理するプロセスに適しています。NocoBaseの将来の設計では、トリガーとして使用できる操作後のイベントがさらに拡張される可能性があるため、**ユーザー操作によるデータの変動を処理するには、操作後のイベントの使用をお勧めします**。

もう一つの違いは、操作後のイベントが特定のフォームに部分的にバインドできることです。複数のフォームがある場合、一部のフォームの送信でこのイベントをトリガーし、別の部分ではトリガーしないことが可能ですが、データテーブルイベントはデータテーブル全体のデータ変動に対して適用され、部分的なバインディングはできません。

## インストール

内蔵プラグインのため、インストールは不要です。

## 使用マニュアル

操作後のイベントの使用は以下のいくつかの部分に分かれています：

- [トリガー設定](./trigger.md)
- [操作設定](./action.md)

また、[例](./example.md)を参考にして、実際のシナリオでの使用方法を理解できます。

外部システムから呼び出す必要がある場合は、[外部呼び出し](./http-api.md)を参照してください。

