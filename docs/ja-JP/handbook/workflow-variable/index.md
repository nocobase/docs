# カスタム変数

<PluginInfo name="workflow-variable" link="/handbook/workflow-variable" commercial="true"></PluginInfo>

プロセス内で変数を宣言したり、既に宣言された変数に値を割り当てたりすることができます。これは通常、プロセス内で一時的なデータを保存するために使用されます。

## 使用マニュアル

### ノードの作成

ワークフロー設定画面で、プロセス内のプラス（“+”）ボタンをクリックして、「変数」ノードを追加します：

![変数ノードの追加](https://static-docs.nocobase.com/53b1e48e777bfff7f2a08271526ef3ee.png)

### ノードの設定

#### モード

変数ノードはプログラム内の変数に似ており、使用する前にまず宣言し、その後値を割り当てる必要があります。そのため、変数ノードを作成する際には、変数のモードを選択する必要があります。選択可能なモードは2つあります：

![モードの選択](https://static-docs.nocobase.com/49d8b7b501de6faef6f303262aa14550.png)

- 新しい変数を宣言する：新しい変数を作成します。
- 既存の変数に値を割り当てる：以前のプロセスで宣言された変数に値を割り当てることは、変数の値を変更することに相当します。

作成したノードがプロセス内の最初の変数ノードである場合、宣言モードのみを選択できます。この時点では、まだ値を割り当てるための変数は存在しません。

既に宣言された変数に値を割り当てる場合、ターゲット変数、つまり宣言された変数のノードを選択する必要があります：

![値を割り当てる変数の選択](https://static-docs.nocobase.com/1ce8911548d7347e693d8cc8ac1953eb.png)

#### 値

変数の値は任意の型にすることができ、文字列、数字、論理値、日付などの定数や、プロセス内の他の変数であることも可能です。

宣言モードでは、変数の値を設定することは、変数に初期値を割り当てることに相当します。

![初期値の宣言](https://static-docs.nocobase.com/4ce2c508986565ad537343013758c6a4.png)

値を割り当てるモードでは、変数の値を設定することは、既に宣言されたターゲット変数の値を新しい値に変更することに相当し、その後の使用でこの新しい値を取得します。

![既に宣言された変数にトリガー変数の値を割り当てる](https://static-docs.nocobase.com/858bae180712ad279ae6a964a77a7659.png)

### 変数の値の使用

変数ノードの後続ノードで、「ノード変数」グループから宣言された変数を選択することで、その変数の値を使用できます。例えば、クエリノードでは、変数の値をクエリ条件として使用します：

![変数値をクエリフィルタ条件として使用](https://static-docs.nocobase.com/1ca91c295254ff85999a1751499f14bc.png)

### 実例

変数ノードが特に有用なシーンは、いくつかの分岐の中で、新しい値を以前の値と計算または結合する場合です（プログラミングにおける `reduce` や `concat` に似ています）。分岐が終了した後に使用します。以下は、ループ分岐と変数ノードを使用して、受信者の文字列を結合する例です。

まず、データテーブルトリガーのワークフローを作成し、「記事」データが更新されたときにトリガーされ、関連する「著者」リレーションデータを事前にロードします（受信者を取得するため）：

![トリガーの設定](https://static-docs.nocobase.com/93327530a93c695c637d74cdfdcd5cde.png)

次に、受信者文字列を保存するための変数ノードを作成します：

![受信者変数ノード](https://static-docs.nocobase.com/d26fa4a7e7ee4f34e0d8392a51c6666e.png)

次に、記事の著者を反復処理し、受信者を受信者変数に結合するためのループ分岐ノードを作成します：

![記事の著者をループ処理](https://static-docs.nocobase.com/083fe62c943c17a643dc47ec2872e07c.png)

ループ分岐の中で、最初に計算ノードを作成し、現在の著者と既に保存されている著者文字列を結合します：

![受信者文字列の結合](https://static-docs.nocobase.com/5d21a990162f32cb8818d27b16fd1bcd.png)

計算ノードの後にもう一つ変数ノードを作成し、代入モードを選択し、代入対象を受信者変数ノードに、値を計算ノードの結果に設定します：

![結合後の受信者文字列を受信者ノードに代入](https://static-docs.nocobase.com/fc40ed95dd9b61d924b7ca11b23f9482.png)

これにより、ループ分岐が終了すると、受信者変数にすべての著者の受信者文字列が保存されます。その後、ループ後に HTTP リクエストノードを使用してメール送信インターフェースを呼び出し、受信者変数の値を受信者パラメータとしてインターフェースに渡すことができます。

![受信者に郵送を送信するためのリクエストノード](https://static-docs.nocobase.com/37f71aa1a63e172bcb2dce10a250947e.png)

これにより、ループと変数ノードを使用したシンプルなメール配信機能が実現されました。

