# 応用利用

## インターセプトの条件

「操作前イベント」には、対応する操作がインターセプトされる2つの条件があります：

1. プロセスが任意の「プロセス終了」ノードに到達した場合、前述の使用説明と同様に、トリガーされたデータが「条件判断」ノードに設定された条件を満たさない場合、「否」のブランチに入り、「プロセス終了」ノードが実行されます。この際、プロセスは終了し、リクエストされた操作はインターセプトされます。
2. プロセス内の任意のノードが失敗した場合、ノードの実行エラーやその他の異常状況が含まれます。この場合、プロセスは対応する状態で終了し、リクエストされた操作もインターセプトされます。例えば、プロセス内で「HTTPリクエスト」を使用して外部データを呼び出す際に、リクエストが失敗すると、プロセスは失敗の状態で終了し、対応する操作リクエストもインターセプトされます。

インターセプト条件が満たされた後、対応する操作は実行されなくなります。例えば、注文の提出がインターセプトされた場合、対応する注文データは生成されません。

## 対応操作に関するパラメータ

「操作前イベント」タイプのワークフローでは、異なる操作に対して、トリガーに異なるデータが変数としてプロセス内で使用されます：

| 操作タイプ \\ 変数   | 「操作者」 | 「操作者役割識別」 | 操作パラメータ：「ID」 | 操作パラメータ：「提出されたデータオブジェクト」 |
|------------------|--------|----------------|--------------|--------------------------|
| レコードを作成       | ✓      | ✓              | -            | ✓                        |
| レコードを更新       | ✓      | ✓              | ✓            | ✓                        |
| 単一または複数レコードを削除 | ✓      | ✓              | ✓            | -                        |

:::info{title=ヒント}
操作前イベントの変数「トリガーデータ / 操作パラメータ / 提出されたデータオブジェクト」は、データベース内の実際のデータではなく、操作提出に関連するパラメータに過ぎません。データベース内の実際のデータが必要な場合は、プロセス内で「データをクエリ」ノードを使用して関連データを取得する必要があります。

また、削除操作に関しては、単一レコードの場合、操作パラメータ内の「ID」は単純な値ですが、複数レコードの場合、操作パラメータ内の「ID」は配列となります。
:::

## 出力応答メッセージ

トリガーを設定した後、ワークフロー内で関連する判断ロジックをカスタマイズできます。通常は「条件判断」ノードの分岐モードを使用し、具体的なビジネス条件に基づいて判断結果を評価し、「プロセスを終了」するかどうかを選択します。そして、予め設定された「応答メッセージ」を返します。

![フローのインターセプト設定](https://static-docs.nocobase.com/cfddda5d8012fd3d0ca09f04ea610539.png)

これで対応するワークフローの設定が完了しました。条件判断の設定に合致しないデータを送信してインターセプターのロジックをトリガーすると、返される応答メッセージを確認できます。

![エラーを示す応答メッセージ](https://static-docs.nocobase.com/06bd4a6b6ec499c853f0c39987f63a6a.png)

#### 応答メッセージの状態

「プロセスを終了」ノードで「成功」状態で終了するように設定されている場合、そのノードに到達した際にリクエストは依然としてインターセプトされますが、返される応答メッセージは「成功」の状態で表示されます（「エラー」ではありません）。

![成功状態の応答メッセージ](https://static-docs.nocobase.com/9559bbf56067144759451294b18c790e.png)

