# 実行計画（履歴）

各ワークフローがトリガーされると、対応する実行計画が作成され、タスクの実行プロセスを追跡します。各実行計画には、現在の実行状態を示すステータス値があり、このステータスは実行履歴のリストと詳細の両方で確認できます：

![実行計画の状態](https://static-docs.nocobase.com/d4440d92ccafac6fac85da4415bb2a26.png)

主プロセスのブランチ内のノードがすべて「完了」状態でプロセスの終点に達した場合、全体の実行計画は「完了」状態で終了します。主プロセスのブランチ内のノードに「失敗」「エラー」「キャンセル」「拒否」などの終端状態が発生した場合、全体の実行計画は対応する状態で**早期終了**します。主プロセスのブランチ内のノードに「待機」状態が発生した場合、全体の実行計画は実行を一時停止しますが、「実行中」の状態は表示され続け、待機しているノードが復帰した後に実行が再開されます。異なるノードタイプは待機状態の処理方法が異なり、例えば手動ノードは手動処理を待つ必要がありますが、遅延ノードは時間が経過するのを待ってから実行を続ける必要があります。

実行計画の状態は以下の表の通りです：

| 状態   | 対応する主プロセスの最後に実行されたノードの状態 | 意味                                             |
| ------ | -------------------------------------- | ------------------------------------------------ |
| キュー中 | -                                    | プロセスがトリガーされ、実行計画が生成され、スケジューラによる実行待ち。 |
| 進行中 | 待機                                   | ノードが一時停止を要求し、さらなる入力またはコールバックを待機中。 |
| 完了   | 完了                                   | 問題が発生せず、すべてのノードが期待通りに順次実行完了。 |
| 失敗   | 失敗                                   | ノードの設定が満たされなかったために失敗。                   |
| エラー | エラー                                 | ノードが未捕捉のプログラムエラーに遭遇し、早期終了。             |
| 取消   | 取消                                   | 待機中のノードがプロセス管理者によって外部から実行をキャンセルされ、早期終了。 |
| 拒否   | 拒否                                   | 人工処理のノードで、人工的に拒否されたため、後続プロセスが続行されない。   |

[クイックスタート](../quick-start.md)の例では、ワークフローの実行履歴の詳細を確認することで、すべてのノードの実行状況や結果データを確認できることがわかります。特に高度なプロセスやノードでは、ノードの結果が複数存在する場合があります。例えば、ループノードの結果：

![複数回実行されたノードの結果](https://static-docs.nocobase.com/bbda259fa2ddf62b0fc0f982efbedae9.png)

:::info{title=ヒント}
ワークフローは同時にトリガーされることがありますが、実行は順番に行われ、同時に複数のワークフローがトリガーされても、順次実行され、並行実行にはなりません。そのため、「キュー中」の状態が表示される場合、他のワークフローが実行中であり、待機する必要があります。

「進行中」の状態は、実行計画がすでに開始されていることを示しており、通常は内部ノードの待機状態により一時停止しています。この状態は、実行計画がキューの先頭の実行リソースを占有していることを意味しません。したがって、「進行中」の実行計画が存在する場合でも、「キュー中」の他の実行計画はスケジュールに従って実行を開始できます。
:::

## ノード実行状態

実行計画の状態は、その中の各ノードの実行によって決まります。一度トリガーされた実行計画の中で、各ノードが実行されると実行状態が生成され、その状態が後続のプロセスが続行されるかどうかを決定します。通常、ノードが成功裏に実行されると、次のノードが続けて実行され、すべてのノードが順次実行を完了するか、または中断されます。フロー制御に関連するノード（分岐、ループ、並列、遅延など）に遭遇した場合は、ノードに設定された条件や実行時のコンテキストデータに基づいて、次のノードの実行フローが決まります。

各ノード実行後に発生する可能性のある状態は以下の表の通りです：

| 状態 | 終了状態か | 早期終了か | 意味                                                       |
| ---- | :-------: | :-------: | -------------------------------------------------------- |
| 待機 |    否    |    否     | ノードが一時停止を要求し、さらなる入力またはコールバックを待機します。 |
| 完了 |    はい   |    否     | 問題が発生せず、実行が成功し、次のノードに進みます。                   |
| 失敗 |    はい   |    はい   | ノードの設定を満たさないために失敗しました。                           |
| エラー |    はい   |    はい   | ノードが未捕捉のプログラムエラーに遭遇し、早期に終了します。               |
| 取消 |    はい   |    はい   | 待機中のノードがフロー管理者によって外部からキャンセルされ、早期に終了します。 |
| 拒否 |    はい   |    はい   | 人工処理のノードで、人為的に拒否され、後続のプロセスが続行されません。       |

待機状態を除き、他の状態はノード実行の最終状態です。最終状態が「完了」の場合のみ、実行を続行します。それ以外の状態では、プロセスの実行は事前に終了します。ノードが分岐プロセス（並行分岐、条件判断、ループなど）の中にある場合、ノード実行によって生成された最終状態は、分岐を開始したノードに引き継がれ処理され、これによりプロセス全体の流れが決定されます。

たとえば、「‘はい’の場合は続行」という条件ノードを使用した際に、実行中に結果が「いいえ」となった場合、プロセスの実行は事前に終了し、失敗状態で退出し、それ以降のノードは実行されません。以下の図を参照してください：

![ノード実行失敗](https://static-docs.nocobase.com/993aecfa1465894bb574444f0a44313e.png)

:::info{title=ヒント}
すべての非「完了」の終了状態は失敗と見なすことができますが、失敗の原因は異なります。ノードの実行結果を確認することで、失敗の原因をさらに理解できます。
:::

