# 深く理解する

## 提出承認のデータスナップショット

承認中のデータはトランザクションデータの不変性の原則に従い、毎回の提出でスナップショットが生成され、承認プロセス中に流通します。具体的な流れは以下の通りです：

![承認データスナップショットフローの例](https://static-docs.nocobase.com/62a545a85d9e72c6b47e4b52707c4380.png)

プロセス中に「撤回」や「返却」の行動が発生した場合、同じ申請書の中で実施されたプロセスにおいて、その都度のデータスナップショットが保存されます：

![承認データスナップショット_プロセス例](https://static-docs.nocobase.com/62800d88772c88f1eaa11f6f493aea55.png)

上記の図に示されるように、毎回の撤回と再申請で提出されたデータは、その都度のプロセスに保存されます。

## 承認処理の状態

発起人にとって、提出された承認申請は書類データ内に状態フィールドを持ち、現在の承認の状態を示します。通常、以下のような状態があります：

| 状態 | 列挙値 | 説明 |
| --- | --- | --- |
| 下書き | 0 | 申請者は申請フォームのデータを一時的に保存しており、正式にプロセスを開始していません。 |
| 提出済み | 2 | 申請が提出され、承認者の処理を待っています。この時点では、まだ承認者による処理結果は未提出で、撤回可能に設定されている場合、発起人は撤回操作を行うことができます。 |
| 処理中 | 3 | 任意の承認ノードを経て、少なくとも一人の承認者がそのノードの承認処理結果を提出しました。この時点で、発起人は撤回できません。 |
| 返却済み | 1 | 申請が任意の承認者によって返却され、発起人は再度修正して再提出できます。 |
| 承認済み | 4 | プロセスを経たすべての承認ノードが承認者によって承認され、プロセスが終了します。 |
| 拒否済み | -1 | プロセスを経た任意の承認ノードが承認者によって拒否され、プロセスが終了します。 |

## 承認ノードの処理ステータス

承認ノードの処理ステータス。

| ステータス | 列挙値 | 説明 |
| --- | --- | --- |
| 割り当て済み | null | 対応する承認者の処理記録は作成済みだが、処理ルールがシリアル処理に設定されているため、現在の承認者は前の承認者の処理が完了するのを待つ必要がある。 |
| 処理待ち | 0 | 現在の承認者の処理を待っている状態。 |
| 差し戻し済み | 1 | 現在の承認者が差し戻しを行った。 |
| 承認済み | 2 | 現在の承認者が承認を行った。 |
| 拒否済み | -1 | 現在の承認者が拒否を行った。 |
| 未処理 | 3 | ノードの処理ルールにより他の承認者によって処理が完了した、またはこのワークフローが無効になったため、現在の承認者の処理は不要。 |

## 単一の承認者の処理ステータス

各承認ノードには、設定された承認者ごとに対応する処理記録が生成されます。それぞれの承認者の処理記録にはステータスフィールドが含まれており、現在の承認者の処理ステータスを示します。すべての承認ノードステータスに加えて、以下の追加ステータスがあります：

| ステータス | 列挙値 | 説明 |
| --- | --- | --- |
| 転送済み | 8 | 現在の承認者はこのタスクを他の人に転送し、処理する必要がなくなりました。 |
