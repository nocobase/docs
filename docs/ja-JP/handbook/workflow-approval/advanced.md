# 深く理解する

## 提出承認のデータスナップショット

承認中のデータはトランザクションデータの不変性の原則に従い、毎回の提出でスナップショットが生成され、承認プロセス中に流通します。具体的な流れは以下の通りです：

![承認データスナップショットフローの例](https://static-docs.nocobase.com/62a545a85d9e72c6b47e4b52707c4380.png)

プロセス中に「撤回」や「返却」の行動が発生した場合、同じ申請書の中で実施されたプロセスにおいて、その都度のデータスナップショットが保存されます：

![承認データスナップショット_プロセス例](https://static-docs.nocobase.com/62800d88772c88f1eaa11f6f493aea55.png)

上記の図に示されるように、毎回の撤回と再申請で提出されたデータは、その都度のプロセスに保存されます。

## 承認処理の状態

発起人にとって、提出された承認申請は書類データ内に状態フィールドを持ち、現在の承認の状態を示します。通常、以下のような状態があります：

| 状態 | 説明 |
| --- | --- |
| 下書き | 申請者は申請フォームのデータを一時的に保存しており、正式にプロセスを開始していません。 |
| 提出済み | 申請が提出され、承認者の処理を待っています。この時点では、まだ承認者による処理結果は未提出で、撤回可能に設定されている場合、発起人は撤回操作を行うことができます。 |
| 処理中 | 任意の承認ノードを経て、少なくとも一人の承認者がそのノードの承認処理結果を提出しました。この時点で、発起人は撤回できません。 |
| 返却済み | 申請が任意の承認者によって返却され、発起人は再度修正して再提出できます。 |
| 承認済み | プロセスを経たすべての承認ノードが承認者によって承認され、プロセスが終了します。 |
| 拒否済み | プロセスを経た任意の承認ノードが承認者によって拒否され、プロセスが終了します。 |

各承認ノードにおいて、ノードに設定された承認者に対して対応する処理記録が生成され、各承認者の処理記録にも状態フィールドが含まれ、現在の承認者の処理状態を示します。通常、以下のような状態があります：

| ステータス | 説明 |
| --- | --- |
| 割り当て済み | 対応する承認者の処理記録が作成されましたが、処理ルールが直列処理に設定されているため、現在の記録の承認者は前の承認者の処理が完了するのを待つ必要があります。 |
| 保留中 | 現在の承認者の処理を待機しています。 |
| 返却済み | 現在の承認者の処理が返却されました。 |
| 承認済み | 現在の承認者の処理が承認されました。 |
| 拒否済み | 現在の承認者の処理が拒否されました。 |
| 未処理 | ノードに設定された処理ルールに基づき、他の承認者によって処理された後にノード処理の最終状態に達したか、このワークフローが失効しているため、現在の承認者は再処理を行う必要がありません。 |

