# Наследование таблиц данных

Наследование таблиц данных — это уникальная функция базы данных PostgreSQL (требуется подключение к PostgreSQL), которая позволяет создавать дочерние таблицы на основе родительской таблицы. Дочерние таблицы наследуют структуру, определения полей и индексы родительской таблицы. Эта функция используется для управления большими объемами данных, реализации партиционирования данных и оптимизации производительности. Каждая дочерняя таблица может хранить данные, соответствующие определенным условиям, например, данные, разделенные по времени, что уменьшает объем сканируемых данных при запросах и повышает производительность. Кроме того, запросы к родительской и дочерним таблицам прозрачны: пользователи могут работать с набором унаследованных таблиц как с одной таблицей, что упрощает операции и запросы, делая работу с большими данными более эффективной.

## Одиночное наследование

В режиме одиночного наследования одна таблица может наследовать другую, при этом дочерняя таблица наследует структуру, поля и ограничения родительской таблицы. Этот подход используется для представления иерархии сущностей, позволяя дочерней таблице сохранять общие атрибуты и добавлять специфические.

В системе заказов, например, таблица «Оптовые заказы» может наследовать родительскую таблицу «Заказы» для обработки оптовых заказов с добавлением специфичных полей, таких как оптовая цена, номер партии и т.д.

![Пример одиночного наследования](https://docs-cn.nocobase.com/static/WNA9beotVoYfLqxfBsVcchhvn9y.36308e75.gif)

Иерархия наследования для таблицы товаров может быть организована следующим образом:

1. Родительская таблица «Товары» (Products): содержит общую информацию о товарах, такую как ID товара, название, цена, складской запас.
2. Дочерняя таблица «Электронные товары» (ElectronicsProduct): наследует таблицу «Товары» и добавляет специфичные поля, такие как размер экрана, операционная система.
3. Дочерняя таблица «Одежда» (ApparelProduct): наследует таблицу «Товары» и содержит атрибуты, специфичные для одежды, такие как размер, цвет, материал.
4. Дочерняя таблица «Пищевые продукты» (FoodProduct): наследует таблицу «Товары» и включает поля, такие как срок годности, тип продукта.
5. Дочерняя таблица «Мебель» (FurnitureProduct): наследует таблицу «Товары» и содержит специфичные атрибуты, такие как габариты, материал.

## Множественное наследование

Множественное наследование позволяет одной таблице наследовать структуру, поля и ограничения сразу нескольких родительских таблиц. Этот подход используется для моделирования сущностей с множественными связями.

Пример моделирования данных для заказов, транспортных накладных и товаров: в системе есть три основные сущности — заказы, транспортные накладные и товары. Один заказ может включать несколько товаров, один заказ может соответствовать нескольким транспортным накладным (например, если товары отправляются в разные места), а одна транспортная накладная может быть связана с несколькими заказами. Эти множественные связи можно реализовать с помощью дочерней таблицы (таблицы-связки), которая наследует несколько родительских таблиц (множественное наследование).

1. Родительская таблица «Заказы» (Orders): содержит основную информацию о заказах, например, ID заказа.
2. Родительская таблица «Транспортные накладные» (Shipments): содержит номер накладной, информацию о способе транспортировки.
3. Родительская таблица «Товары» (Products): содержит атрибуты товаров, такие как ID товара, название, цена.
4. Дочерняя таблица «Товары заказа» (OrderProduct): наследует таблицы «Заказы» и «Товары». Каждая запись представляет товар в заказе и содержит информацию, например, о количестве.
5. Дочерняя таблица «Связь заказа и накладной» (OrderShipment): наследует таблицы «Заказы» и «Транспортные накладные». Каждая запись представляет связь между заказом и накладной с соответствующей информацией.

![Пример множественного наследования](https://docs-cn.nocobase.com/static/HjXmbyAndo07izxp9AQcA5YSnyd.ac606504.gif)

## Переопределение полей

В отношениях наследования дочерняя таблица может переопределять или изменять поля, унаследованные от родительской таблицы, чтобы адаптировать их под конкретные потребности.

![Переопределение полей](https://docs-cn.nocobase.com/static/WNA9beotVoYfLqxfBsVcchhvn9y.36308e75.gif)

### Переопределение полей связей

Например, если таблица A имеет отношение «многие ко многим» с таблицей B, а таблица A1 наследует A, таблица B1 наследует B, то A1 также связана с B. Однако B содержит данные как самой B, так и всех ее дочерних таблиц, а A1 может быть нужно видеть только данные B1. В этом случае в A1 можно переопределить поле связи, изменив целевую таблицу B на B1. То есть в отношении A1.B можно изменить целевую таблицу B (с выбором из B и ее дочерних таблиц) на B1.

Пример: в таблице «Оптовые заказы» поле связи с товарами переопределяется (целевая таблица изменяется на «Электронные товары»).

![Переопределение поля связи](https://docs-cn.nocobase.com/static/HjXmbyAndo07izxp9AQcA5YSnyd.ac606504.gif)

### Переопределение полей с опциями

В родительской таблице «Товары» есть поле с опциями «Размер». Для таблицы «Одежда» это поле можно переопределить как размеры одежды (S, M, L), а для таблицы «Электронные товары» — как объем памяти (32GB, 64GB, 128GB).

## Совместное использование внешних ключей

Совместное использование внешних ключей — это стратегия, позволяющая нескольким таблицам использовать одно и то же поле внешнего ключа для установления связей между таблицами. Это особенно полезно, когда несколько таблиц должны ссылаться на одну и ту же сущность. В случае наследования таблиц данных такой общий внешний ключ обеспечивает связь каждой дочерней таблицы с другими таблицами, что позволяет строить более сложные модели данных.
