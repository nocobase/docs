# Копирование

Операция копирования позволяет пользователю скопировать строку данных для создания новой записи данных, поддерживая два способа: прямое копирование и копирование в форму с последующим заполнением.

#### Прямое копирование

![](https://static-docs.nocobase.com/2c0ac5d1a539de4b72b49b7d966d8c09.png)

- По умолчанию данные копируются напрямую.
- Целевая таблица: таблица, в которую добавляются скопированные данные (в случае наследования можно копировать в дочернюю таблицу, при прямом копировании — только в текущую таблицу).
- Шаблонные поля: используются для указания полей, которые нужно скопировать, можно выбрать все, обязательны для заполнения.

После завершения настройки нажмите кнопку, чтобы скопировать данные.

#### Копирование в форму с последующим заполнением

Шаблонные поля заполняются в форму как значения по умолчанию, которые можно изменить перед отправкой.

Можно настроить текущую таблицу или дочернюю таблицу как целевую для добавления скопированных данных.

![](https://static-docs.nocobase.com/a072aa572fd0a0fe643eadf95471da2a.png)

Настройка шаблонных полей: шаблонные поля будут заполнены в форму как значения по умолчанию, копируются только выбранные поля.

![](https://static-docs.nocobase.com/8032fa2025180ade275da55b97774b4d.png)

«Транспортная накладная» (o2m) — это отношение копирования, поле которого можно настроить как субформу, где также можно настроить поля субформы.

![](https://static-docs.nocobase.com/b13c9287bae8601646727a2e78b81be7.png)

Синхронизация полей формы: после завершения настройки формы можно нажать кнопку синхронизации полей формы, которая автоматически выберет все уже настроенные поля формы (при каждом изменении конфигурации полей формы требуется повторная ручная синхронизация). После синхронизации можно дополнительно настроить шаблонные поля вручную.

![](https://static-docs.nocobase.com/156b6d8d741521e63d12e49092414d58.png)

При нажатии на операцию копирования открывается всплывающее окно, в котором данные шаблона, соответствующие шаблонным полям, заполняются в форму как значения по умолчанию. Данные можно изменить и отправить для завершения копирования.

![](https://static-docs.nocobase.com/1c0a0ae0c59971f48b2282a68831d44b.png)

Пример полной настройки операции копирования для списка заказов показан на следующем изображении:

![](https://static-docs.nocobase.com/fa8a89abf0ba136df04b6d0d838eae4e.gif)

#### Пояснение о копировании, ссылке и предварительной загрузке

Для разных полей (разных типов отношений) применяются различные логики обработки (копирование, ссылка, предварительная загрузка). Изменение компонента поля для отношений также влияет на логику обработки (Select и Record picker используются для обработки ссылок, а Sub-form и Sub-table — для копирования).

- **Копирование**
  - Обычные поля копируются.
  - Поля отношений hasOne и hasMany могут быть только скопированы (такие поля не могут использовать компоненты Select или Record picker, а должны использовать Sub-form, Sub-table и т.д.).
    - Изменение компонента для полей hasOne и hasMany не меняет логику обработки (копирование).
    - Для скопированных полей отношений все дочерние поля могут быть выбраны.

- **Ссылка**
  - Поля belongsTo и belongsToMany являются ссылками.
  - **Ссылка может стать копированием, например, если компонент поля изменяется с Select на Sub-form, отношение становится копированием (после этого все дочерние поля становятся доступными для выбора).**

- **Предварительная загрузка**: поля отношений внутри ссылочных полей.
  - Поля отношений внутри ссылочных полей предварительно загружаются.
  - Предварительно загруженные поля могут стать ссылками или копированием при изменении компонента поля.

#### О выборе всех полей
- Все поля для копирования выбираются.
- Все поля для ссылок выбираются.

#### Логика обработки данных шаблона
- Все внешние ключи (fk) отношений фильтруются.
- Для копируемых данных отношений первичные ключи (pk) также фильтруются.
- Для ссылок и предварительной загрузки первичные ключи (pk) сохраняются.

#### Как работает синхронизация полей формы

В большинстве случаев конфигурация формы включает множество полей, и ручная настройка шаблонных полей может быть очень трудоемкой. Для упрощения этой задачи добавлена кнопка синхронизации полей формы. Эта функция автоматически анализирует конфигурацию полей формы и определяет логику копирования полей (копирование, ссылка или предварительная загрузка) на основе типов полей и настроек компонентов отношений. Все уже настроенные поля автоматически выбираются.

После изменения конфигурации полей формы система не синхронизирует изменения автоматически. Пользователю необходимо вручную нажать кнопку синхронизации полей формы, чтобы применить последние изменения к конфигурации шаблона.
