# Поле сортировки

## Введение

Поля сортировки используются для упорядочивания записей в коллекции и поддерживают сортировку вида «сначала группировка, затем сортировка» (sort1).

:::warning
Поскольку поле сортировки является полем текущей коллекции, при сортировке по группам одна и та же запись не может входить в несколько групп одновременно.
:::

## Установка

Встроенный плагин — отдельная установка не требуется.

## Руководство пользователя

### Создание поля сортировки

https://static-docs.nocobase.com/20240409091123_rec_.gif

При создании поля сортировки значения сортировки инициализируются следующим образом:
- Если группировка не выбрана, инициализация выполняется на основе первичного ключа и поля даты создания.
- Если выбрана группировка, сначала выполняется группировка данных, а затем инициализация на основе первичного ключа и поля даты создания.

:::warning{title="Пояснение о согласованности транзакций"}
- При создании поля, если инициализация значений сортировки завершится с ошибкой, поле сортировки не будет создано.
- В определённом диапазоне, если запись перемещается из позиции A в позицию B, значения сортировки всех записей в интервале AB изменятся. Если одна из операций завершится неудачей, всё перемещение будет отменено, и значения сортировки затронутых записей останутся неизменными.
:::

### Пример 1: Создание поля sort1

Поле sort1 не группируется.

https://static-docs.nocobase.com/20240409091510.png

Значения поля сортировки для каждой записи будут инициализированы на основе первичного ключа и даты создания.

https://static-docs.nocobase.com/20240409092305.png

### Пример 2: Создание поля sort2 с группировкой по ID класса

https://static-docs.nocobase.com/20240409092620.png

В этом случае все записи в коллекции сначала группируются (по ID класса), а затем инициализируется поле сортировки (sort2). Начальные значения каждой записи:

https://static-docs.nocobase.com/20240409092847.png

### Сортировка перетаскиванием

Поля сортировки в основном используются для сортировки записей в различных блоках с помощью drag-and-drop. Блоки, поддерживающие сортировку перетаскиванием, включают таблицы и доски (board).

:::warning
- При использовании одного и того же поля сортировки для сортировки перетаскиванием одновременное использование нескольких блоков может нарушить существующий порядок.
- В таблице для сортировки перетаскиванием нельзя выбирать поле сортировки, имеющее правило группировки.
- Исключение: в блоке таблицы с отношением «один ко многим» внешний ключ может использоваться как поле группировки.
- В настоящее время только блок доски поддерживает сортировку по группам с помощью перетаскивания.
:::

### Сортировка строк таблицы перетаскиванием

**Блок таблицы**

https://static-docs.nocobase.com/20240409104621_rec_.gif

**Блок связанной таблицы**

:::warning
В блоке с отношением «один ко многим»:
- Если выбрано поле сортировки без группировки, в сортировке могут участвовать все записи.
- Если сначала выполняется группировка по внешнему ключу, а затем сортировка, правило сортировки будет применяться только к данным внутри текущей группы.

Конечный эффект будет одинаковым, но количество записей, участвующих в сортировке, будет разным. Более подробное объяснение см. в разделе [Пояснение правил сортировки](#Пояснение-правил-сортировки).
:::

### Сортировка карточек доски перетаскиванием

https://static-docs.nocobase.com/20240409110423_rec_.gif

## Пояснение правил сортировки

### Перемещение между несгруппированными элементами (или в одной группе)

Предположим, есть набор данных:  
`[1, 2, 3, 4, 5, 6, 7, 8, 9]`

Если элемент 5 перемещается вперёд на позицию 3, изменятся только порядковые номера 3, 4 и 5: 5 занимает позицию 3, а 3 и 4 сдвигаются назад.  
Результат: `[1, 2, 5, 3, 4, 6, 7, 8, 9]`

Теперь переместим 6 назад на позицию 8: 6 занимает позицию 8, 7 и 8 сдвигаются вперёд.  
Результат: `[1, 2, 5, 3, 4, 7, 8, 6, 9]`

### Перемещение между разными группами

При сортировке по группам, если запись перемещается в другую группу, её принадлежность к группе также меняется. Например:

Группа A: `[1, 2, 3, 4]`  
Группа B: `[5, 6, 7, 8]`

Если элемент 1 перемещается к 6 (по умолчанию — после него), его группа меняется с A на B:  
Группа A: `[2, 3, 4]`  
Группа B: `[5, 6, 1, 7, 8]`

### Изменения сортировки не зависят от данных, отображаемых на экране

Например, есть набор данных:  
`[1, 2, 3, 4, 5, 6, 7, 8, 9]`

На экране отображаются только: `[1, 5, 9]`

Если 1 перемещается на позицию 9, позиции всех промежуточных элементов (2, 3, 4, 5, 6, 7, 8) изменятся:  
Результат: `[2, 3, 4, 5, 6, 7, 8, 9, 1]`

На экране отобразится: `[5, 9, 1]`
