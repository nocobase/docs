# Конфигурация узла утверждения

В "workflow" утверждения требуется специальный узел «Утверждение» для настройки логики обработки (утверждения, отклонения или возврата) инициированного запроса на утверждение утверждающими. Этот узел «Утверждение» используется исключительно в "workflow" утверждения.

:::info{title=Tip}
**Отличие от общего узла «Ручное»:** Общий узел «Ручное» универсален и может использоваться в различных рабочих процессах для ручного ввода данных, принятия решений о продолжении процесса и других сценариях. Напротив, узел «Утверждение» специализирован для "workflow" утверждения и не применим в других типах "workflow".
:::

## Создание узла

Чтобы создать узел «Утверждение», щелкните знак «плюс» («+») в "workflow". Затем выберите один из доступных режимов прохода для настройки узла утверждения:

![Создание узла утверждения](https://static-docs.nocobase.com/f15d61208a3918d005cd2031fc9b6ce7.png)

## Режимы прохода

Доступны два режима прохода:

1. Режим прямого прохода: этот режим идеально подходит для более простых "Workflow", где результат на узле утверждения определяет, завершается ли процесс. Если запрос не одобрен, процесс немедленно завершается.

![Режим прохождения узла утверждения - режим прямого прохода](https://static-docs.nocobase.com/a9d446a186f61c546607cf1c2534b287.png)

2. Режим ветвления: этот режим обычно используется для более сложных рабочих процессов. После того, как узел утверждения выдает результат, последующие узлы могут выполняться в полученных ветках.

![Режим пропуска узла утверждения — режим ветвления](https://static-docs.nocobase.com/57dc6a8907f3bb02fb28c354c241e4e5.png)

Если узел настроен с операцией «Возврат», будет создана ветка «Возврат», и процесс принудительно завершится после завершения ветки возврата.

После «одобрения» этого узла процесс продолжается как через ветку пропуска, так и через последующий "workflow". После операции «отклонения» настройка по умолчанию позволяет процессу продолжаться через последующий "workflow", хотя вы можете настроить узел на завершение процесса после выполнения ветки отклонения.

:::info{title=Tip}
Режим пропуска нельзя изменить после создания узла.
:::

## Утверждающие

Утверждающие — это пользователи, ответственные за действия по утверждению на узле. Они могут состоять из одного или нескольких пользователей, выбранных из статического списка или динамического значения, указанного переменной.

![Approval Node_Approvers](https://static-docs.nocobase.com/29c64297d577b9ca9457b1d7ac62287d.png)

При использовании переменной можно выбрать только первичные ключи или внешние ключи из данных пользователя в контексте и результатах узла. Если выбранная переменная является массивом (в случаях отношений «многие ко многим»), каждый пользователь в массиве будет объединен в общую коллекцию утверждающих.

## Режимы согласования

Если есть только один утверждающий (включая случаи, когда дедуплицируются несколько переменных), утверждение будет обрабатываться исключительно этим пользователем, независимо от выбранного режима согласования.

Для нескольких утверждающих выбранный режим согласования определяет метод обработки:

1. Или: узел проходит с одобрения любого одного человека; все должны отклонить, чтобы узел был отклонен.
2. И: узел проходит, только если все утверждающие одобряют; одно отклонение приводит к отклонению.
3. Голосование: узел проходит, если большинство (как указано) утверждающих одобряет; в противном случае узел отклоняется.

Для операции возврата, если любой пользователь в коллекции утверждающих выбирает возврат, узел напрямую выходит из "workflow".

## Порядок обработки

Для нескольких утверждающих порядок обработки определяет последовательность действий:

1. Параллельно: все утверждающие могут действовать в любом порядке, последовательность не требуется.
2. Последовательно: утверждающие действуют в порядке, определенном в коллекции утверждающих, где каждый последующий пользователь может продолжить работу только после того, как предыдущий представил свое решение.

Независимо от того, установлена ли обработка «Последовательно», сгенерированные результаты будут следовать правилам, изложенным в разделе «Режимы переговоров», при этом узел завершает выполнение после выполнения условий.

## Выход из рабочего процесса после завершения ветки отклонения

Когда «Режим ветвления» установлен на «Режим пропуска», вы можете выбрать выход из "workflow" после завершения ветки отклонения. Если выбрано, в конце ветки отклонения появится символ «✗», указывающий, что никакие дальнейшие узлы не будут выполняться после завершения этой ветки:

![Выход после отклонения](https://static-docs.nocobase.com/1e740df93c128fb6fe54bf85a740e683.png)

## Конфигурация интерфейса утверждающего

Конфигурация интерфейса утверждающего предоставляет интерфейс для утверждающих, когда "workflow" достигает этого узла. Нажмите кнопку конфигурации, чтобы открыть окно настроек:

![Всплывающее окно конфигурации интерфейса утверждающего](https://static-docs.nocobase.com/2c321ae164b436f1c572305ff27cc9dd.png)

В этом окне конфигурации можно добавлять блоки, такие как сведения об отправке утверждения, панели операций и настраиваемый текст подсказки:

![Добавить блок в конфигурацию интерфейса](https://static-docs.nocobase.com/9f8f11926e935ad8f8fbeec368edebfe.png)

### Блок подробностей

Блок подробностей содержимого утверждения включает данные, отправленные инициатором. Подобно стандартному блоку данных, вы можете свободно добавлять компоненты полей из таблицы данных и упорядочивать их для организации содержимого, которое должен просмотреть утверждающий:

![Блок сведений в конфигурации интерфейса](https://static-docs.nocobase.com/1140ec13caeea1b364d12e057720a29c.png)

### Блок формы

Блок формы операции может включать кнопки, поддерживаемые этим узлом, такие как «Утвердить», «Отклонить», «Вернуть», «Переназначить» и «Добавить утверждающего»:

![Блок формы операции в конфигурации интерфейса](https://static-docs.nocobase.com/20241226232013.png)

Кроме того, в форму операции можно добавлять поля, которые может изменять утверждающий. Эти поля будут отображаться в форме операции, когда утверждающий обрабатывает утверждение. Утверждающий может изменять значения этих полей, и после отправки данные, используемые для утверждения, и соответствующий снимок данных в процессе утверждения будут обновлены одновременно.

![approval_node_ui_configuration_action_form_modify_fields](https://static-docs.nocobase.com/20241226232124.png)

### "Утвердить", "Отклонить" и "Вернуть"

Среди кнопок операций утверждения "Утвердить", "Отклонить" и "Вернуть" являются решающими действиями. После отправки задача утверждающего на этом узле завершается. Дополнительные поля для заполнения во время отправки, такие как "Комментарии", можно добавить во всплывающее окно "Конфигурация обработки" для каждой кнопки.

![Конфигурация обработки формы операции](https://static-docs.nocobase.com/20241226232225.png)

### «Переназначить» и «Добавить утверждающего»

«Переназначить» и «Добавить утверждающего» — это нерешающие операции, используемые для динамической корректировки утверждающих в "workflow" утверждения. «Переназначить» передает задачу утверждения текущего пользователя другому пользователю, тогда как «Добавить утверждающего» вставляет дополнительного утверждающего до или после текущего утверждающего, позволяя новому утверждающему продолжить процесс утверждения.

После включения кнопок операций «Переназначить» или «Добавить утверждающего» необходимо установить «Назначаемый диапазон пользователей» в меню конфигурации кнопки, чтобы определить область пользователей, которые могут быть назначены в качестве новых утверждающих:

![Форма операции Назначаемый диапазон пользователей](https://static-docs.nocobase.com/20241226232321.png)

Подобно исходной конфигурации утверждающего узла, назначаемый диапазон пользователей может быть напрямую выбран утверждающими или на основе условий запроса из таблицы пользователей. Конечным результатом будет объединенная коллекция, исключающая пользователей, уже находящихся в коллекции утверждающих.

:::warning{title=Важно}
Если вы включаете или отключаете кнопку операции или изменяете назначаемый диапазон пользователей, обязательно сохраните конфигурацию узла после закрытия окна конфигурации интерфейса. В противном случае изменения кнопки операции не вступят в силу.
:::
