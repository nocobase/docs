# Пример

Следуя шагам настройки, описанным выше, давайте проиллюстрируем, как рассчитать окончательную цену для разных продуктов, применяя различные правила ценообразования в процессе размещения заказа.

1. Настройте коллекцию продуктов:

   | Имя поля          | Тип                   |
       |-------------------| ---------------------- |
   | Название продукта | Текст                 |
   | Цена              | Число                 |
   | Правило цены        |`belongsTo` (коллекция правил ценообразования)|

2. Настройте коллекцию правил цен (используя шаблон коллекции выражений):

   | Имя поля           | Тип                                |
       |--------------------|------------------------------------|
   | Имя правила          | Текст                              |
   | Коллекция         | Одиночный выбор (сбор данных)      |
   | Расчетная машина | Одиночный выбор (mathjs/formulajs) |
   | Выражение         | Текст                              |

3. Правила ценообразования на входе:

   | ID  | Имя     | Коллекция | Расчетная машина | Выражение                |
       | --- |---------|-----------| ------------------ | ------------------------- |
   | 1   | 80% off | Продукт   | formula.js         | `{{Product.Price}} * 0.8` |
   | 2   | 90% off | Продукт   | formula.js         | `{{Product.Price}} * 0.9` |

4. Создайте продукты и назначьте правила ценообразования:

   | ID  | Название продукта  | Цена | Правило цены |
       | --- | ------------- | ----- | ------------- |
   | 1   | iPhone 14 Pro | 7999  | 2             |
   | 2   | iPhone 13 Pro | 6999  | 1             |

5. Настройте "workflow", запускаемый при создании заказа:

   ![Trigger_CreateOrder](https://static-docs.nocobase.com/f181f75b10007afd5de068f3458d2e04.png)

6. Создайте узел расчета динамического выражения и настройте его с помощью правила «Данные триггера/Продукт/Цена»:

![SelectDynamicExpressionData](https://static-docs.nocobase.com/21ccc63e604dd90b7d26c3c33c12d671.png)

Установите источник данных переменной на продукт в данных триггера:

![SelectVariableDataSource](https://static-docs.nocobase.com/afbffe9661539d26e4b175ae8a4b28f7.png)

7. Добавьте узел обновления данных для обновления общей стоимости заказа с помощью результата из узла расчета:

![UpdateOrderData](https://static-docs.nocobase.com/5cc7ffb113c8d6a2fd3b1b34abe06dcc.png)

8. Запустите "workflow" при создании заказа и проверьте цены в заказе Список:

   | Заказать продукт    | Цена | Правило цены    | Общая цена          |
       | ---------------- |------|----------------|----------------------|
   | iPhone 14 Pro    | 7999 | Rule1: 90% off | 7999 \* 0.9 = 7199.1 |
   | iPhone 13 Pro    | 6999 | Rule2: 80% off | 6999 \* 0.8 = 5599.2 |

   Окончательная цена, отображаемая на изображении ниже, должна соответствовать рассчитанной цене в коллекции выше:

![OrderTotalPrice_AfterCreation](https://static-docs.nocobase.com/a5610aca292e79c4841c97457bd3cc7c.png)

:::info{title=Tip}
Поскольку "workflow" работает асинхронно, общая цена может не сразу отразиться в коллекции после создания заказа. Возможно, вам придется немного подождать, прежде чем обновлять страницу, чтобы увидеть обновленную общую цену.
:::
