# Руководство по безопасности NocoBase

NocoBase уделяет внимание безопасности данных и приложений на всех этапах, от функционального дизайна до реализации системы. Платформа имеет встроенные многочисленные функции безопасности, такие как аутентификация пользователей, управление доступом и шифрование данных, а также позволяет гибко настраивать политики безопасности в соответствии с реальными потребностями. Будь то защита пользовательских данных, управление правами доступа или изоляция сред разработки и производства, NocoBase предлагает практические инструменты и решения. Это руководство предназначено для обеспечения безопасного использования NocoBase, помогая пользователям защищать безопасность данных, приложений и окружения, гарантируя эффективное использование системных функций при соблюдении безопасности пользователей.

## Аутентификация пользователей

Аутентификация пользователей используется для идентификации пользовательских учетных записей, предотвращения несанкционированного доступа к системе и защиты от злоупотребления пользовательскими учетными записями.

### Политика токенов

По умолчанию NocoBase использует JWT (JSON Web Token) для аутентификации серверных API и поддерживает настройку следующих политик токенов:

| Параметр Конфигурации      | Описание                                                                                                                                                                                                                                                                                                                         |
|----------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Срок действия сессии       | Максимальное время действия каждой сессии пользователя. В течение срока действия сессии токен будет автоматически обновляться. По истечении времени действия пользователь должен войти снова.                                                                                                                                                       |
| Срок действия токена       |Срок действия каждого выпущенного API-токена. По истечении срока действия токена, если он находится в пределах срока действия сессии и не превышает лимит обновления, сервер автоматически выдаст новый токен для поддержания сессии пользователя, в противном случае пользователь должен войти снова. (Каждый токен может быть обновлен только один раз) |
| Лимит обновления истекшего токена | Максимальное время, в течение которого допускается обновление токена после его истечения.                                                                                                                                                                                                                                                          |

Обычно мы рекомендуем администраторам:

- Установить более короткий срок действия токена, чтобы ограничить время его экспозиции.
- Установить разумный срок действия сессии, который будет длиннее срока действия токена, но не слишком длинным, чтобы сбалансировать удобство пользователя и безопасность. Используйте механизм автоматического обновления токена, чтобы гарантировать, что активные сессии пользователей не прерываются, одновременно снижая риск злоупотребления долгосрочными сессиями.
- Установить разумный лимит обновления истекшего токена, чтобы токен естественным образом истекал, когда пользователь длительное время неактивен, без выпуска нового токена, снижая риск злоупотребления неактивными сессиями пользователей.

### Хранение токенов на клиенте

По умолчанию токены пользователей хранятся в LocalStorage браузера. После закрытия страницы браузера и повторного открытия, если токен все еще действителен, пользователь не должен входить снова.

Если вы хотите, чтобы пользователи каждый раз входили при открытии страницы, вы можете установить переменную окружения `API_CLIENT_STORAGE_TYPE=sessionStorage`, чтобы сохранять токен пользователя в SessionStorage браузера, тем самым достигая цели повторного входа пользователя при каждом открытии страницы.

### Политика паролей

> Профессиональная версия и выше

NocoBase supports setting password rules and password login attempt lock policies for all users to enhance the security of NocoBase applications that have password login enabled. You can refer to [Password Policy](./password-policy/index.md) to understand each configuration item.

#### Правила паролей

| Параметр Конфигурации                  | Описание                                                                                                           |
|----------------------------------------|--------------------------------------------------------------------------------------------------------------------|
| **Минимальная длина пароля**                    | Минимальная длина пароля, максимальная длина — 64.                                                 |
| **Сложность пароля**                | Установка требований к сложности пароля, типы символов, которые должны быть включены.                   |
| **Запрет включения имени пользователя в пароле** | Установка, может ли пароль включать имя текущего пользователя.                                                  |
| **Помнить историю паролей**          | Количество недавно использованных паролей, которые помнит пользователь. Пользователь не может повторно использовать их при изменении пароля. |

#### Настройка срока действия пароля

| Параметр конфигурации                                 | Описание                                                                                                                                                                                                                                                                                                                                                                                         |
|-------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **Срок действия пароля**                          | Срок действия паролей пользователей. Пользователи должны изменить свои пароли до истечения срока действия, чтобы пересчитать его. Если они не изменят свои пароли до истечения срока действия, они не смогут войти с использованием старого пароля и потребуется помощь администратора для сброса. <br>Если настроены другие способы входа, пользователи могут войти с использованием других методов.|
| **Канал уведомлений о приближающемся истечении срока действия пароля** | За 10 дней до истечения срока действия пароля пользователя будет отправляться уведомление при каждом входе пользователя.                                                                                                                                                                                                                                                                                           |

#### Безопасность входа по паролю

| Параметр конфишурации                                      | Описание                                                                                                                                                                                                                                                  |
|------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **Максимальное количество попыток входа с неверным паролем**                | Установка максимального количества попыток входа пользователя в указанном временном интервале.                                                                                                                                                                 |
| **Максимальный временной интервал попыток входа с неверным паролем (секунды)** | Установка временного интервала для расчета максимального количества неудачных попыток входа пользователя, в секундах.                                                                                                                                                              |
| **Время блокировки (секунды)**                                    | Установка времени блокировки пользователя после превышения лимита неудачных попыток входа (0 означает отсутствие лимита). <br>В период блокировки пользователь не сможет получить доступ к системе ни через один метод аутентификации, включая API-ключи. |

Обычно мы рекомендуем:

- Установить сильные правила паролей, чтобы снизить риск угадывания паролей по ассоциации или перебором.
- Установить разумный срок действия пароля, чтобы принудительно заставлять пользователей регулярно менять пароли.
- Комбинировать количество неудачных попыток входа и временные настройки, чтобы ограничивать частые попытки входа в короткий промежуток времени и предотвращать перебор паролей.
- При строгих требованиях к безопасности можно установить разумное время блокировки пользователя после превышения лимита входа. Однако следует отметить, что настройка времени блокировки может быть злонамеренно использована. Атакующие могут намеренно вводить неверный пароль несколько раз для целевых аккаунтов, заставляя их блокироваться и становиться недоступными для нормального использования. В реальной эксплуатации можно комбинировать ограничения по IP, ограничения частоты API и другие средства для предотвращения таких атак.
- Изменить стандартное имя пользователя, адрес электронной почты и пароль NocoBase, чтобы предотвратить их злонамеренное использование.
- Поскольку как истечение срока действия пароля, так и блокировка аккаунта могут препятствовать доступу к системе, включая аккаунты администраторов, рекомендуется настроить несколько аккаунтов в системе, имеющих права сброса паролей и разблокировки пользователей.

![](https://static-docs.nocobase.com/202501031618900.png)

### Блокировка пользователей

> Профессиональная версия и выше, включена в плагин политики паролей

Управление пользователями, заблокированными за превышение лимита неудачных попыток входа. Можно активно разблокировать их или активно добавлять аномальных пользователей в список заблокированных. После блокировки пользователь будет запрещен от доступа к системе через любой метод аутентификации, включая API-ключи.

![](https://static-docs.nocobase.com/202501031618399.png)

### Единый вход (SSO)

> Коммерческий плагин

NocoBase предоставляет богатый набор плагинов аутентификации SSO, поддерживающих множество основных протоколов, таких как OIDC, SAML 2.0, LDAP и CAS. Одновременно NocoBase имеет полный набор интерфейсов расширения методов аутентификации, что позволяет быстро разрабатывать и подключать другие типы аутентификации. Вы можете легко подключить свой существующий IdP к NocoBase для централизованного управления пользовательскими учетными записями на IdP, повышая безопасность.
![](https://static-docs.nocobase.com/202501031619427.png)

### Двухфакторная аутентификация

> Корпоративная версия

Двухфакторная аутентификация требует от пользователей предоставления второй части действительной информации для подтверждения своей личности при входе с использованием пароля, например, отправки одноразового динамического кода верификации на доверенное устройство пользователя, чтобы подтвердить личность пользователя и гарантировать, что она не будет злоупотреблена, что снижает риск утечки паролей.

### Контроль доступа по IP

> Корпоративная версия


- В условиях строгой безопасности можно настроить белый список IP-адресов, чтобы разрешить доступ только определенным IP-адресам или диапазонам IP-адресов, ограничивая несанкционированные внешние сетевые подключения и снижая риски безопасности на уровне источника.
- При доступе через публичную сеть, если администратор обнаруживает аномальный доступ, можно настроить черный список IP-адресов, чтобы блокировать известные злонамеренные IP-адреса или доступы из подозрительных источников, снижая угрозы, такие как злонамеренное сканирование и перебор паролей.
- Ведутся журналы записей для отклоненных запросов на доступ.

## Управление доступом

Настройка различных ролей в системе и назначение соответствующих прав доступа для ролей позволяет детально контролировать права доступа пользователей к ресурсам. Администраторы должны настраивать разумно в соответствии с потребностями реальных сценариев, чтобы снизить риск утечки системных ресурсов.

### Роли и права доступа

NocoBase контролирует права доступа пользователей к ресурсам путем настройки ролей в системе, авторизации различных ролей и привязки пользователей к соответствующим ролям. Каждый пользователь может иметь несколько ролей, и пользователи могут переключаться между ролями для работы с ресурсами с разных точек зрения. Если установлен плагин департаментов, можно также привязывать роли и департаменты, чтобы пользователи имели роли, привязанные к своим департаментам.

![](https://static-docs.nocobase.com/202501031620965.png)

### Права доступа к системной конфигурации

Права доступа к системной конфигурации включают следующие настройки:

- Разрешить интерфейс конфигурации
- Разрешить установку, включение и отключение плагинов
- Разрешить настройку плагинов
- Разрешить очистку кэша и перезапуск приложения
- Права доступа для каждого плагина

### Права доступа к меню

Права доступа к меню используются для контроля доступа пользователей к различным страницам меню, включая рабочий стол и мобильную версию.
![](https://static-docs.nocobase.com/202501031620717.png)

### Права доступа к данным

NocoBase обеспечивает детальный контроль над разрешениями пользователей на доступ к данным в системе, гарантируя, что разные пользователи могут получать доступ только к данным, связанным с их обязанностями, предотвращая злоупотребление полномочиями и утечку данных.

#### Глобальный контроль

![](https://static-docs.nocobase.com/202501031620866.png)

#### Контроль на уровне таблиц и полей

![](https://static-docs.nocobase.com/202501031621047.png)

#### Контроль области данных

Установите объем данных, с которыми могут работать пользователи. Обратите внимание, что объем данных здесь отличается от объема данных, настроенных в блоке. Объем данных, настроенный в блоке, обычно используется только для внешней фильтрации данных. Если вам необходимо строго контролировать разрешение пользователей на доступ к ресурсам данных, вам необходимо настроить его здесь, который контролируется сервером.
![](https://static-docs.nocobase.com/202501031621712.png)

## Безопасность данных

В процессе хранения и резервного копирования данных NocoBase предоставляет эффективный механизм для обеспечения безопасности данных.

### Хранение паролей

Пароли пользователей NocoBase шифруются и хранятся с использованием алгоритма scrypt, что эффективно противодействует массовым аппаратным атакам.

### Переменные окружения и ключи

При использовании сторонних сервисов в NocoBase мы рекомендуем настраивать информацию о сторонних ключах в переменные окружения и хранить их в зашифрованном виде. Это удобно для настройки и использования в разных местах и повышает безопасность. Подробнее о методах использования можно узнать в документации.


По умолчанию ключ шифруется с использованием алгоритма AES-256-CBC. NocoBase автоматически генерирует 32-битный ключ шифрования и сохраняет его в storage/.data/environment/aes_key.dat. Пользователи должны должным образом хранить файл ключа, чтобы предотвратить его кражу. Если вам нужно перенести данные, файл ключа также должен быть перенесен вместе с данными.

![](https://static-docs.nocobase.com/202501031622612.png)

### Хранение файлов

Если вам нужно хранить конфиденциальные файлы, рекомендуется использовать облачное хранилище, совместимое с протоколом S3, и использовать коммерческий плагин Хранение файлов: S3 (Pro) для включения приватного чтения и записи файлов. Если вам нужно использовать его в локальной сети, рекомендуется использовать приложения для хранения, поддерживающие приватную установку и совместимые с протоколом S3, такие как MinIO.
![](https://static-docs.nocobase.com/202501031623549.png)

### Резервное копирование приложения

Для обеспечения безопасности данных приложения и предотвращения потери данных мы рекомендуем регулярно резервировать базу данных.

Открытая версия может использовать инструменты базы данных для резервного копирования, подробнее см. на сайте: https://www.nocobase.com/en/blog/nocobase-backup-restore . Мы также рекомендуем хранить файлы резервных копий в безопасном месте, чтобы предотвратить утечку данных.

Профессиональные и выше версии могут использовать менеджер резервного копирования для резервного копирования. Менеджер резервного копирования предоставляет следующие функции:

- Автоматическое резервное копирование по расписанию: периодическое автоматическое резервное копирование экономит время и сокращает объем ручных операций, а безопасность данных становится более надежной.
- Синхронизация файлов резервных копий с облачным хранилищем: Изоляция файлов резервных копий от самого приложения, чтобы предотвратить потерю файлов резервных копий при недоступности службы из-за сбоев сервера.
- Шифрование файлов резервных копий: Установка пароля для файлов резервных копий, чтобы снизить риск потери данных при утечке файлов резервных копий.

![](https://static-docs.nocobase.com/202501031623107.png)

## Безопасность среды выполнения

Правильная установка NocoBase и обеспечение безопасности среды выполнения являются одним из ключевых факторов для обеспечения безопасности приложений NocoBase.

### Установка HTTPS

Для предотвращения атак "man-in-the-middle attacks" мы рекомендуем добавить SSL/TLS-сертификат на ваш сайт приложения NocoBase, чтобы обеспечить безопасность данных при передаче через сеть.

### Транспортное шифрование API

> Корпоративная версия 

В средах с более строгими требованиями к безопасности данных NocoBase поддерживает включение транспортного шифрования API для шифрования содержимого запросов и ответов API, предотвращения передачи открытого текста и увеличения порога взлома данных.

### Локальное развертывание

По умолчанию NocoBase не требует связи со сторонними сервисами, и команда NocoBase не собирает никакую информацию пользователей. Соединение с сервером NocoBase требуется только при выполнении следующих двух операций:

1. Автоматическая загрузка коммерческих плагинов через платформу сервисов NocoBase.
2. Онлайн-верификация и активация приложения для коммерческой версии.

Если вы готовы пожертвовать некоторым уровнем удобства, эти две операции также поддерживают выполнение в автономном режиме и не требуют прямого подключения к серверу NocoBase.

NocoBase поддерживает полную установку в локальной сети, подробнее в:
- https://www.nocobase.com/en/blog/load-docker-image
- [Upload plugins to the plugin directory to install and upgrade](../welcome/getting-started/plugin#installing-and-updating-plugins-via-plugin-directory-upload)

  ### Изоляция нескольких сред

> Профессиональная версия и выше

В реальной эксплуатации мы рекомендуем предприятиям изолировать тестовые и производственные среды для обеспечения безопасности данных приложения и среды выполнения в производственной среде. С помощью плагина управления миграциями можно мигрировать данные приложения между разными средами.

![](https://static-docs.nocobase.com/202501031627729.png)

## Аудит и мониторинг

### Журналы аудита

> Корпоративная версия

Функция журнала аудита NocoBase записывает активность пользователей в системе. Записывая ключевые операции и поведение доступа пользователей, администраторы могут:

- Проверять информацию о доступе пользователей, такие как IP-адрес, устройство и время операции, для своевременного обнаружения аномального поведения.
- Отслеживать историю операций с ресурсами данных в системе.

![](https://static-docs.nocobase.com/202501031627719.png)

![](https://static-docs.nocobase.com/202501031627922.png)

### Журналы приложения

NocoBase предоставляет несколько типов журналов, чтобы помочь пользователям понимать состояние работы системы и записи поведения, что позволяет своевременно идентифицировать и локализовать проблемы системы, обеспечивая ее безопасность и управляемость с разных сторон. Основные типы журналов включают:

- Журнал запросов: Журналы API -запросов, включая посещенные URL, методы HTTP, параметры запроса, время ответа и коды состояния.
- Журнал системы: Записи событий работы приложения, включая запуск службы, изменения конфигурации, сообщения об ошибках и ключевые операции.
- Журнал SQL: Записи операций базы данных и их времени выполнения, включая операции запроса, обновления, вставки и удаления.
- Журнал рабочего процесса: журнал выполнения рабочего процесса, включая время выполнения, информацию о выполнении и информацию об ошибках.
- 
 
