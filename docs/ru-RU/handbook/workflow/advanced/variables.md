# Использование переменных

## Основная концепция

Как и переменные в языках программирования, **переменные** являются важным инструментом для связи и организации процессов в workflow.

Когда каждый узел выполняется после срабатывания workflow, переменные могут использоваться в некоторых настройках конфигурации. Источником переменных являются данные результатов вышестоящих узлов, включая следующие категории:

- Данные контекста триггера: В случаях, таких как триггеры действий и триггеры коллекций, объект одной записи может использоваться всеми узлами. Конкретная реализация может отличаться в зависимости от отдельного триггера.
- Данные вышестоящих узлов: При выполнении любого узла, данные результатов ранее завершенных узлов.
- Локальные переменные: Когда узел находится в некоторых специальных ветвях структуры, могут использоваться локальные переменные, специфичные для соответствующей ветки, например, в циклических структурах, где объекты данных для каждого цикла могут быть использованы.
- Системные переменные: Некоторые встроенные системные параметры, такие как текущее время и т.д.

Мы уже использовали функцию переменных много раз в [Быстром старте](../quick-start.md), например, в узле вычислений мы можем использовать переменные для ссылки на данные контекста триггера для вычислений:

![Использование функций и переменных в узле вычислений](https://static-docs.nocobase.com/837e4851a4c70a1932542caadef3431b.png)

В узле обновления используем данные контекста триггера как переменные условий фильтрации и ссылаемся на результат узла вычислений как переменную значения поля для обновления записи:

![Переменные в узле обновления данных](https://static-docs.nocobase.com/2e147c93643e7ebc709b9b7ab4f3af8c.png)

## Структура данных

Внутри переменная представляет собой структуру JSON, которая обычно может использоваться для доступа к конкретным частям данных в соответствии с JSONPath. Поскольку многие переменные основаны на коллекциях данных NocoBase, ассоциированные данные будут представлены в виде древовидной структуры объектов. Например, выбор значения поля связанных данных, которые были запрошены. Кроме того, когда ассоциированные данные имеют структуру "многие-ко-многим", переменная может быть массивом.

Выбор переменной чаще всего требует выбора атрибута последнего уровня, обычно это простой тип данных, такой как число, строка и т.д. Однако, когда в иерархии переменной присутствует массив, атрибуты конечного уровня также будут отображаться в массив, и только если соответствующий узел поддерживает массивы, данные массива могут быть корректно обработаны. Например, в узле вычислений некоторые механизмы вычислений имеют функции, специально предназначенные для массивов, а в узле цикла объект цикла может напрямую выбирать массив.

Например, когда узел запроса запрашивает несколько строк данных, результат узла будет массивом, содержащим несколько строк однородных данных:

```json
[
  {
    "id": 1,
    "title": "Title 1"
  },
  {
    "id": 2,
    "title": "Title 2"
  }
]
```

Однако, когда он используется как переменная в последующих узлах, если выбранная переменная имеет форму `Результат узла / Узел запроса / Название`, она будет отображаться в плоский массив соответствующих значений полей:

```json
["Title 1", "Title 2"]
```

Если это многомерный массив (например, поля ассоциации "многие-ко-многим"), после выравнивания соответствующего поля он станет одномерным массивом.

## Встроенные системные переменные

### Системное время

Получение системного времени на момент выполнения на основе узла, где оно выполняется. Часовой пояс соответствует настройкам сервера.

### Параметры диапазона дат

Могут использоваться для настройки условий фильтрации полей даты в узлах запроса, обновления и удаления. Поддерживается только сравнение "Равно", а начальная и конечная точки диапазона дат основаны на настройках часового пояса сервера.

![Параметры диапазона дат](https://static-docs.nocobase.com/20240817175354.png)
