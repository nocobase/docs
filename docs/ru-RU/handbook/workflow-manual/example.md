# Примеры

### Проверка статьи

Представим сценарий, в котором обычный пользователь отправляет статью. Прежде чем статья будет опубликована, её должен проверить и одобрить администратор. Если статья не проходит проверку, она остаётся в черновике и не публикуется. Весь этот процесс можно реализовать с помощью узла «Обновить форму» в рамках ручного процесса.

Для начала создайте рабочий процесс, который запускается при действии «Добавить статью», и добавьте в него узел ручного ввода:

<figure>
  <img alt="Ручной узел — Пример рабочего процесса проверки статьи" src="https://github.com/nocobase/nocobase/assets/525658/2021bf42-f372-4f69-9c84-5a786c061e0e" width="360" />
</figure>

Внутри этого узла назначьте ответственного — администратора. Затем в интерфейсе настройки добавьте блок, отображающий детали новой статьи на основе данных триггера:

<figure>
  <img alt="Ручной узел — Пример настройки узла: блок с деталями статьи" src="https://github.com/nocobase/nocobase/assets/525658/c61d0aac-23cb-4387-b60e-ce3cc7bf1c24" width="680" />
</figure>

Далее добавьте блок с формой «Обновить данные» в интерфейсе настройки. Эта форма должна быть связана с таблицей статей, чтобы администратор мог решить, одобрять ли статью. После добавления формы автоматически появится кнопка «Продолжить процесс», нажатие которой будет означать одобрение. Кроме того, добавьте кнопку «Прервать процесс» для случаев, когда статья отклоняется:

<figure>
  <img alt="Ручной узел — Пример настройки узла: форма и действия" src="https://github.com/nocobase/nocobase/assets/525658/4baaf41e-3d81-4ee8-a038-29db05e0d99f" width="673" />
</figure>

Когда процесс продолжается, статус статьи должен быть обновлён. Существует два основных способа сделать это. Первый — отобразить поле статуса статьи непосредственно в форме, чтобы оператор мог выбрать его. Этот метод особенно полезен в сценариях, где требуется активный ввод, например, при добавлении комментариев:

<figure>
  <img alt="Ручной узел — Пример настройки узла: поля формы" src="https://github.com/nocobase/nocobase/assets/525658/82ea4e0e-25fc-4921-841e-e1a2782a87d1" width="668" />
</figure>

Для более простого процесса вы можете вместо этого настроить значения полей формы непосредственно на кнопке «Продолжить процесс». Например, добавьте поле «Статус» со значением «Опубликовано». Тогда при нажатии кнопки статья автоматически обновится до статуса «Опубликовано»:

<figure>
  <img alt="Ручной узел — Пример настройки узла: присвоение значений в форме" src="https://github.com/nocobase/nocobase/assets/525658/0340bd9f-8323-4e4f-bc5a-8f81be3d6736" width="711" />
</figure>

Далее из меню настройки в правом верхнем углу блока формы выберите условия фильтрации данных для обновления. В данном случае выберите таблицу «Статья» и установите условие фильтрации: «ID равен Переменные триггера / Данные триггера / ID»:

<figure>
  <img alt="Ручной узел — Пример настройки узла: условия формы" src="https://github.com/nocobase/nocobase/assets/525658/da004055-0262-49ae-88dd-3844f3c92e28" width="1020" />
</figure>

Наконец, для повышения удобства использования можно настроить заголовки блоков, текст кнопок и подсказки внутри полей формы:

<figure>
  <img alt="Ручной узел — Пример настройки узла: итоговая форма" src="https://github.com/nocobase/nocobase/assets/525658/21db5f6b-690b-49c1-8259-4f7b8874620d" width="678" />
</figure>

После выполнения этих шагов закройте панель настройки и нажмите кнопку сохранения. Рабочий процесс готов. После включения этого процесса при добавлении новой статьи он будет автоматически запускаться. Администратор увидит эту задачу в своём списке дел:

<figure>
  <img alt="Ручной узел — Пример: список задач по проверке статьи" src="https://github.com/nocobase/nocobase/assets/525658/4e1748cd-6a07-4045-82e5-286826607826" width="1363" />
</figure>

<figure>
  <img alt="Ручной узел — Пример: детали задачи по проверке статьи" src="https://github.com/nocobase/nocobase/assets/525658/65f01fb1-8cb0-45f8-ac21-ec8ab59be449" width="680" />
</figure>

На основе деталей статьи администратор решает, публиковать её или нет. При нажатии кнопки «Одобрить» статус статьи обновляется на «Опубликовано». При нажатии кнопки «Отклонить» статья остаётся в черновике.

### Утверждение отпуска

Рассмотрим другой сценарий: сотрудник подаёт заявку на отпуск. Заявка должна быть одобрена руководителем, прежде чем вступит в силу, и данные об отпуске сотрудника будут соответствующим образом обновлены. Независимо от того, одобрена заявка или отклонена, сотруднику будет отправлено SMS-уведомление с помощью узла запроса (см. раздел [HTTP-запрос](#_HTTP_Request)). Этот процесс можно эффективно управлять с помощью пользовательской формы в узле ручного ввода.

Создайте рабочий процесс, запускающийся при действии «Добавить заявку на отпуск», и добавьте узел ручного ввода, аналогично процессу проверки статьи. Однако в этом случае ответственным будет руководитель. Добавьте блок на основе данных триггера, чтобы отобразить детали новой заявки на отпуск. Затем добавьте блок с пользовательской формой, где руководитель может решить, одобрять ли заявку. Форма должна включать поля для статуса утверждения и причины отказа:

<figure>
  <img alt="Ручной узел — Пример настройки узла: утверждение отпуска" src="https://github.com/nocobase/nocobase/assets/525658/ef3bc7b8-56e8-4a4e-826e-ffd0b547d1b6" width="675" />
</figure>

В отличие от процесса проверки статьи, поскольку последующие шаги зависят от решения руководителя, здесь настроена только кнопка «Продолжить процесс» для отправки, а кнопка «Прервать процесс» не используется.

Кроме того, после узла ручного ввода можно добавить узел условия, чтобы определить, одобрил ли руководитель заявку. В ветви «одобрено» добавьте узел обработки данных для обновления данных об отпуске, а после завершения ветви добавьте узел запроса для отправки SMS-уведомления сотруднику. Это завершит процесс, как показано ниже:

<figure>
  <img alt="Ручной узел — Пример: схема рабочего процесса утверждения отпуска" src="https://github.com/nocobase/nocobase/assets/525658/733f68da-e44f-4172-9772-a287ac2724f2" width="593" />
</figure>

Узел условия должен быть настроен по следующему критерию: **«Результат узла / Руководитель / Форма процесса / Утверждение» равно «Одобрено»**:

<figure>
  <img alt="Ручной узел — Пример: проверка условия утверждения отпуска" src="https://github.com/nocobase/nocobase/assets/525658/57b972f0-a3ce-4f33-8d40-4272ad205c20" width="678" />
</figure>

Данные в узле запроса можно настроить с использованием соответствующих переменных формы из узла ручного ввода, чтобы отправлять разные тексты SMS в зависимости от результата. После такой настройки рабочий процесс готов. После активации руководители смогут управлять заявками на отпуск прямо из списка своих задач, аналогично процессу проверки статьи.
