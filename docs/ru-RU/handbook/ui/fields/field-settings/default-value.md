### **Значения по умолчанию**

#### **Введение**

Значения по умолчанию — это начальные значения полей в новой записи. Вы можете задать значения по умолчанию при настройке полей в таблице данных или указать их для полей в блоке формы создания записи. Эти значения могут быть константами или переменными.

#### **Где можно настроить значения по умолчанию?**

##### **Поля таблицы данных**

![Поля таблицы](https://static-docs.nocobase.com/20240411095933.png)

##### **Поля в формах создания**

Большинство полей в формах создания поддерживают установку значений по умолчанию.

![Поля в форме](https://static-docs.nocobase.com/20240411100030.png)

##### **Добавление подформ**

При добавлении подформ в форме создания или редактирования, новые связанные данные будут заполняться значениями по умолчанию.

**Подформа «Добавить новое»**

![Подформа](https://static-docs.nocobase.com/20240411100341.png)

**Вложенная таблица «Добавить новое»**

![Вложенная таблица](https://static-docs.nocobase.com/20240411100424.png)
![Пример](https://static-docs.nocobase.com/20240411100634.png)

При редактировании существующих данных, если поле пустое, оно не будет заполнено значением по умолчанию. Значения по умолчанию применяются только к новым записям и не сохраняются в таблице.

![Пример](https://static-docs.nocobase.com/20240411100729.png)

#### **Значения по умолчанию для связанных данных**

Значения по умолчанию доступны только для типов связей «многие к одному» и «многие ко многим», если используются компоненты выбора (Select, RecordPicker).

![Связанные данные](https://static-docs.nocobase.com/20240411101025.png)

#### **Переменные значений по умолчанию**

##### **Какие переменные доступны?**

- Переменные даты;
- Текущий пользователь;
- Текущая запись (понятие применимо только к существующим данным);
- Текущая форма (желательно, чтобы отображались только поля формы);
- Текущий объект (понятие для каждой строки данных во вложенной форме);
- Записи, выбранные в таблице (пока доступно только для комбинации «Блок таблицы + Форма добавления записи»).

Более подробно о переменных см. в разделе [Переменные](/handbook/ui/variables).

#### **Типы переменных для значений по умолчанию**

Существует два типа: переменные для независимых полей и переменные для связанных полей.

##### **Переменные для значений по умолчанию в связанных полях**

- Объект переменной должен быть записью коллекции;
- Данные должны быть из таблицы на пути наследования (текущая таблица или родительская/дочерняя);
- Переменная «Записи, выбранные в таблице» доступна только для полей связи «многие ко многим» и «один ко многим / многие к одному»;
- При работе с несколькими уровнями данных — применяется выравнивание (flatten) и удаление дубликатов.

```js
// Записи, выбранные в таблице:
[{id:1},{id:2},{id:3},{id:4}]

// Записи, выбранные в таблице / один к одному:
[{one-to-one: {id:2}}, {one-to-one: {id:3}}, {one-to-one: {id:3}}]
// После выравнивания и удаления дубликатов
[{id: 2}, {id: 3}]

// Записи, выбранные в таблице / многие ко многим:
[{many-to-many: [{id: 1}, {id:2}]}, {many-to-many: [{id:3}, {id:4}]}]
// После выравнивания
[{id:1},{id:2},{id:3},{id:4}]
```

##### **Переменные для значений по умолчанию в независимых полях**

- Тип должен быть совместимым (например, строки совместимы с числами, объекты с методом toString);
- Поля JSON — особые, могут хранить данные любого типа.

#### **Иерархия полей (опциональные поля)**

![Иерархия](https://static-docs.nocobase.com/20240411101157.png)

**Для независимых полей:**
- При выборе полей с несколькими уровнями поддерживается только связь «один к одному»; «многие ко многим» не поддерживается;
- Поля JSON — особые, могут иметь меньше ограничений.

**Для связанных полей:**
- `hasOne`: поддерживает только «один к одному»;
- `hasMany`: поддерживает «один к одному» (внутренне преобразуется) и «многие ко многим»;
- `belongsToMany`: поддерживает «один к одному» (внутренне преобразуется) и «многие ко многим»;
- `belongsTo`: обычно для «один к одному», но если родительская связь `hasMany`, то поддерживается и «многие ко многим» (так как `hasMany`/`belongsTo` по сути является «многие ко многим»).

#### **Особые случаи**

«Многие ко многим» эквивалентно комбинации «один ко многим / многие к одному».

**Модель**

![Модель](https://static-docs.nocobase.com/20240411101558.png)

При установке переменной значения по умолчанию для связи «многие ко многим», если переменная содержит несколько записей, будут выбраны все эти записи, как показано ниже:

Когда таблица в блоке и таблица поля связи — одна и та же.

![Пример](https://static-docs.nocobase.com/20240411103021.png)

#### **Почему связи «один к одному» и «один ко многим» не поддерживают значения по умолчанию?**

Например, в связи A.B, если b1 связан с a1, он не может быть связан с a2. Если b1 свяжут с a2 — он отвяжется от a1. В этом случае данные не являются общими, а значения по умолчанию работают по принципу общего доступа (обе записи могут быть связаны). Поэтому для «один к одному» и «один ко многим» значения по умолчанию недоступны.

#### **Почему во вложенных формах и таблицах с «многие к одному» и «многие ко многим» нельзя задавать значения по умолчанию?**

Потому что вложенные формы и таблицы предназначены для прямого редактирования связанных данных (включая добавление и удаление), а значения по умолчанию работают по механизму общего доступа (обе записи могут быть связаны), но не изменяют данные связи. Поэтому в этом сценарии значения по умолчанию неуместны.

Кроме того, во вложенных формах и таблицах есть подполя, и становится неясно, к чему относится значение по умолчанию — к строкам или столбцам.

Учитывая это, правильнее не разрешать устанавливать значения по умолчанию для любых типов вложенных форм и таблиц.
