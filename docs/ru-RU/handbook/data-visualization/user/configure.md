# Панель настройки

Панель настройки диаграммы разделена на три основные секции: **Настройка данных**, **Настройка диаграммы** и **Предварительный просмотр диаграммы**.

https://static-docs.nocobase.com/202404192019222.png

## Настройка данных

https://static-docs.nocobase.com/202404192020544.png

Выпадающий список в верхней части отображает текущую коллекцию, для которой выполняется настройка. Вы можете переключить её с помощью выпадающего меню.

После завершения настройки нажатие кнопки **«Выполнить запрос»** приведёт к извлечению данных согласно заданным параметрам. Результат отобразится в панели **«Данные»**.

### Показатели (Measures)

https://static-docs.nocobase.com/202404192023854.png

Поля-показатели содержат ключевые данные, которые будут отображаться на диаграмме. Эти поля могут быть агрегированы с помощью функций, таких как `Сумма`, `Количество`, `Среднее`, `Максимум` и `Минимум`. Вы можете добавить несколько полей-показателей и задать им псевдонимы по необходимости.

### Измерения (Dimensions)

https://static-docs.nocobase.com/202404192025717.png

Поля-измерения определяют, как данные группируются на диаграмме. Для полей типа «дата» доступны различные варианты форматирования (см. изображение). Форматирование выполняется с помощью функций базы данных (например, `date_format` в MySQL). Для других типов данных см. раздел [Преобразование данных](#Преобразование-данных).

:::info
**Форматирование измерений vs Преобразование данных**

Форматирование измерений происходит до получения итоговых данных и группирует данные по отформатированным значениям измерений. Это особенно важно при фильтрации данных по временным периодам.

Преобразование данных выполняется после получения данных и позволяет дополнительно обработать их для улучшения читаемости и внешнего вида. Такое преобразование применяется на стороне интерфейса.
:::

### Фильтр

https://static-docs.nocobase.com/202404192029597.png

Фильтры применяются к данным до группировки. Вы можете использовать переменные для динамической фильтрации:

- **Текущий пользователь**: информация о вошедшем в систему пользователе.
- **Переменные даты**: диапазоны дат, динамически рассчитываемые на основе текущей даты.
- **Текущий фильтр**: пользовательские поля фильтра, заданные в текущем блоке диаграммы. См. [Блок фильтра](./filter.md).

### Сортировка и ограничение

https://static-docs.nocobase.com/202404192034106.png

По умолчанию набор данных ограничен максимум 2000 записями.

### Кэширование

https://static-docs.nocobase.com/202404192035918.png

При включённом кэшировании диаграмма будет отображать данные из кэша. Вы можете настроить продолжительность хранения кэша по своему усмотрению.

## Настройка диаграммы

### Настройка контейнера

В этом разделе можно настроить свойства контейнера, в котором отображается диаграмма.

- **Заголовок диаграммы**
- **Показывать границу диаграммы**

https://static-docs.nocobase.com/202404192037644.png

Пример отображения заголовка диаграммы:

https://static-docs.nocobase.com/202404192048473.png

Пример отображения с границей диаграммы:

https://static-docs.nocobase.com/202404192048223.png

### Настройка диаграммы

https://static-docs.nocobase.com/202404192050696.png

- **Тип диаграммы**: здесь выбирается тип отображаемой диаграммы. В NocoBase по умолчанию используется библиотека диаграмм [Ant Design Charts](https://g2plot.antv.antgroup.com/) версии 2.x. Чтобы расширить функциональность и использовать другие библиотеки или компоненты, см. [Руководство для разработчиков](../dev/index.md).

- **Базовая настройка**: после выбора типа диаграммы появляются основные параметры визуализации, такие как поля для осей X и Y, а также поля для категорий. Эти поля выбираются из выпадающего списка, где отображаются базовые поля и псевдонимы из коллекции.

- **JSON-настройка**: если базовой настройки недостаточно, вы можете настроить дополнительные свойства компонента диаграммы с помощью JSON. Подробности см. в документации к компоненту диаграммы. Чтобы включить JavaScript-выражения в JSON-настройку, заключите их в `{{}}`. Например:

```json
{
  "label": {
    "type": "inner",
    "content": "{{ ({ percent }) => `${(percent * 100).toFixed(0)}%` }}"
  }
}
```

## Преобразование данных

https://static-docs.nocobase.com/202404192109597.png

Преобразование данных позволяет дополнительно обрабатывать полученные данные. Поддерживаемые типы данных для преобразования: `number`, `date`, `time` и `datetime`. Для полей других типов вы можете вручную назначить один из этих типов, чтобы применить соответствующие методы преобразования.

К одному полю можно применить несколько методов преобразования. Они выполняются последовательно, и результат каждого шага передаётся на следующий. Вы можете изменить порядок шагов перетаскиванием.

:::warning
Обратите внимание, что некоторые методы преобразования могут изменять исходный тип данных. При применении нескольких преобразований убедитесь, что выбираете правильный метод, исходя из типа данных после каждого шага. Например, при форматировании числа как валюты (с добавлением префикса и точности), сначала нужно настроить точность, а затем добавить префикс. Это связано с тем, что после добавления префикса число становится строкой, и дальнейшее изменение точности уже не применяется.
:::

Поддерживаемые методы преобразования:

| Тип | Метод | Описание | Результатирующий тип |
| --- | --- | --- | --- |
| **Число (number)** | Префикс | Добавляет текст в начало | строка |
| | Суффикс | Добавляет текст в конец | строка |
| | Точность | 1, 1.0, 1.00, 1.000 | число |
| | Разделитель | 100,000.00 (англ.), 100.000,00 (нем.) и т.д. | строка |
| | Проценты | Преобразует число в процент | строка |
| | Научная запись | Например: 1e+6 | число |
| | Сокращение | 1K, 1M, 1B и т.д. | строка |
| **Дата/время (datetime, date, time)** | Форматирование | Использует предустановленные или пользовательские форматы, например: YYYY-MM-DD. См. документацию [dayjs](https://day.js.org/) | строка |
| | Префикс | Добавляет текст в начало | строка |
| | Суффикс | Добавляет текст в конец | строка |
| **Строка (string)** | Преобразование типа | Преобразует строку в другой тип, например: дата/время или число | дата, число |
| | Префикс | Добавляет текст в начало | строка |
| | Суффикс | Добавляет текст в конец | строка |
