# Пользовательские переменные

<PluginInfo name="workflow-variable" link="/handbook/workflow-variable" commercial="true"></PluginInfo>

В рабочих процессах переменные могут быть объявлены или присвоены значения существующим переменным, обычно для хранения временных данных в процессе.

## Пользовательское руководство

### Создание узлов

Чтобы добавить узел "Переменная" в интерфейсе конфигурации рабочего процесса, нажмите кнопку плюса ("+") в процессе:

![Add Variable Node](https://static-docs.nocobase.com/53b1e48e777bfff7f2a08271526ef3ee.png)

### Настройка узлов

#### Режим

Как и в программировании, переменная должна быть объявлена перед ее использованием или присвоением значения. При создании узла переменной необходимо выбрать его режим. Есть два варианта:

![Select Mode](https://static-docs.nocobase.com/49d8b7b501de6faef6f303262aa14550.png)

- Объявление новой переменной: Создает новую переменную.
- Присвоение значения существующей переменной: Присваивает значение ранее объявленной переменной, фактически обновляя ее значение.

Если создаваемый узел является первым узлом переменной в процессе, доступен только режим объявления, так как нет предыдущих переменных для присвоения значений.

При присвоении значения существующей переменной необходимо выбрать целевую переменную, которая была объявлена в узле:

![Select the Variable to Assign](https://static-docs.nocobase.com/1ce8911548d7347e693d8cc8ac1953eb.png)

#### Значение

Значение переменной может быть любого типа, например, константа (строки, числа, булевые значения, даты) или другая переменная в рабочем процессе.

В режиме объявления установка значения переменной эквивалентна присвоению ей начального значения.

![Declare Initial Value](https://static-docs.nocobase.com/4ce2c508986565ad537343013758c6a4.png)

В режиме присвоения установка значения переменной изменяет значение целевой переменной на новое значение, которое будет использоваться в последующих шагах.

![Assign Trigger Variable Value to Declared Variable](https://static-docs.nocobase.com/858bae180712ad279ae6a964a77a7659.png)

### Использование значений переменных 

В узлах, следующих за узлом переменной, можно использовать значение переменной, выбрав его из группы "Результат узла". Например, в узле запроса значение переменной можно использовать как условие фильтрации запроса:

![Use Variable Value as Query Filter Condition](https://static-docs.nocobase.com/1ca91c295254ff85999a1751499f14bc.png)

### Пример

Узлы переменных особенно полезны в ветвях, где нужно вычислить новые значения или объединить их с существующими значениями (аналогично `reduce` или `concat`в программировании). Эти значения затем можно использовать после завершения ветви. Следующий пример демонстрирует, как создать объединенную строку получателей с использованием циклических и переменных узлов.

Начните с создания рабочего процесса, который активируется при обновлении данных таблицы. Этот рабочий процесс будет активирован при обновлении данных "Статья" и предварительно загрузит связанные данные "Авторы" (используются для получения получателей):

![Configure Trigger](https://static-docs.nocobase.com/93327530a93c695c637d74cdfdcd5cde.png)

Далее создайте узел переменной для хранения строки получателя:

![Recipient Variable Node](https://static-docs.nocobase.com/d26fa4a7e7ee4f34e0d8392a51c6666e.png)

Затем создайте узел ветвления цикла для итерации по авторам статьи и объединения их данных в строку получателя:

![Loop through Authors of the Article](https://static-docs.nocobase.com/083fe62c943c17a643dc47ec2872e07c.png)

Внутри циклической ветки сначала создайте узел оператора для объединения текущего автора со строкой хранения автора:

![Concatenate Recipient String](https://static-docs.nocobase.com/5d21a990162f32cb8818d27b16fd1bcd.png)

После узла оператора создайте еще один узел переменной в режиме присвоения. Выберите узел переменной получателя в качестве целевого и установите его значение на результат узла оператора:

![Assign Concatenated Recipient String to Recipient Node](https://static-docs.nocobase.com/fc40ed95dd9b61d924b7ca11b23f9482.png)

Когда циклическая ветка завершается, переменная получателя будет содержать объединенную строку всех авторов статьи. Затем можно использовать узел HTTP-запроса после цикла для вызова интерфейса отправки электронной почты, передав значение переменной получателя в качестве параметра получателя:

![Send Email to Recipient through Request Node](https://static-docs.nocobase.com/37f71aa1a63e172bcb2dce10a250947e.png)

Таким образом, с помощью циклических и переменных узлов реализуется простая функция массовой отправки электронной почты.
