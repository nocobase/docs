# Ответное сообщение

<PluginInfo name="workflow-response-message" link="/handbook/workflow-response-message"></PluginInfo>

Узел «Ответное сообщение» предназначен для доставки пользовательских сообщений клиенту, который инициирует операцию в определенных типах "workflow".

:::info{title=Note}
В настоящее время этот узел можно использовать в типах "workflow" «Преддействие» и «Пользовательское действие (синхронный режим)».
:::

## Руководство пользователя

### Создание узла

В поддерживаемых типах "workflow" вы можете вставить узел «Ответное сообщение» в любой точке "workflow". Для этого нажмите кнопку плюса («+») в "workflow", чтобы добавить узел «Ответное сообщение»:

![Добавить узел](https://static-docs.nocobase.com/eac2b3565e95e4ce59f340624062ed3d.png)

На протяжении всего процесса запроса ответные сообщения накапливаются в массиве. Когда процесс достигает узла Ответное сообщение, новое содержимое сообщения добавляется к этому массиву. После того, как сервер отправляет содержимое ответа, все сообщения в массиве доставляются вместе клиенту.

### Конфигурация узла

Содержимое сообщения структурировано как строка шаблона, что позволяет вставлять переменные. Вы можете настроить содержимое шаблона в конфигурации узла по мере необходимости:

![Конфигурация узла](https://static-docs.nocobase.com/d5fa5f4002d50baf3ba16048818fddfc.png)

По мере выполнения процесса и достижения этого узла шаблон анализируется для генерации окончательного содержимого сообщения. В приведенном выше примере конфигурации переменная «Переменные области действия / Цикл всех продуктов / Цель цикла / Продукт / Название» будет заменена определенными значениями во время фактического "workflow", например:

```
Недостаточно запасов для продукта «iPhone 14 Pro»
```

![Содержимое сообщения](https://static-docs.nocobase.com/06bd4a6b6ec499c853f0c39987f63a6a.png)

### Конфигурация процесса

Запрос статуса ответного сообщения определяется успехом или неудачей выполнения процесса. Если какой-либо узел в процессе не выполняется, весь процесс считается неудачей. В этом случае содержимое сообщения будет возвращено клиенту со статусом неудачи в качестве уведомления.

Если вам необходимо активно определить статус неудачи в процессе, вы можете использовать «Конечный узел» и настроить его как неудачу. Когда процесс достигнет этого узла, он завершится со статусом сбоя, и сообщение будет возвращено клиенту со статусом сбоя.

Если весь процесс завершится без сбоев и успешно завершится, содержимое сообщения будет возвращено клиенту со статусом успеха.

:::info{title=Note}
Если в процессе определены несколько узлов ответных сообщений, содержимое выполненных узлов будет добавлено в массив. Когда процесс завершится, все содержимое сообщения будет возвращено клиенту вместе в качестве уведомления.
:::

### Примеры использования

#### "Workflow" «Преддействие события»

В "workflow" «Преддействие события» ответное сообщение может использоваться для предоставления клиенту обратной связи после завершения процесса. Для получения дополнительных сведений см. [Перехват запроса](../triggers/pre-action.md).

#### "Workflow" "Post-Action Event"

В синхронном режиме в "workflow" "Post-Action Event" ответное сообщение отправляется клиенту после завершения процесса. В отличие от "workflow" "Pre-Action Event", где результат может отличаться, отображаемое здесь сообщение всегда является уведомлением об "успехе". Эта согласованность возникает, поскольку инициирующая операция уже была успешно выполнена, а успех связанного "workflow" не влияет на результат исходной операции.
