# HTTP API

События пользовательских действий могут быть вызваны не только действиями пользовательского интерфейса, но и вызовами HTTP API. В частности, эти события вводят новый тип операции, называемый `trigger`, для всех операций по сбору данных, что позволяет инициировать "workflow" через стандартный API операций NocoBase.

Например, "workflow", обычно вызываемый кнопкой, можно вызвать с помощью следующей команды:

```bash
curl -X POST -H 'Authorization: Bearer <your token>' -H 'X-Role: <roleName>' \
  "http://localhost:3000/api/samples:trigger/<:id>?triggerWorkflows=workflowKey"
```

Поскольку эта операция нацелена на одну запись данных, при ее вызове для существующих данных необходимо указать идентификатор строки данных, заменив часть `<:id>` URL.

При вызове API для отправки формы (например, добавления или обновления данных) можно опустить идентификатор для новых записей, но необходимо предоставить соответствующие данные в качестве контекста выполнения:

```bash
curl -X POST -H 'Authorization: Bearer <your token>' -H 'X-Role: <roleName>' -d \
  '{
    "title": "Sample 1",
    "indicator": 91
  }'
  "http://localhost:3000/api/samples:trigger?triggerWorkflows=workflowKey"
```

Для обновления формы необходимо указать как идентификатор строки данных, так и обновленные данные:

```bash
curl -X POST -H 'Authorization: Bearer <your token>' -H 'X-Role: <roleName>' -d \
  '{
    "title": "Sample 1",
    "indicator": 91
  }'
  "http://localhost:3000/api/samples:trigger/<:id>?triggerWorkflows=workflowKey"
```
Если предоставлены и идентификатор, и данные, то сначала будет загружена указанная строка данных, а затем предоставленные данные перезапишут исходную строку для создания окончательного контекста триггера.

:::warning{title="Примечание"}
Если предоставлены реляционные данные, они также будут перезаписаны. Будьте особенно осторожны при работе с реляционными данными с предзагрузочными ассоциациями, чтобы избежать непреднамеренного изменения связанных данных.
:::

Кроме того, параметр URL `triggerWorkflows` обозначает ключ(и) "workflow". Несколько "workflow" можно разделить запятыми. Вы можете получить этот ключ, наведя указатель мыши на имя "workflow" в верхней части холста "workflow":

![Метод просмотра ключа рабочего процесса](https://static-docs.nocobase.com/20240426135108.png)

После успешного вызова будет запущено событие пользовательской операции для таблицы `samples`.

:::info{title="Tip"}
Поскольку внешние вызовы API также требуют аутентификации пользователя, необходимо включить в запрос информацию об аутентификации, как и в запросы, отправляемые из стандартного интерфейса. Сюда входит заголовок `Authorization` или параметр `token` (токен, полученный после входа в систему) и заголовок `X-Role` (текущее имя роли пользователя).
:::

Если вам нужно вызвать событие для элемента данных "многие к одному" (в настоящее время не поддерживается для отношений "многие ко многим"), вы можете указать данные триггера соответствующего поля, используя `!` в параметре:

```bash
curl -X POST -H 'Authorization: Bearer <your token>' -H 'X-Role: <roleName>' \
  "http://localhost:3000/api/posts:trigger/<:id>?triggerWorkflows=workflowKey!category"
```

После успешного вызова будет запущено пользовательское событие операции для соответствующей таблицы `categories`.

:::info{title="Tip"}
При запуске события через HTTP API убедитесь, что "workflow" включен и конфигурация коллекции верна. В противном случае вызов может завершиться неудачей или привести к ошибкам.
:::
