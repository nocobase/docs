# Подпроцесс

<PluginInfo name="workflow-subflow" link="/handbook/workflow-subflow" commercial="true"></PluginInfo>

Используется для вызова других процессов в рамках рабочего процесса, позволяя текущим переменным процесса служить входными данными для подпроцесса и использовать выходные данные подпроцесса как переменные в последующих узлах текущего процесса.

Процесс вызова подпроцесса иллюстрируется на диаграмме ниже:

![20241230134634](https://static-docs.nocobase.com/20241230134634.png)

Подпроцессы могут использоваться для повторного использования общей логики процесса, такой как отправка электронных писем или SMS, или для разделения сложного процесса на несколько подпроцессов для более легкого управления и обслуживания.

## Пользовательское руководство

По сути, рабочие процессы не различают, является ли процесс подпроцессом или нет: любой рабочий процесс может вызываться другими процессами и сам вызывать другие процессы. Все рабочие процессы равны, существуя только в отношениях "вызывающий-вызываемый".

Использование подпроцессов происходит в двух местах:

1. В основном процессе: как вызывающий, через узел "Вызов рабочего процесса".
2. В подпроцессе: в качестве вызываемого объекта сохраняются переменные, которые необходимо вывести в текущем процессе через узел «Вывод процесса», которые затем могут быть использованы последующими узлами рабочего процесса, вызывающего текущий процесс.

### Узел "Вызов рабочего процесса"

#### Создание узла

В интерфейсе конфигурации рабочего процесса нажмите кнопку плюс ("+") внутри процесса, чтобы добавить узел "Вызов рабочего процесса":
  
![Add Call Workflow Node](https://static-docs.nocobase.com/20241230001323.png)

  #### Настройка узла

##### Выбор рабочего процесса

Выберите рабочий процесс для вызова, который можно быстро найти с помощью поля поиска:

![Select Workflow](https://static-docs.nocobase.com/20241230001534.png)


* Неактивные рабочие процессы все равно могут быть вызваны как подпроцессы.
* Когда текущий рабочий процесс находится в синхронном режиме, могут быть вызваны только синхронные подпроцессы.

##### Настройка переменных триггера

После выбора рабочего процесса также необходимо настроить триггерные переменные как входные данные для подпроцесса. Вы можете выбрать статические данные напрямую или выбрать переменные из текущего процесса:

![Configure Trigger Variables](https://static-docs.nocobase.com/20241230162722.png)

Для разных типов триггеров требуются разные переменные, которые можно настроить в форме по мере необходимости.

### Узел "Вывод процесса"

#### Создание узла

В вызываемом рабочем процессе добавьте узел "Вывод процесса":

![20241231002033](https://static-docs.nocobase.com/20241231002033.png)

#### Настройка узла

##### Выходное значение

Введите или выберите переменные как выходные значения. Выходные значения могут быть любого типа, включая константы, такие как строки, числа, булевые значения, даты или пользовательский JSON. Они также могут быть другими переменными в процессе.

![20241231003059](https://static-docs.nocobase.com/20241231003059.png)

Если в вызываемом рабочем процессе добавлено несколько узлов "Вывод процесса", значение будет выводиться в соответствии с последним выполненным узлом "Вывод процесса" при вызове этого рабочего процесса.

### Использование вывода процесса

Вернувшись к основному процессу, для использования выходных значений подпроцесса в других узлах ниже вызова рабочего процесса можно выбрать результат узла вызова рабочего процесса. Если подпроцесс выводит простое значение, такое как строка, число, булево значение или дата (дата в формате UTC-строки), оно может быть использовано напрямую. Если это сложный объект (например, объект в коллекции), он должен сначала быть сопоставлен через узел разбора JSON, прежде чем его свойства можно будет использовать; в противном случае он может быть использован только как целый объект.

Если подпроцесс не настроен на узел вывода процесса или не выводит никакого значения, то при использовании результата узла вызова рабочего процесса в основном процессе будет получено только нулевое значение  (`null`) 
