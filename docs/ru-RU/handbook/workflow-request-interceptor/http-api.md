# HTTP API

Предоперационное событие интегрируется во время фазы обработки запроса, что позволяет запускать его через вызов HTTP API.

Для "workflow", локально привязанных к кнопке действия, вы можете запустить их с помощью следующей команды (используя кнопку для таблицы `posts` в качестве примера):

```bash
curl -X POST -H 'Authorization: Bearer <your token>' -H 'X-Role: <roleName>' -d \
  '{
    "title": "Hello, world!",
    "content": "This is a test post."
  }'
  "http://localhost:3000/api/posts:create?triggerWorkflows=workflowKey"
```
Параметр URL `triggerWorkflows` указывает ключ "workflow", с несколькими "workflow", разделенными запятыми. Вы можете найти этот ключ, наведя указатель мыши на имя "workflow" в верхней части холста "workflow":

![Как просмотреть ключ рабочего процесса](https://static-docs.nocobase.com/20240426135108.png)

После выполнения указанной выше команды будет запущено соответствующее событие предварительной операции для таблицы `posts`. После того, как связанный "workflow" будет обработан синхронно, данные будут созданы и возвращены как обычно.

Если настроенный "workflow" достигнет «Завершения процесса», запрос будет перехвачен, и данные не будут созданы, следуя той же логике, что и операция интерфейса. Если статус конечного узла установлен на сбой, код статуса ответа будет `400`; в случае успеха он будет `200`.

Если узел "Response Message" настроен до конечного узла, сгенерированное сообщение будет включено в ответ. Структура сообщения об ошибке следующая:

```json
{
  "errors": [
    {
      "message": "message from 'Response Message' node"
    }
  ]
}
```

Если «конечный узел» настроен успешно, структура сообщения выглядит следующим образом:

```json
{
  "messages": [
    {
      "message": "message from 'Response Message' node"
    }
  ]
}
```

:::info{title=Note}
Поскольку в "workflow" можно добавлять несколько узлов «Ответное сообщение», структура данных возвращаемого сообщения представляется в виде массива.
:::

Если событие перед операцией настроено глобально, нет необходимости указывать соответствующий "workflow" с помощью параметра URL `triggerWorkflows` при вызове HTTP API. Простой вызов соответствующей операции таблицы данных автоматически запустит ее.

```bash
curl -X POST -H 'Authorization: Bearer <your token>' -H 'X-Role: <roleName>' -d \
  '{
    "title": "Hello, world!",
    "content": "This is a test post."
  }'
  "http://localhost:3000/api/posts:create"
```

:::info{title="Примечание"}
При запуске событий после операции через вызов HTTP API убедитесь, что "workflow" включен и конфигурация таблицы данных соответствует ожидаемой настройке. В противном случае вызов может завершиться неудачей или привести к ошибкам.
:::
