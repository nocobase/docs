# Операция "Дублирование"

Операция "Дублирование" позволяет пользователям копировать строку данных для создания новых записей, предлагая два метода: **прямое дублирование** и **копирование в форму с последующим заполнением**.

## Прямое дублирование

![Прямое дублирование](https://static-docs.nocobase.com/2c0ac5d1a539de4b72b49b7d966d8c09.png)

- По умолчанию данные копируются напрямую.
- Целевая таблица: Таблица, в которую будут добавлены скопированные данные. В случаях с наследованием можно копировать в дочернюю таблицу, но прямое дублирование добавляет данные только в текущую таблицу.
- Шаблонные поля: Определяют, какие поля будут скопированы (можно выбрать все). Эта настройка обязательна.

После завершения конфигурации достаточно нажать кнопку для дублирования данных.

## Копирование в форму с заполнением

Настроенные шаблонные поля заполнят форму значениями по умолчанию, которые можно изменить перед отправкой.

Можно выбрать либо текущую таблицу, либо дочернюю таблицу в качестве цели для добавления скопированных данных.

![Копирование в форму](https://static-docs.nocobase.com/a072aa572fd0a0fe643eadf95471da2a.png)

**Настройка шаблонных полей:** Значения выбранных полей будут использованы как значения по умолчанию в форме.

![Настройка шаблонных полей](https://static-docs.nocobase.com/8032fa2025180ade275da55b97774b4d.png)

**Пример:** Отношение "Накладная" (o2m) дублируется. Его полевой компонент можно изменить на подформу, где можно настроить поля подформы.

![Отношение накладной](https://static-docs.nocobase.com/b13c9287bae8601646727a2e78b81be7.png)

**Синхронизация полей формы:** После настройки формы нажмите кнопку синхронизации - это автоматически выберет все настроенные поля (примечание: после каждого изменения конфигурации полей синхронизацию нужно выполнять вручную). После синхронизации можно дополнительно настроить шаблонные поля.

![Синхронизация полей формы](https://static-docs.nocobase.com/156b6d8d741521e63d12e49092414d58.png)

При нажатии кнопки "Дублировать" откроется всплывающее окно с формой, заполненной значениями по умолчанию. Данные можно изменить перед отправкой для завершения копирования.

![Пример операции дублирования](https://static-docs.nocobase.com/1c0a0ae0c59971f48b2282a68831d44b.png)

Полный пример ниже демонстрирует настройку операции дублирования в списке заказов.

![Пример дублирования списка заказов](https://static-docs.nocobase.com/fa8a89abf0ba136df04b6d0d838eae4e.gif)

## Логика обработки для разных типов отношений

Поля с разными типами отношений (копирование, ссылка, предзагрузка) обрабатываются по-разному. Выбор полевых компонентов также влияет на логику обработки.

- **Копирование**:
  - Стандартные поля дублируются
  - Отношения hasOne/hasMany только копируются
  - Все дочерние поля доступны для выбора

- **Ссылка**:
  - Отношения belongsTo/belongsToMany являются ссылочными
  - Можно преобразовать в копирование (например, изменив компонент с select на sub-form)

- **Предзагрузка**:
  - Отношения внутри ссылочных полей
  - Могут стать ссылками или копиями после изменения компонентов

## Особенности

- При копировании исключаются внешние ключи и первичные ключи скопированных отношений
- При ссылках и предзагрузке первичные ключи сохраняются
- Кнопка синхронизации автоматически анализирует конфигурацию формы и применяет соответствующую логику копирования
- После изменений в форме синхронизацию нужно выполнять вручную
