# Аутентификация через WeCom

<PluginInfo commercial="true" name="wecom"></PluginInfo>

## Обзор

Плагин **WeCom** позволяет пользователям входить в NocoBase с использованием своих учетных записей WeCom.

## Активация плагина

![](https://static-docs.nocobase.com/202406272056962.png)

## Создание и настройка приложения WeCom

1. Войдите в консоль администратора WeCom и создайте кастомное приложение:
![](https://static-docs.nocobase.com/202406272101321.png)
![](https://static-docs.nocobase.com/202406272102087.png)

2. В деталях приложения найдите раздел "Авторизованный вход WeCom":
![](https://static-docs.nocobase.com/202406272104655.png)

3. Установите домен обратного вызова на домен приложения NocoBase:
![](https://static-docs.nocobase.com/202406272105662.png)

4. Настройте веб-авторизацию OAuth 2.0:
![](https://static-docs.nocobase.com/202406272107063.png)
![](https://static-docs.nocobase.com/202406272107899.png)

5. Добавьте IP-адреса NocoBase в доверенные:
![](https://static-docs.nocobase.com/202406272108834.png)
![](https://static-docs.nocobase.com/202406272109805.png)

## Получение ключей

1. Скопируйте ID предприятия:
![](https://static-docs.nocobase.com/202406272111637.png)

2. Получите AgentId и Secret из настроек приложения:
![](https://static-docs.nocobase.com/202406272122322.png)

## Настройка аутентификации в NocoBase

1. Перейдите в управление плагинами аутентификации:
![](https://static-docs.nocobase.com/202406272115044.png)

2. Добавьте новый метод WeCom:
![](https://static-docs.nocobase.com/202406272115805.png)

### Параметры конфигурации

![](https://static-docs.nocobase.com/202412041459250.png)

| Параметр                                                                 | Описание                                                                 | Требуемая версия |
|--------------------------------------------------------------------------|--------------------------------------------------------------------------|------------------|
| Создавать нового пользователя при несовпадении номера телефона          | Автоматическая регистрация новых пользователей                          | -                |
| ID компании                                                              | ID предприятия из консоли WeCom                                         | -                |
| AgentId                                                                  | Из настроек приложения WeCom                                            | -                |
| Secret                                                                   | Из настроек приложения WeCom                                            | -                |
| Домен                                                                   | Домен текущего приложения                                               | -                |
| Ссылка для редиректа                                                    | Куда перенаправлять после входа                                         | `v1.4.0`         |
| Автоматический вход                                                     | Вход без подтверждения в браузере WeCom (только для одного аутентификатора) | `v1.4.0`         |
| Ссылка на главную страницу                                              | Основная ссылка приложения                                              | -                |

## Настройка главной страницы приложения

Для версий `v1.4.0+` при включении "Автоматического входа" ссылка может быть упрощена до формата: `https://<url>/<path>`.

Пример:
- Мобильная версия: `https://example.nocobase.com/m`
- Десктоп: `https://example.nocobase.com/admin`

Добавьте эту ссылку в поле главной страницы приложения WeCom:
![](https://static-docs.nocobase.com/202406272123631.png)
![](https://static-docs.nocobase.com/202406272123048.png)

## Процесс входа

1. На странице входа нажмите кнопку для входа через WeCom:
![](https://static-docs.nocobase.com/202406272124608.png)

:::warning
Первая авторизация должна быть выполнена в клиенте WeCom из-за ограничений на передачу конфиденциальных данных.
:::

## Первичная авторизация

1. Откройте клиент WeCom
2. Перейдите в рабочий стол
3. Найдите ваше приложение внизу списка
4. Нажмите для завершения авторизации

<img src="https://static-docs.nocobase.com/202406272131113.png" width="400" />
