# Копирование

<PluginInfo name="action-duplicate"></PluginInfo>

## Обзор

Функция копирования позволяет создавать новые записи на основе существующих. Поддерживаются два режима: прямое копирование и копирование в форму с возможностью редактирования.

## Установка

Плагин встроенный, установка не требуется.

## Режимы копирования

### Прямое копирование

![](https://static-docs.nocobase.com/2c0ac5d1a539de4b72b49b7d966d8c09.png)

- По умолчанию используется режим прямого копирования;
- Целевая коллекция: указывается, куда будет сохраняться копируемая запись (в случае унаследованных таблиц можно копировать в подтаблицу. Прямое копирование работает только в пределах текущей таблицы);
- Поля данных: указываются поля, которые необходимо скопировать. Обязательны для выбора.

После настройки достаточно нажать кнопку, чтобы выполнить копирование.

### Копирование в форму с возможностью редактирования

Выбранные поля из шаблона будут автоматически подставлены в форму как значения по умолчанию, которые можно изменить перед сохранением.

Можно копировать данные как в текущую таблицу, так и в подтаблицу (в случае наследования).

![](https://static-docs.nocobase.com/a072aa572fd0a0fe643eadf95471da2a.png)

Настройка полей шаблона: только выбранные поля будут отображаться в форме с предзаполненными значениями.

![](https://static-docs.nocobase.com/8032fa2025180ade275da55b97774b4d.png)

Поле связи "Накладная" (отношение o2m) скопировано, и его компонент отображается как подформа. Поля внутри подформы также настраиваются.

![](https://static-docs.nocobase.com/b13c9287bae8601646727a2e78b81be7.png)

#### Синхронизация с полями формы

- Система автоматически распознаёт поля, уже настроенные в текущем блоке формы, как поля шаблона;
- После изменения полей в блоке формы (например, компонентов связи), можно снова открыть настройки шаблона и нажать **"Синхронизировать с формой"** для актуализации.

![](https://static-docs.nocobase.com/156b6d8d741521e63d12e49092414d58.png)

Шаблонные данные автоматически подставляются в форму, где их можно отредактировать перед сохранением.

![](https://static-docs.nocobase.com/1c0a0ae0c59971f48b2282a68831d44b.png)

Ниже пример настройки копирования для списка заказов:

![](https://static-docs.nocobase.com/fa8a89abf0ba136df04b6d0d838eae4e.gif)

### Дополнительная информация

#### Копирование, ссылки и предзагрузка

Разные типы полей (с разными типами связей) требуют разной логики обработки: копирование, ссылка или предзагрузка. Также важны используемые компоненты поля связи: Select и Record picker используют ссылки, Sub-form и Sub-table — копирование.

- **Копирование**:
  - Обычные поля копируются;
  - Для `hasOne` и `hasMany` — только копирование (эти типы связей не могут использовать Select/Record picker, только Sub-form/Sub-table);
    - Изменение компонентов этих полей не влияет на тип копирования;
    - Все вложенные поля доступны для выбора.

- **Ссылки**:

  - `belongsTo` и `belongsToMany` обрабатываются как ссылки;
  - **Ссылки можно превратить в копию**, например, если компонент поля изменится с Select на подформу — связь станет копией, и все вложенные поля станут доступными для выбора.

- **Предзагрузка**:

  - Поля внутри ссылочных связей могут быть предзагружены;
  - Изменения предзагружаемых полей могут изменить логику на копирование или ссылку.

#### Выбрать всё

- По умолчанию выбраны все доступные поля для копирования и ссылок.

#### Исключения при использовании шаблонов данных

Из копируемых полей исключаются:
- Первичные ключи связей (но не ссылок и предзагрузок)
- Внешние ключи
- Уникальные поля
- Поля сортировки
- Автоматически генерируемые поля
- Пароли
- Автор записи
- Дата создания
- Кто обновил
- Дата обновления

#### Синхронизация с формой

- Все поля, добавленные в блок формы, автоматически определяются как поля шаблона;
- После изменения структуры формы, снова откройте настройки шаблона и нажмите **"Синхронизировать с формой"**.
