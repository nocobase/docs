# Переменные и секреты

## Введение

Центральное управление и настройка переменных среды и секретов для безопасного хранения конфиденциальных данных, повторного использования конфигурационных данных и изоляции конфигураций сред.

## Отличия от `.env`

| Характеристика               | Файл `.env`                                      | Динамические переменные среды                   |
|-----------------------------|--------------------------------------------------|------------------------------------------------|
| Место хранения              | Хранится в файле `.env` в корневой директории проекта | Хранится в таблице `environmentVariables` в базе данных |
| Метод загрузки              | Загружается в `process.env` с помощью инструментов, таких как `dotenv`, при запуске приложения | Динамически считывается и загружается в `app.environment` при запуске приложения |
| Метод изменения             | Требует прямого редактирования файла; приложение необходимо перезапустить, чтобы изменения вступили в силу | Поддерживает изменение во время выполнения; изменения вступают в силу немедленно после перезагрузки конфигурации приложения |
| Изоляция сред               | Для каждой среды (разработка, тестирование, продакшн) требуется отдельное ведение файлов `.env` | Для каждой среды требуется отдельное ведение данных в таблице `environmentVariables` |
| Применимые сценарии         | Подходит для фиксированных статических конфигураций, например, основной информации о базе данных приложения | Подходит для динамических конфигураций, требующих частой настройки или связанных с бизнес-логикой, например, внешние базы данных, информация о хранилище файлов и т.д. |

## Установка

Встроенный плагин — отдельная установка не требуется.

## Использование

### Повторное использование конфигурационных данных

Например, если в нескольких местах рабочего процесса требуются узлы электронной почты и настройка SMTP, общую конфигурацию SMTP можно сохранить в переменных среды.

https://static-docs.nocobase.com/20250102181045.png

### Хранение конфиденциальных данных

Хранение различных конфигурационных данных внешних баз данных, ключей облачного хранилища файлов и т.д.

https://static-docs.nocobase.com/20250102103513.png

### Изоляция конфигурации сред

В различных средах, таких как разработка, тестирование и продакшн, используются независимые стратегии управления конфигурацией, чтобы гарантировать, что конфигурации и данные каждой среды не мешают друг другу. Каждая среда имеет свои собственные независимые настройки, переменные и ресурсы, что предотвращает конфликты между средами разработки, тестирования и продакшна и обеспечивает ожидаемую работу системы в каждой среде.

Например, конфигурация служб хранения файлов может отличаться между средами разработки и продакшна, как показано ниже:

**Среда разработки**
```
FILE_STORAGE_OSS_BASE_URL=dev-storage.nocobase.com
FILE_STORAGE_OSS_BUCKET=dev-storage
```

**Продакшн-среда**
```
FILE_STORAGE_OSS_BASE_URL=prod-storage.nocobase.com
FILE_STORAGE_OSS_BUCKET=prod-storage
```

## Управление переменными среды

https://static-docs.nocobase.com/20250102155314.png

### Добавление переменных среды

Поддерживает добавление как по одной, так и пакетное.

Поддерживает хранение в виде обычного текста и зашифрованного.

https://static-docs.nocobase.com/20250102155509.png

#### Добавление одной переменной

https://static-docs.nocobase.com/20250102155731.png

#### Пакетное добавление

https://static-docs.nocobase.com/20250102155258.png

## Примечания

### Перезапуск приложения

После изменения или удаления переменных среды в верхней части появится подсказка о необходимости перезапуска приложения. Изменения переменных среды вступят в силу только после перезапуска приложения.

https://static-docs.nocobase.com/20250102155007.png

### Зашифрованное хранение

Для переменных среды с зашифрованными данными используется симметричное шифрование AES. Ключ шифрования и расшифровки (PRIVATE KEY) хранится в директории хранилища. Пожалуйста, храните его в безопасности; если он будет утерян или перезаписан, зашифрованные данные не смогут быть расшифрованы.

```
./storage/environment-variables/<имя_приложения>/aes_key.dat
```

## Поддерживаемые в настоящее время плагины для переменных среды

- **Действие: Произвольный запрос**  
  https://static-docs.nocobase.com/20250102180751.png

- **Аутентификация: CAS**  
  https://static-docs.nocobase.com/20250102160129.png

- **Аутентификация: DingTalk**  
  https://static-docs.nocobase.com/20250102160205.png

- **Аутентификация: LDAP**  
  https://static-docs.nocobase.com/20250102160312.png

- **Аутентификация: OIDC**  
  https://static-docs.nocobase.com/20250102160426.png

- **Аутентификация: SAML**  
  https://static-docs.nocobase.com/20250102160652.png

- **Аутентификация: WeCom**  
  https://static-docs.nocobase.com/20250102160758.png

- **Источник данных: Внешняя MariaDB**  
  https://static-docs.nocobase.com/20250102160935.png

- **Источник данных: Внешняя MySQL**  
  https://static-docs.nocobase.com/20250102173602.png

- **Источник данных: Внешняя Oracle**  
  https://static-docs.nocobase.com/20250102174153.png

- **Источник данных: Внешняя PostgreSQL**  
  https://static-docs.nocobase.com/20250102175630.png

- **Источник данных: Внешний SQL Server**  
  https://static-docs.nocobase.com/20250102175814.png

- **Источник данных: KingbaseES**  
  https://static-docs.nocobase.com/20250102175951.png

- **Источник данных: REST API**  
  https://static-docs.nocobase.com/20250102180109.png

- **Хранилище файлов: Локальное**  
  https://static-docs.nocobase.com/20250102161114.png

- **Хранилище файлов: Aliyun OSS**  
  https://static-docs.nocobase.com/20250102161404.png

- **Хранилище файлов: Amazon S3**  
  https://static-docs.nocobase.com/20250102163730.png

- **Хранилище файлов: Tencent COS**  
  https://static-docs.nocobase.com/20250102173109.png

- **Хранилище файлов: S3 Pro**  
  Не адаптировано

- **Карты: AMap**  
  https://static-docs.nocobase.com/20250102163803.png

- **Карты: Google**  
  https://static-docs.nocobase.com/20250102171524.png

- **Настройки электронной почты**  
  Не адаптировано

- **Уведомления: Электронная почта**  
  https://static-docs.nocobase.com/20250102164059.png

- **Публичные формы**  
  https://static-docs.nocobase.com/20250102163849.png

- **Системные настройки**  
  https://static-docs.nocobase.com/20250102164139.png

- **Проверка: SMS от Aliyun**  
  https://static-docs.nocobase.com/20250102164247.png

- **Проверка: SMS от Tencent**  
  https://static-docs.nocobase.com/20250102165814.png

- **Рабочий процесс**  
  https://static-docs.nocobase.com/20250102180537.png
