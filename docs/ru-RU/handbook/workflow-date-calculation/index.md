# Расчет даты

<PluginInfo name="workflow-date-calculation" link="/handbook/workflow-date-calculation" commercial="true"></PluginInfo>

Узел расчета даты предлагает набор из девяти мощных функций, позволяющих выполнять такие операции, как добавление или вычитание периодов времени, форматирование строк времени и преобразование единиц длительности. Каждая функция разработана с определенными типами входных и выходных значений и может легко интегрировать результаты из других узлов в качестве переменных параметров. 
Объединяя эти функции через конвейер вычислений, вы можете добиться желаемого результата с точностью.

## Руководство пользователя

### Создание узла

Чтобы добавить узел «Вычисление даты» в интерфейсе конфигурации "workflow", просто нажмите кнопку «плюс» («+») в процессе:

![Создать узел для вычисления даты](https://static-docs.nocobase.com/[图片].png)

### Конфигурация узла

![Конфигурация узла для вычисления даты](https://static-docs.nocobase.com/20240817184423.png)

#### Входное значение

Входные значения могут быть как переменными, так и константами даты. Переменные могут включать данные, которые запускают рабочий процесс или результаты из узлов выше по течению. Константы могут быть любой выбранной датой.

#### Тип входного значения
  
Тип входного значения определяет, как будет обрабатываться вход, и делится на два типа:

* Тип даты: сюда входят любые входные данные, которые можно преобразовать в формат даты и времени, например числовые временные метки или строки, представляющие время.

* Тип числа: тип входного значения влияет на выбор шагов расчета времени, поэтому крайне важно выбрать правильный тип.

#### Шаги расчета

Каждый шаг расчета состоит из определенной функции и ее конфигурации параметров. Конструкция конвейера позволяет передавать выходные данные одной функции непосредственно в следующую, обеспечивая последовательность вычислений и преобразований времени.

Тип выходных данных после каждого шага фиксирован, что, в свою очередь, определяет функции, доступные для следующего шага. Если типы совместимы, расчет продолжается; если нет, результат текущего шага становится конечным выходом узла.

### Функции расчета

#### Добавить диапазон

- Допустимый тип входного значения: Дата
- Параметры:
 - Сумма для прибавления, которая может быть числовым значением или переменной внутри узла.
 - Единица времени (например, дни, часы).
- Тип выходного значения: Дата
- Пример: если входное значение равно `2024-7-15 00:00:00`, сумма равна `1`, а единица измерения — «дни», выход будет равен `2024-7-16 00:00:00`.

#### Вычесть диапазон

- Допустимый тип входного значения: Дата
- Параметры:
 - Сумма для вычитания, которая может быть числовым значением или переменной внутри узла.
 - Единица времени (например, дни, часы).
- Тип выходного значения: Дата
- Пример: если входное значение равно `2024-7-15 00:00:00`, сумма равна `1`, а единица измерения - "дни", выходное значение будет равно `2024-7-14 00:00:00`.

#### Получить разницу с другим значением данных

- Принятый тип входного значения: Дата
- Параметры:
 - Дата для сравнения, которая может быть константой или переменной в контексте "workflow".
 - Единица времени (например, дни, часы).
 - Следует ли брать абсолютное значение.
- Параметры округления: сохранить десятичные дроби, округлить, округлить в большую или меньшую сторону.
- Тип выходного значения: числовой
- Пример: если входное значение равно `2024-7-15 00:00:00`, и вы сравниваете его с `2024-7-16 06:00:00`, используя в качестве единицы измерения "дни", не принимая абсолютное значение и сохраняя десятичные знаки, выход будет равен `-1,25`.

:::info{title=Примечание}
Если выбраны и абсолютное значение, и округление, сначала применяется абсолютное значение, а затем округление.
:::

#### Получить значение в определенной единице измерения входной даты

- Допустимый тип входного значения: Дата
- Параметры:
 - Единица времени (например, дни, часы).
- Тип выходного значения: числовой
- Пример: если входное значение равно `2024-7-15 00:00:00`, а единица измерения - "дни", выход будет равен `15`.

#### Установить время начала блока

- Принятый тип входного значения: Дата
- Параметры:
- Единица времени (например, дни, часы).
- Тип выходного значения: Дата
- Пример: Если входное значение равно `2024-7-15 14:26:30`, а единица измерения — «дни», выход будет равен `2024-7-15 00:00:00`.

#### Установить время окончания блока

- Принятый тип входного значения: Дата
- Параметры:
- Единица времени (например, дни, часы).
- Тип выходного значения: Дата
- Пример: Если входное значение равно `2024-7-15 14:26:30`, а единица измерения — «дни», выход будет равен `2024-7-15 23:59:59`.

#### Високосный год

- Допустимый тип входного значения: Дата
- Параметры: Нет
- Выходной тип значения: Логический
- Пример: Если входное значение равно `2024-7-15 14:26:30`, выходное значение будет `true`.

#### Формат в строку

- Допустимый тип входного значения: Дата
- Параметры:
- Формат, как указано в [Day.js: Формат](https://day.js.org/docs/zh-CN/display/format).
- Выходной тип значения: Строка
- Пример: Если входное значение равно `2024-7-15 14:26:30`, а формат равен `время равно YYYY/MM/DD HH:mm:ss`, выходное значение будет `время равно 2024/07/15 14:26:30`.

#### Преобразование единиц

- Допустимый тип входного значения: Числовой
- Параметры:
- Исходная единица времени.
- Целевая единица времени.
- Параметры округления: сохранить десятичные знаки, округлить, округлить в большую или меньшую сторону.
- Тип выходного значения: Числовой
- Пример: если входное значение равно `2`, исходная единица — «недели», целевая единица — «дни», и десятичные знаки не сохраняются, выходное значение будет равно `14`.

### Пример

![Пример узла расчета даты](https://static-docs.nocobase.com/20240817184137.png)

Представьте себе рекламную акцию, в которой вы хотите автоматически установить время окончания акции при создании продукта. Это время окончания будет последним днем следующей недели в 23:59:59. Для этого можно создать две функции времени и связать их в конвейер:

1. Рассчитать дату для следующей недели.
2. Скорректировать дату на последний день этой недели в 23:59:59.

Сделав это, вы сгенерируете желаемое значение времени, которое затем можно передать следующему узлу, например узлу изменения таблицы данных, чтобы установить время окончания акции в базе данных.
