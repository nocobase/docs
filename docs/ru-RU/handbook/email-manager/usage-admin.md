# Менеджер электронной почты: Настройка администратора

<PluginInfo commercial="true" name="email-manager"></PluginInfo>

## Введение
Плагин Менеджер электронной почты — это эффективный и удобный инструмент, поддерживающий авторизацию через Gmail и Outlook. Он интегрирует функции управления и отправки писем в различные блоки и страницы. Простая настройка авторизации позволяет пользователям осуществлять централизованное управление несколькими учётными записями и наслаждаться бесперебойным обменом электронными письмами.

## Процесс настройки

После активации плагина электронной почты администратор должен завершить настройку, прежде чем обычные пользователи смогут подключить свои учётные записи к NocoBase. В настоящее время поддерживаются только учётные записи Outlook и Gmail через авторизацию. Прямая интеграция с учётными записями Microsoft и Google недоступна.

Основой настройки является конфигурация API-аутентификации с поставщиками почтовых услуг. Администратор должен выполнить следующие шаги для обеспечения правильной работы плагина:

1. **Получение данных аутентификации от поставщиков**  
   - Войдите в консоль разработчика почтового сервиса (например, Google Cloud Console или Microsoft Azure Portal).  
   - Создайте новое приложение или проект, включив службы API Gmail или Outlook.  
   - Получите идентификатор клиента (Client ID) и секрет клиента (Client Secret).  
   - Настройте URI перенаправления, чтобы он соответствовал обратному адресу плагина в NocoBase.  

2. **Настройка поставщика услуг**  
   - Перейдите на страницу настройки плагина.  
   - Введите необходимые данные аутентификации API, включая идентификатор и секрет клиента, чтобы обеспечить правильную интеграцию с поставщиком почтовых услуг.  

3. **Авторизованный вход**  
   - Пользователи входят в свои учётные записи электронной почты через протокол OAuth.  
   - Плагин автоматически создаёт и сохраняет токены авторизации пользователя для последующих вызовов API и операций с электронной почтой.  

4. **Интеграция электронной почты**  
   - После успешной авторизации учётные записи электронной почты пользователей интегрируются в NocoBase.  
   - Плагин синхронизирует данные электронной почты и предоставляет функции управления и отправки.  

5. **Использование функций электронной почты**  
   - Пользователи могут просматривать, управлять и отправлять электронные письма непосредственно в платформе.  
   - Все операции выполняются через вызовы API к поставщику почтовых услуг, обеспечивая синхронизацию в реальном времени и эффективное общение.  

Следуя описанному процессу, плагин электронной почты NocoBase обеспечивает эффективное и безопасное управление электронной почтой. Если у вас возникнут проблемы во время настройки, обратитесь к соответствующей документации или свяжитесь со службой технической поддержки за помощью.

## Настройка плагина

### Включение плагина электронной почты

1. Перейдите на страницу управления плагинами.  
2. Найдите плагин «Менеджер электронной почты» и включите его.  

### Настройка поставщика электронной почты

После включения плагина электронной почты приступите к настройке поставщика электронной почты. В настоящее время поддерживаются службы электронной почты Google и Microsoft. Нажмите «Настройки» → «Настройки электронной почты», чтобы перейти на страницу настройки.

![](https://static-docs.nocobase.com/mail-1733818617187.png)

![](https://static-docs.nocobase.com/mail-1733818617514.png)

Для каждого поставщика требуется идентификатор и секрет клиента. В следующих разделах подробно описано, как получить эти параметры.

## Настройка Google

### Предварительные требования

1. Чтобы пользователи могли подключить учётные записи Gmail к NocoBase, разверните NocoBase на сервере, который поддерживает доступ к сервисам Google, поскольку бэкенд будет вызывать API Google.

### Регистрация учётной записи

1. Откройте [Google Cloud Console](https://console.cloud.google.com/welcome).  
2. Согласитесь с условиями при первом доступе.  

![](https://static-docs.nocobase.com/mail-1733818617807.png)

### Создание приложения

1. Нажмите «Выбрать проект» в верхней части  

![](https://static-docs.nocobase.com/mail-1733818618126.png)

2. Нажмите «НОВЫЙ ПРОЕКТ» в модальном окне  

![](https://static-docs.nocobase.com/mail-1733818618329.png)

3. Заполните сведения о проекте  

![](https://static-docs.nocobase.com/mail-1733818618510.png)

4. Выберите созданный проект  

![](https://static-docs.nocobase.com/mail-1733818618828.png)

![](https://static-docs.nocobase.com/mail-1733818619044.png)

### Включение API Gmail

1. Нажмите кнопку «API и службы»  

![](https://static-docs.nocobase.com/mail-1733818619230.png)

2. Перейдите на панель «API и службы»  

![](https://static-docs.nocobase.com/mail-1733818619419.png)

3. Найдите «mail»  

![](https://static-docs.nocobase.com/mail-1733818619810.png)

![](https://static-docs.nocobase.com/mail-1733818620020.png)

4. Нажмите «ВКЛЮЧИТЬ», чтобы активировать API Gmail  

![](https://static-docs.nocobase.com/mail-1733818620589.png)

![](https://static-docs.nocobase.com/mail-1733818620885.png)

### Настройка экрана согласия OAuth

1. Нажмите «Экран согласия OAuth» слева  

![](https://static-docs.nocobase.com/mail-1733818621104.png)

2. Выберите «Внешний»  

![](https://static-docs.nocobase.com/mail-1733818621322.png)

3. Заполните сведения о проекте (отображаются на странице авторизации) и сохраните  

![](https://static-docs.nocobase.com/mail-1733818621538.png)

4. Введите контактную информацию разработчика и нажмите «Продолжить»  

![](https://static-docs.nocobase.com/mail-1733818621749.png)

5. Нажмите «Продолжить»  

![](https://static-docs.nocobase.com/mail-1733818622121.png)

6. Добавьте тестовых пользователей для предварительного тестирования  

![](https://static-docs.nocobase.com/mail-1733818622332.png)

![](https://static-docs.nocobase.com/mail-1733818622537.png)

7. Нажмите «Продолжить»  

![](https://static-docs.nocobase.com/mail-1733818622753.png)

8. Просмотрите сводную информацию и вернитесь на панель управления  

![](https://static-docs.nocobase.com/mail-1733818622984.png)

### Создание учётных данных

1. Нажмите «Учётные данные» слева  

![](https://static-docs.nocobase.com/mail-1733818623168.png)

2. Нажмите «СОЗДАТЬ УЧЁТНЫЕ ДАННЫЕ» и выберите «Идентификатор клиента OAuth»  

![](https://static-docs.nocobase.com/mail-1733818623386.png)

3. Выберите «Веб-приложение»  

![](https://static-docs.nocobase.com/mail-1733818623758.png)

4. Введите сведения о приложении  

![](https://static-docs.nocobase.com/mail-1733818623992.png)

5. Введите домен окончательного развертывания (например, тестовый адрес NocoBase)  

![](https://static-docs.nocobase.com/mail-1733818624188.png)

6. Добавьте авторизованный URI обратного вызова: `домен + "/admin/settings/mail/oauth2"`. Пример: `https://pr-1-mail.test.nocobase.com/admin/settings/mail/oauth2`

![](https://static-docs.nocobase.com/mail-1733818624449.png)

7. Нажмите «Создать», чтобы просмотреть сведения OAuth  

![](https://static-docs.nocobase.com/mail-1733818624701.png)

8. Скопируйте идентификатор и секрет клиента на страницу настройки электронной почты  

![](https://static-docs.nocobase.com/mail-1733818624923.png)

9. Нажмите «Сохранить», чтобы завершить настройку

### Публикация приложения

После завершения настройки и тестирования перейдите к публикации приложения: проверьте права пользователя и отправьте приложение на проверку.

1. Нажмите меню «Экран согласия OAuth»

![](https://static-docs.nocobase.com/mail-1733818625124.png)

2. Нажмите кнопку «ИЗМЕНИТЬ ПРИЛОЖЕНИЕ», затем — «СОХРАНИТЬ И ПРОДОЛЖИТЬ» внизу

![](https://static-docs.nocobase.com/mail-1735633686380.png)

![](https://static-docs.nocobase.com/mail-1735633686750.png)

3. Нажмите кнопку «ДОБАВИТЬ ИЛИ УДАЛИТЬ ОБЛАСТИ ДОСТУПА (SCOPES)», чтобы выбрать права пользователя

![](https://static-docs.nocobase.com/mail-1735633687054.png)

4. Введите в поле поиска «Gmail API», затем выберите «Gmail API» (убедитесь, что значение области доступа — «https://mail.google.com/»)

![](https://static-docs.nocobase.com/mail-1735633687283.png)

5. Нажмите кнопку «ОБНОВИТЬ» внизу, чтобы сохранить

![](https://static-docs.nocobase.com/mail-1735633687536.png)

6. Нажмите «СОХРАНИТЬ И ПРОДОЛЖИТЬ» внизу каждой страницы, затем — «ВЕРНУТЬСЯ НА ПАНЕЛЬ УПРАВЛЕНИЯ», чтобы вернуться на главную страницу консоли

![](https://static-docs.nocobase.com/mail-1735633687744.png)

![](https://static-docs.nocobase.com/mail-1735633687912.png)

![](https://static-docs.nocobase.com/mail-1735633688075.png)

7. После нажатия кнопки «ОПУБЛИКОВАТЬ ПРИЛОЖЕНИЕ» появится страница подтверждения с перечнем требований для публикации. Нажмите «ПОДТВЕРДИТЬ»

![](https://static-docs.nocobase.com/mail-1735633688257.png)

8. Вернувшись на страницу консоли, вы увидите, что статус публикации — «В рабочей среде»

![](https://static-docs.nocobase.com/mail-1735633688425.png)

9. Нажмите кнопку «ГОТОВИТЬСЯ К ПРОВЕРКЕ», заполните необходимую информацию и нажмите «СОХРАНИТЬ И ПРОДОЛЖИТЬ» (данные на изображении приведены для справки)

![](https://static-docs.nocobase.com/mail-1735633688634.png)

![](https://static-docs.nocobase.com/mail-1735633688827.png)

10. Продолжайте заполнять обязательную информацию (данные на изображении приведены для справки)

![](https://static-docs.nocobase.com/mail-1735633688993.png)

11. Нажмите кнопку «СОХРАНИТЬ И ПРОДОЛЖИТЬ»

![](https://static-docs.nocobase.com/mail-1735633689159.png)

12. Нажмите кнопку «ОТПРАВИТЬ НА ПРОВЕРКУ», чтобы отправить на модерацию

![](https://static-docs.nocobase.com/mail-1735633689318.png)

13. Дождитесь результатов проверки

![](https://static-docs.nocobase.com/mail-1735633689494.png)

14. Если проверка не пройдена, пользователи могут нажать на небезопасную ссылку, чтобы авторизоваться

![](https://static-docs.nocobase.com/mail-1735633689645.png)

## Настройка Microsoft

### Регистрация учётной записи

1. Перейдите на https://azure.microsoft.com/en-us/pricing/purchase-options/azure-account

2. Войдите в свою учётную запись Microsoft

![](https://static-docs.nocobase.com/mail-1733818625779.png)

### Создание клиента (Tenant)

1. Перейдите на https://azure.microsoft.com/zh-cn/pricing/purchase-options/azure-account?icid=azurefreeaccount и войдите в свою учётную запись

2. Заполните основную информацию и получите код подтверждения

![](https://static-docs.nocobase.com/mail-1733818625984.png)

3. Заполните дополнительную информацию и продолжите

![](https://static-docs.nocobase.com/mail-1733818626352.png)

4. Заполните данные кредитной карты (этот шаг можно пока пропустить)

![](https://static-docs.nocobase.com/mail-1733818626622.png)

### Получение идентификатора клиента (Client ID)

1. Нажмите верхнее меню и выберите «Microsoft Entra ID»

![](https://static-docs.nocobase.com/mail-1733818626871.png)

2. В левой части выберите «Регистрация приложений»

![](https://static-docs.nocobase.com/mail-1733818627097.png)

3. Нажмите «Новая регистрация» вверху

![](https://static-docs.nocobase.com/mail-1733818627309.png)

4. Заполните информацию и отправьте

Можно указать любое имя, выберите типы учётных записей, как показано на изображении, пока оставьте поле «URI перенаправления» пустым

![](https://static-docs.nocobase.com/mail-1733818627555.png)

5. Получите идентификатор клиента (Client ID)

![](https://static-docs.nocobase.com/mail-1733818627797.png)

### Авторизация API

1. Откройте меню «Разрешения API» справа

![](https://static-docs.nocobase.com/mail-1733818628178.png)

2. Нажмите кнопку «Добавить разрешение»

![](https://static-docs.nocobase.com/mail-1733818628448.png)

3. Нажмите «Microsoft Graph»

![](https://static-docs.nocobase.com/mail-1733818628725.png)

![](https://static-docs.nocobase.com/mail-1733818628927.png)

4. Найдите и добавьте следующие разрешения, итоговый результат должен выглядеть так:

    1. `"email"`
    2. `"offline_access"`
    3. `"IMAP.AccessAsUser.All"`
    4. `"SMTP.Send"`
    5. `"offline_access"`
    6. `"User.Read"` (по умолчанию)

![](https://static-docs.nocobase.com/mail-1733818629130.png)

### Получение секрета (Secret)

1. Нажмите «Сертификаты и секреты» слева

![](https://static-docs.nocobase.com/mail-1733818629369.png)

2. Нажмите кнопку «Новый секрет клиента»

![](https://static-docs.nocobase.com/mail-1733818629554.png)

3. Заполните описание и срок действия, затем нажмите «Добавить»

![](https://static-docs.nocobase.com/mail-1733818630292.png)

4. Скопируйте идентификатор секрета (Secret ID)

![](https://static-docs.nocobase.com/mail-1733818630535.png)

5. Скопируйте идентификатор и секрет клиента и введите их на странице настройки почты

![](https://static-docs.nocobase.com/mail-1733818630710.png)

## Часто задаваемые вопросы (FAQ)

**Вопрос:** После входа с авторизацией через учётную запись Microsoft электронные письма не приходят.

**Ответ:** В настоящее время для авторизованного входа поддерживаются только учётные записи Outlook и Gmail. Учётные записи Microsoft и Google не поддерживаются. Дополнительную информацию см. по ссылке: [answers.microsoft.com](https://answers.microsoft.com/zh-hans/outlook_com/forum/all/%E7%8E%B0%E6%9C%89%E5%BE%AE%E8%BD%AF%E8%B4%A6/dba12dda-a7c7-4346-8263-53f4a6d9dc68)

**Совет:** Если вы не уверены, есть ли у вас «настоящая» учётная запись Outlook.com или Gmail, попробуйте войти через веб-интерфейс Outlook.com или Gmail.com и отправить письмо. Если войти не удаётся, возможно, у вас нет соответствующей почтовой службы, и вам нужно либо зарегистрироваться, либо использовать другую службу электронной почты.
