# SQL Actions

В некоторых сценариях, где стандартные узлы операций с таблицами данных не справляются с более сложными задачами, вы можете напрямую использовать узел SQL Action для выполнения сложных SQL-запросов в базе данных.

В отличие от выполнения SQL-операций путем внешнего подключения к базе данных, в "workflow" вы можете использовать переменные из контекста "workflow" в качестве параметров в ваших SQL-выражениях.

## FAQ

### Как можно использовать результаты узла SQL Action?

При использовании оператора `SELECT` результаты запроса сохраняются в узле в формате JSON Sequelize. Вы можете анализировать и использовать эти результаты с помощью плагина [JSON-query](/handbook/workflow-json-query).

### Будут ли SQL-действия вызывать события таблицы?

**Нет**. SQL-действия напрямую выполняют команды SQL в базе данных. Такие действия, как `CREATE` / `UPDATE` / `DELETE`, происходят в базе данных, в то время как события таблицы управляются на уровне приложения Node.js (обработка ORM). В результате эти операции не запускают события таблицы.

## Установка

Этот плагин встроен, поэтому установка не требуется.

## Руководство пользователя

### Создание узла

В интерфейсе конфигурации "workflow" щелкните знак «плюс» («+») внутри потока, чтобы добавить узел «Действие SQL»:

![Добавление действий SQL](https://static-docs.nocobase.com/0ce40a226d7a5bf3717813e27da40e62.png)

### Настройка узла

![Конфигурация узла SQL](https://static-docs.nocobase.com/98611dc13bcda04348bd0856561a7b04.png)

#### Источник данных

Выберите источник данных для выполнения SQL.

Источник данных должен иметь тип базы данных, например, основной источник данных, тип PostgreSQL или любой другой источник данных, совместимый с Sequelize.

#### Содержимое SQL

Измените оператор SQL. В настоящее время поддерживается только один оператор SQL.

Вы можете вставить требуемые переменные, нажав кнопку переменной в правом верхнем углу редактора. Перед выполнением переменные будут заменены соответствующими им значениями в тексте, а окончательный оператор SQL будет отправлен в базу данных для запроса.

### Результаты выполнения узла

Начиная с `v1.3.15-beta`, результатом выполнения узла SQL является массив, состоящий исключительно из данных. До этой версии результатом была собственная структура Sequelize, включающая метаданные запроса (для получения более подробной информации см.: [`sequelize.query()`](https://sequelize.org/api/v6/class/src/sequelize.js~sequelize#instance-method-query)).

Например, следующий запрос:

```sql
select count(id) from posts;
```

Результат до `v1.3.15-beta`:

```json
[
    [
        { "count": 1 }
    ],
    {
        // meta
    }
]
```

Результат после `v1.3.15-beta`:

```json
[
    { "count": 1 }
]
```
