# Синхронизация пользовательских данных через HTTP API

## Получение API-ключа

См. раздел [API-ключи](../api-keys). Убедитесь, что у роли, связанной с API-ключом, есть необходимые права для синхронизации пользовательских данных.

## Обзор API

### Пример

```bash
curl 'https://localhost:13000/api/userData:push' \
  -H 'Authorization: Bearer <token>' \
  --data-raw '{"dataType":"user","records":[]}' # подробности тела запроса см. ниже
```

### Конечная точка (Endpoint)

```
POST /api/userData:push
```

## Формат данных пользователя

### UserData

| Параметр     | Тип                                   | Описание                                                                 |
|-------------|----------------------------------------|--------------------------------------------------------------------------|
| dataType    | `'user' \| 'department'`               | Обязательно. Тип передаваемых данных. Используйте `'user'` для данных пользователей. |
| matchKey    | `'username' \| 'email' \| 'phone'`     | Необязательно. Поле, по которому будет выполняться сопоставление с существующими пользователями в системе. |
| records     | `UserRecord[]`                         | Обязательно. Массив записей с данными пользователей.                      |

### UserRecord

| Параметр      | Тип          | Описание                                                                 |
|--------------|--------------|--------------------------------------------------------------------------|
| uid          | `string`     | Обязательно. Уникальный идентификатор пользователя в источнике данных. Неизменяем для одного пользователя. |
| nickname     | `string`     | Необязательно. Псевдоним пользователя.                                   |
| username     | `string`     | Необязательно. Имя пользователя.                                         |
| email        | `string`     | Необязательно. Адрес электронной почты пользователя.                     |
| phone        | `string`     | Необязательно. Номер телефона пользователя.                              |
| departments  | `string[]`   | Необязательно. Массив идентификаторов (UID) подразделений, к которым принадлежит пользователь. |
| isDeleted    | `boolean`    | Необязательно. Указывает, удалена ли запись.                             |
| `<field>`    | `any`        | Необязательно. Пользовательские поля из таблицы пользователей.           |

## Формат данных подразделений

:::info
Передача данных подразделений требует, чтобы был установлен и включён плагин [Подразделения](../../departments).
:::

### DepartmentData

| Параметр     | Тип                        | Описание                                                                 |
|-------------|-----------------------------|--------------------------------------------------------------------------|
| dataType    | `'user' \| 'department'`    | Обязательно. Тип передаваемых данных. Используйте `'department'` для данных подразделений. |
| records     | `DepartmentRecord[]`        | Обязательно. Массив записей с данными подразделений.                     |

### DepartmentRecord

| Параметр      | Тип          | Описание                                                                 |
|--------------|--------------|--------------------------------------------------------------------------|
| uid          | `string`     | Обязательно. Уникальный идентификатор подразделения в источнике данных. Неизменяем. |
| title        | `string`     | Обязательно. Название подразделения.                                     |
| parentUid    | `string`     | Необязательно. Идентификатор (UID) вышестоящего подразделения.            |
| isDeleted    | `boolean`    | Необязательно. Указывает, удалена ли запись.                             |
| `<field>`    | `any`        | Необязательно. Пользовательские поля из таблицы подразделений.           |

:::info
Передача данных является идемпотентной — многократная отправка одинаковых данных приведёт к одинаковому результату.

Если при передаче данных о подразделении родительское подразделение ещё не создано, установить связь невозможно. После создания родительского подразделения повторно отправьте данные.

Аналогично, если при передаче данных о пользователе подразделение ещё не создано, пользователь не сможет быть связан с этим подразделением. Сначала отправьте данные подразделений, а затем повторно отправьте данные пользователей.
:::
