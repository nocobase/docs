# Интернационализация (i18n)

## Файлы локализации

В плагине файлы интернационализации для фронтенда и бэкенда хранятся в папке `src/locale`. Нажмите здесь, чтобы увидеть [все поддерживаемые языки](/development/others/languages) в NocoBase.

```bash
|- /plugin-sample-i18n
  |- /src
    |- /locale      # Папка с файлами локализации
      |- en_US.ts   # Файл английского языка
      |- zh_CN.ts   # Файл китайского языка
```

Просто добавьте записи переводов в соответствующие файлы локализации (`/src/locale/${lang}.ts`). Если вы добавляете файл локализации впервые, приложение необходимо перезапустить для применения изменений. Вы можете проверить API `app:getLang`, чтобы убедиться, что записи переводов были успешно добавлены.

http://localhost:13000/api/app:getLang?locale=ru-RU

## Как реализовать поддержку интернационализации

На сервере есть два экземпляра i18n: app.i18n и ctx.i18n.

### app.i18n

app.i18n - это глобальный экземпляр i18n, обычно используемый в CLI. Например, его можно комбинировать с inquirer для реализации интерактивных командных строк.

```ts
import { select } from '@inquirer/select';
import { input } from '@inquirer/input';

export class PluginSampleI18nServer extends Plugin {
  load() {
    this.app.command('test-i18n').action(async () => {
      const answer1 = await select({
        message: 'Выберите язык',
        choices: [
          {
            name: 'Русский',
            value: 'ru-RU',
          },
          {
            name: 'English',
            value: 'en-US',
          },
        ],
      });
      await this.app.changeLanguage(answer1);
      const answer2 = await input({
        message: this.app.i18n.t('Введите ваше имя'),
      });
      console.log(this.app.i18n.t(`Ваше имя: {{name}}`, { name: answer2 }));
    });
  }
}
```

### ctx.i18n

Это клонированный экземпляр глобального app.i18n. Каждый запрос ctx полностью независим и отвечает на информацию о языке в соответствии с языком клиента.

Параметры клиентского запроса могут быть указаны в query string:

```bash
GET /?locale=ru-RU HTTP/1.1
Host: localhost:13000
```

Или в заголовках запроса (рекомендуется):

```bash
GET / HTTP/1.1
Host: localhost:13000
X-Locale: ru-RU
```

Пример:

```ts
export class PluginSampleI18nServer extends Plugin {
  load() {
    this.app.use(async (ctx, next) => {
      if (ctx.path === '/api/test-i18n') {
        ctx.body = `${ctx.i18n.t('Привет')} ${ctx.i18n.t('Мир')}`;
      }
      await next();
    });
  }
}
```

Посетите http://localhost:13000/api/test-i18n?locale=ru-RU

## API

Интернационализация в NocoBase реализована на основе i18next. Подробные инструкции по использованию см. в [документации API I18next](https://www.i18next.com/overview/api). Ниже приведены некоторые важные примеры.

### i18n.t()

Локализация каждого плагина различается по пространству имен (ns), которое соответствует имени плагина, например:

```ts
t('Привет', { ns: '@nocobase/plugin-sample-i18n' });
```

### i18n.changeLanguage()

Для изменения текущего языка:

```ts
await i18n.changeLanguage('ru-RU');
```

## Полный пример плагина

- [@nocobase/plugin-sample-i18n](#)
