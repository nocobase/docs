# Плагин (Plugin)

## Обзор

`Plugin` - это класс плагинов для сервера NocoBase, предоставляющий свойства конфигурации и методы жизненного цикла для серверных плагинов.

### Базовое использование

```ts
import { Plugin } from '@nocobase/server';

export class PluginDemoServer extends Plugin {}

export default PluginDemoServer;
```

## Свойства экземпляра

### `options`

Параметры конфигурации плагина.

### `name`

`string` - Название плагина.

### `enabled`

`boolean` - Включен ли плагин.

### `installed`

`boolean` - Установлен ли плагин.

### `log`

Экземпляр системного лога, где `module` по умолчанию устанавливается в имя плагина. См. [Logger](../logger.md).

### `app`

Экземпляр `Application` текущего приложения. См. [Application](./application.md).

### `pm`

Экземпляр `PluginManager` текущего приложения. См. [PluginManager](./plugin-manager.md).

### `db`

Экземпляр `DataBase` текущего приложения. См. [DataBase](../database/index.md).

## Методы жизненного цикла

### `afterAdd()`

Выполняется после добавления плагина (после [`pm.add()`](./plugin-manager.md#add)).

### `beforeLoad()`

Выполняется во время [`pm.load()`](./plugin-manager.md#load). Используется для регистрации событий, инициализации классов или другой предварительной обработки перед загрузкой плагина. На этом этапе доступны только основные API, но не API других плагинов.

### `load()`

Загружает плагин и связанные с ним конфигурации. Выполняется во время [`pm.load()`](./plugin-manager.md#load), после завершения всех методов [`beforeLoad()`](#beforeload) плагинов. На этом этапе доступны API других плагинов.

### `install()`

Логика установки плагина, выполняется при установке приложения, обновлении или первом включении плагина. Обычно используется для вставки предустановленных данных в таблицы.

### `beforeEnable()`

Выполняется перед включением плагина.

### `afterEnable()`

Выполняется после включения плагина.

### `beforeDisable()`

Выполняется перед отключением плагина.

### `afterDisable()`

Выполняется после отключения плагина.

### `beforeRemove()`

Выполняется перед удалением плагина.

### `afterRemove()`

Выполняется после удаления плагина.

## Другие методы

### `t()`

Метод интернационализации.

### `createLogger()`

Создает логгер. См. [Logger](../logger.md).

### `toJSON()`

Внутренний метод. Выводит информацию о конфигурации плагина.

### `sendSyncMessage()`

Отправляет синхронизационные сообщения. Сообщения будут получены только этим же плагином на других узлах, без влияния на другие плагины.

#### Сигнатура

```ts
sendSyncMessage(message: any): void | Promise<void>
```

#### Аргументы

- `message`: Данные синхронизации.

#### Пример

```ts
this.sendSyncMessage({
  key: 'value'
});
```

### `handleSyncMessage()`

В распределенной среде обрабатывает синхронизационные события от других узлов. При использовании плагином состояния в памяти необходимо переопределить логику обработки событий для синхронизации состояния между узлами.

#### Сигнатура

```
handleSyncMessage(message: any): void | Promise<void>
```

#### Аргументы

- `message`: Данные синхронизации от других узлов.

#### Пример

```ts
handleSyncMessage(message: SyncMessage) {
  console.log('handleSyncMessage', message);
  // this.reloadData();
}
```
