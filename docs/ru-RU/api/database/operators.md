# Операторы фильтрации

Используются в параметрах фильтрации методов `find`, `findOne`, `findAndCount`, `count` и других API репозитория:

```ts
const repository = db.getRepository('books');

repository.find({
  filter: {
    title: {
      $eq: 'Весна и Осень',
    },
  },
});
```

Для поддержки JSON NocoBase определяет операторы запроса как строки, начинающиеся с символа `$`.

Кроме того, NocoBase предоставляет API для расширения операторов. Подробнее см. [`db.registerOperators()`](../database#registeroperators).

## Общие операторы

### `$eq`

Проверяет, равно ли значение поля указанному значению. Аналог оператора `=` в SQL.

**Пример**

```ts
repository.find({
  filter: {
    title: {
      $eq: 'Весна и Осень',
    },
  },
});
```

Эквивалентно `title: 'Весна и Осень'`.

### `$ne`

Проверяет, не равно ли значение поля указанному значению. Аналог оператора `!=` в SQL.

**Пример**

```ts
repository.find({
  filter: {
    title: {
      $ne: 'Весна и Осень',
    },
  },
});
```

### `$is`

Проверяет, является ли значение поля указанным значением. Аналог оператора `IS` в SQL.

**Пример**

```ts
repository.find({
  filter: {
    title: {
      $is: null,
    },
  },
});
```

### `$not`

Проверяет, не является ли значение поля указанным значением. Аналог оператора `IS NOT` в SQL.

**Пример**

```ts
repository.find({
  filter: {
    title: {
      $not: null,
    },
  },
});
```

### `$col`

Проверяет, равно ли значение поля значению другого поля. Аналог оператора `=` в SQL.

**Пример**

```ts
repository.find({
  filter: {
    title: {
      $col: 'name',
    },
  },
});
```

### `$in`

Проверяет, содержится ли значение поля в указанном массиве. Аналог оператора `IN` в SQL.

**Пример**

```ts
repository.find({
  filter: {
    title: {
      $in: ['Весна и Осень', 'Эпоха воюющих государств'],
    },
  },
});
```

### `$notIn`

Проверяет, не содержится ли значение поля в указанном массиве. Аналог оператора `NOT IN` в SQL.

**Пример**

```ts
repository.find({
  filter: {
    title: {
      $notIn: ['Весна и Осень', 'Эпоха воюющих государств'],
    },
  },
});
```

### `$empty`

Проверяет, пусто ли поле. Для строкового поля — пустая ли строка, для массива — пуст ли массив.

**Пример**

```ts
repository.find({
  filter: {
    title: {
      $empty: true,
    },
  },
});
```

### `$notEmpty`

Проверяет, не пусто ли поле. Для строкового поля — не пустая ли строка, для массива — не пуст ли массив.

**Пример**

```ts
repository.find({
  filter: {
    title: {
      $notEmpty: true,
    },
  },
});
```

## Логические операторы

### `$and`

Логическое И. Аналог `AND` в SQL.

**Пример**

```ts
repository.find({
  filter: {
    $and: [{ title: 'Книга песен' }, { isbn: '1234567890' }],
  },
});
```

### `$or`

Логическое ИЛИ. Аналог `OR` в SQL.

**Пример**

```ts
repository.find({
  filter: {
    $or: [
      { title: 'Книга песен' },
      { publishedAt: { $lt: '0000-00-00T00:00:00Z' } },
    ],
  },
});
```

## Операторы для полей типа Boolean

Для полей с типом: `type: 'boolean'`

### `$isFalsy`

Проверяет, является ли значение логического поля ложным. Значения `false`, `0` и `NULL` считаются ложными (`$isFalsy: true`).

**Пример**

```ts
repository.find({
  filter: {
    isPublished: {
      $isFalsy: true,
    },
  },
});
```

### `$isTruly`

Проверяет, является ли значение логического поля истинным. Значения `true` и `1` считаются истинными (`$isTruly: true`).

**Пример**

```ts
repository.find({
  filter: {
    isPublished: {
      $isTruly: true,
    },
  },
});
```

## Операторы для числовых типов

Для полей числовых типов, включая:

- `type: 'integer'`
- `type: 'float'`
- `type: 'double'`
- `type: 'real'`
- `type: 'decimal'`

### `$gt`

Проверяет, больше ли значение поля указанного значения. Аналог `>` в SQL.

**Пример**

```ts
repository.find({
  filter: {
    price: {
      $gt: 100,
    },
  },
});
```

### `$gte`

Проверяет, больше ли или равно ли значение поля указанному значению. Аналог `>=` в SQL.

**Пример**

```ts
repository.find({
  filter: {
    price: {
      $gte: 100,
    },
  },
});
```

### `$lt`

Проверяет, меньше ли значение поля указанного значения. Аналог `<` в SQL.

**Пример**

```ts
repository.find({
  filter: {
    price: {
      $lt: 100,
    },
  },
});
```

### `$lte`

Проверяет, меньше ли или равно ли значение поля указанному значению. Аналог `<=` в SQL.

**Пример**

```ts
repository.find({
  filter: {
    price: {
      $lte: 100,
    },
  },
});
```

### `$between`

Проверяет, находится ли значение поля в диапазоне между двумя указанными значениями. Аналог оператора `BETWEEN` в SQL.

**Пример**

```ts
repository.find({
  filter: {
    price: {
      $between: [100, 200],
    },
  },
});
```

### `$notBetween`

Проверяет, находится ли значение поля **не** в диапазоне между двумя указанными значениями. Аналог оператора `NOT BETWEEN` в SQL.

**Пример**

```ts
repository.find({
  filter: {
    price: {
      $notBetween: [100, 200],
    },
  },
});
```

## Операторы для строковых полей

Для полей строкового типа: `type: 'string'`.

### `$includes`

Проверяет, содержит ли строка указанную подстроку.

**Пример**

```ts
repository.find({
  filter: {
    title: {
      $includes: 'Три столпа китайской культуры',
    },
  },
});
```

### `$notIncludes`

Проверяет, **не** содержит ли строка указанную подстроку.

**Пример**

```ts
repository.find({
  filter: {
    title: {
      $notIncludes: 'Три столпа китайской культуры',
    },
  },
});
```

### `$startsWith`

Проверяет, начинается ли строка с указанной подстроки.

**Пример**

```ts
repository.find({
  filter: {
    title: {
      $startsWith: 'Три столпа китайской культуры',
    },
  },
});
```

### `$notStatsWith`

Проверяет, **не** начинается ли строка с указанной подстроки.  
*(Примечание: вероятно, опечатка в оригинале — должно быть `$notStartsWith`.)*

**Пример**

```ts
repository.find({
  filter: {
    title: {
      $notStatsWith: 'Три столпа китайской культуры',
    },
  },
});
```

### `$endsWith`

Проверяет, заканчивается ли строка указанной подстрокой.

**Пример**

```ts
repository.find({
  filter: {
    title: {
      $endsWith: 'Три столпа китайской культуры',
    },
  },
});
```

### `$notEndsWith`

Проверяет, **не** заканчивается ли строка указанной подстрокой.

**Пример**

```ts
repository.find({
  filter: {
    title: {
      $notEndsWith: 'Три столпа китайской культуры',
    },
  },
});
```

### `$like`

Проверяет, содержит ли значение поля указанную строку. Аналог оператора `LIKE` в SQL.

**Пример**

```ts
repository.find({
  filter: {
    title: {
      $like: 'Компьютер',
    },
  },
});
```

### `$notLike`

Проверяет, **не** содержит ли значение поля указанную строку. Аналог оператора `NOT LIKE` в SQL.

**Пример**

```ts
repository.find({
  filter: {
    title: {
      $notLike: 'Компьютер',
    },
  },
});
```

### `$iLike`

Проверяет, содержит ли значение поля указанную строку без учёта регистра. Аналог оператора `ILIKE` в SQL (только для PostgreSQL).

**Пример**

```ts
repository.find({
  filter: {
    title: {
      $iLike: 'Компьютер',
    },
  },
});
```

### `$notILike`

Проверяет, **не** содержит ли значение поля указанную строку без учёта регистра. Аналог оператора `NOT ILIKE` в SQL (только для PostgreSQL).

**Пример**

```ts
repository.find({
  filter: {
    title: {
      $notILike: 'Компьютер',
    },
  },
});
```

### `$regexp`

Проверяет, соответствует ли значение поля указанному регулярному выражению. Аналог оператора `REGEXP` в SQL (только для PostgreSQL).

**Пример**

```ts
repository.find({
  filter: {
    title: {
      $regexp: '^Компьютер',
    },
  },
});
```

### `$notRegexp`

Проверяет, **не** соответствует ли значение поля указанному регулярному выражению. Аналог оператора `NOT REGEXP` в SQL (только для PostgreSQL).

**Пример**

```ts
repository.find({
  filter: {
    title: {
      $notRegexp: '^Компьютер',
    },
  },
});
```

### `$iRegexp`

Проверяет, соответствует ли значение поля указанному регулярному выражению без учёта регистра. Аналог оператора `~*` в SQL (только для PostgreSQL).

**Пример**

```ts
repository.find({
  filter: {
    title: {
      $iRegexp: '^КОМПЬЮТЕР',
    },
  },
});
```

### `$notIRegexp`

Проверяет, **не** соответствует ли значение поля указанному регулярному выражению без учёта регистра. Аналог оператора `!~*` в SQL (только для PostgreSQL).

**Пример**

```ts
repository.find({
  filter: {
    title: {
      $notIRegexp: '^КОМПЬЮТЕР',
    },
  },
});
```

## Операторы для полей типа дата

Для полей с типом: `type: 'date'`.

### `$dateOn`

Проверяет, попадает ли значение даты в указанный день.

**Пример**

```ts
repository.find({
  filter: {
    createdAt: {
      $dateOn: '2021-01-01',
    },
  },
});
```

### `$dateNotOn`

Проверяет, **не** попадает ли значение даты в указанный день.

**Пример**

```ts
repository.find({
  filter: {
    createdAt: {
      $dateNotOn: '2021-01-01',
    },
  },
});
```

### `$dateBefore`

Проверяет, находится ли значение даты до указанного момента, то есть меньше переданного значения.

**Пример**

```ts
repository.find({
  filter: {
    createdAt: {
      $dateBefore: '2021-01-01T00:00:00.000Z',
    },
  },
});
```

### `$dateNotBefore`

Проверяет, не находится ли значение поля даты **до** указанного момента, то есть значение должно быть **равно или больше** переданного.

**Пример**

```ts
repository.find({
  filter: {
    createdAt: {
      $dateNotBefore: '2021-01-01T00:00:00.000Z',
    },
  },
});
```

---

### `$dateAfter`

Проверяет, находится ли значение поля даты **после** указанного момента, то есть значение должно быть **больше** переданного.

**Пример**

```ts
repository.find({
  filter: {
    createdAt: {
      $dateAfter: '2021-01-01T00:00:00.000Z',
    },
  },
});
```

---

### `$dateNotAfter`

Проверяет, не находится ли значение поля даты **после** указанного момента, то есть значение должно быть **меньше или равно** переданному.  
*(Примечание: в описании оригинала, вероятно, ошибка — должно быть "меньше или равно", а не "равно или больше".)*

**Пример**

```ts
repository.find({
  filter: {
    createdAt: {
      $dateNotAfter: '2021-01-01T00:00:00.000Z',
    },
  },
});
```

---

## Операторы для полей типа массив

Для полей с типом: `type: 'array'`.

### `$match`

Проверяет, совпадают ли значения массива со значениями указанного массива (полное совпадение).

**Пример**

```ts
repository.find({
  filter: {
    tags: {
      $match: ['литература', 'история'],
    },
  },
});
```

---

### `$notMatch`

Проверяет, **не** совпадают ли значения массива со значениями указанного массива.

**Пример**

```ts
repository.find({
  filter: {
    tags: {
      $notMatch: ['литература', 'история'],
    },
  },
});
```

---

### `$anyOf`

Проверяет, содержит ли массив **хотя бы одно** из значений указанного массива.

**Пример**

```ts
repository.find({
  filter: {
    tags: {
      $anyOf: ['литература', 'история'],
    },
  },
});
```

---

### `$noneOf`

Проверяет, **не содержит ни одного** из значений указанного массива.

**Пример**

```ts
repository.find({
  filter: {
    tags: {
      $noneOf: ['литература', 'история'],
    },
  },
});
```

---

### `$arrayEmpty`

Проверяет, является ли массив пустым.

**Пример**

```ts
repository.find({
  filter: {
    tags: {
      $arrayEmpty: true,
    },
  },
});
```

---

### `$arrayNotEmpty`

Проверяет, **не** является ли массив пустым.

**Пример**

```ts
repository.find({
  filter: {
    tags: {
      $arrayNotEmpty: true,
    },
  },
});
```

---

## Операторы для связанных полей

Для проверки существования связи. Поддерживаются типы полей:

- `type: 'hasOne'`
- `type: 'hasMany'`
- `type: 'belongsTo'`
- `type: 'belongsToMany'`

### `$exists`

Проверяет, существует ли связанная запись.

**Пример**

```ts
repository.find({
  filter: {
    author: {
      $exists: true,
    },
  },
});
```

### `$notExists`

Проверяет, **не** существует ли связанная запись.

**Пример**

```ts
repository.find({
  filter: {
    author: {
      $notExists: true,
    },
  },
});
```
