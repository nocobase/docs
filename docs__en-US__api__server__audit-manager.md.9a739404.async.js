"use strict";(self.webpackChunknocobase_docs=self.webpackChunknocobase_docs||[]).push([[3936],{850778:function(r,a,s){s.r(a);var d=s(572269),u=s(793359),_=s(861788),x=s(719977),h=s(20190),t=s(24268),I=s(496057),v=s(585939),g=s(28484),j=s(635206),m=s(375553),E=s(156266),p=s(572333),D=s(841118),M=s(39297),P=s(868526),A=s(605019),i=s(614651),o=s(280936),l=s(667294),n=s(397743),e=s(785893);function c(){return(0,e.jsx)(i.dY,{children:(0,e.jsx)(l.Suspense,{fallback:(0,e.jsx)(o.Z,{}),children:(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)("div",{className:"markdown",children:[(0,e.jsxs)("h1",{id:"auditmanager",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#auditmanager",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"AuditManager"]}),(0,e.jsxs)("h2",{id:"\u6982\u89C8",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#\u6982\u89C8",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"\u6982\u89C8"]}),(0,e.jsxs)("p",{children:[(0,e.jsx)("code",{children:n.texts[0].value}),n.texts[1].value]}),(0,e.jsxs)("h3",{id:"\u57FA\u672C\u4F7F\u7528",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#\u57FA\u672C\u4F7F\u7528",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"\u57FA\u672C\u4F7F\u7528"]}),(0,e.jsx)(t.Z,{lang:"ts",children:n.texts[2].value}),(0,e.jsxs)("h2",{id:"\u7C7B\u65B9\u6CD5",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#\u7C7B\u65B9\u6CD5",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"\u7C7B\u65B9\u6CD5"]}),(0,e.jsxs)("h3",{id:"setlogger",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#setlogger",children:(0,e.jsx)("span",{className:"icon icon-link"})}),(0,e.jsx)("code",{children:n.texts[3].value})]}),(0,e.jsx)("p",{children:n.texts[4].value}),(0,e.jsx)(t.Z,{lang:"ts",children:n.texts[5].value}),(0,e.jsxs)("h4",{id:"\u7B7E\u540D",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#\u7B7E\u540D",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"\u7B7E\u540D"]}),(0,e.jsx)("ul",{children:(0,e.jsx)("li",{children:(0,e.jsx)("code",{children:n.texts[6].value})})}),(0,e.jsxs)("h4",{id:"\u7C7B\u578B",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#\u7C7B\u578B",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"\u7C7B\u578B"]}),(0,e.jsx)(t.Z,{lang:"ts",children:n.texts[7].value}),(0,e.jsxs)("h3",{id:"registeraction",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#registeraction",children:(0,e.jsx)("span",{className:"icon icon-link"})}),(0,e.jsx)("code",{children:n.texts[8].value})]}),(0,e.jsx)("p",{children:n.texts[9].value}),(0,e.jsxs)("h4",{id:"\u7B7E\u540D-1",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#\u7B7E\u540D-1",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"\u7B7E\u540D"]}),(0,e.jsx)("ul",{children:(0,e.jsx)("li",{children:(0,e.jsx)("code",{children:n.texts[10].value})})}),(0,e.jsxs)("h4",{id:"\u7C7B\u578B-1",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#\u7C7B\u578B-1",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"\u7C7B\u578B"]}),(0,e.jsx)(t.Z,{lang:"ts",children:n.texts[11].value}),(0,e.jsxs)("h4",{id:"\u8BE6\u7EC6\u4FE1\u606F",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#\u8BE6\u7EC6\u4FE1\u606F",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"\u8BE6\u7EC6\u4FE1\u606F"]}),(0,e.jsx)("p",{children:n.texts[12].value}),(0,e.jsx)("ol",{children:(0,e.jsx)("li",{children:n.texts[13].value})}),(0,e.jsx)(t.Z,{lang:"ts",children:n.texts[14].value}),(0,e.jsx)("ol",{start:"2",children:(0,e.jsxs)("li",{children:[n.texts[15].value,(0,e.jsx)("code",{children:n.texts[16].value})]})}),(0,e.jsx)(t.Z,{lang:"ts",children:n.texts[17].value}),(0,e.jsx)("ol",{start:"3",children:(0,e.jsxs)("li",{children:[n.texts[18].value,(0,e.jsx)("code",{children:n.texts[19].value})]})}),(0,e.jsx)(t.Z,{lang:"ts",children:n.texts[20].value}),(0,e.jsx)("ol",{start:"4",children:(0,e.jsxs)("li",{children:[n.texts[21].value,(0,e.jsx)("code",{children:n.texts[22].value}),n.texts[23].value,(0,e.jsx)("code",{children:n.texts[24].value}),n.texts[25].value,(0,e.jsx)("code",{children:n.texts[26].value}),n.texts[27].value]})}),(0,e.jsx)(t.Z,{lang:"ts",children:n.texts[28].value}),(0,e.jsx)("p",{children:n.texts[29].value}),(0,e.jsxs)("ol",{children:[(0,e.jsx)("li",{children:(0,e.jsx)("p",{children:(0,e.jsx)("code",{children:n.texts[30].value})})}),(0,e.jsx)("li",{children:(0,e.jsx)("p",{children:(0,e.jsx)("code",{children:n.texts[31].value})})}),(0,e.jsx)("li",{children:(0,e.jsx)("p",{children:(0,e.jsx)("code",{children:n.texts[32].value})})})]}),(0,e.jsxs)("p",{children:[n.texts[33].value,(0,e.jsx)("code",{children:n.texts[34].value}),n.texts[35].value,(0,e.jsx)("code",{children:n.texts[36].value}),n.texts[37].value]}),(0,e.jsxs)("h3",{id:"registeractions",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#registeractions",children:(0,e.jsx)("span",{className:"icon icon-link"})}),(0,e.jsx)("code",{children:n.texts[38].value})]}),(0,e.jsx)("p",{children:n.texts[39].value}),(0,e.jsxs)("h4",{id:"\u7B7E\u540D-2",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#\u7B7E\u540D-2",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"\u7B7E\u540D"]}),(0,e.jsx)("ul",{children:(0,e.jsx)("li",{children:(0,e.jsx)("code",{children:n.texts[40].value})})})]})})})})}a.default=c},397743:function(r,a,s){s.r(a),s.d(a,{texts:function(){return d}});const d=[{value:"AuditManager",paraId:0,tocIndex:1},{value:" \u662F NocoBase \u4E2D\u7684\u8D44\u6E90\u5BA1\u8BA1\u7BA1\u7406\u6A21\u5757\uFF0C\u7528\u4E8E\u6CE8\u518C\u9700\u8981\u53C2\u4E0E\u5BA1\u8BA1\u7684\u8D44\u6E90\u63A5\u53E3\u3002",paraId:0,tocIndex:1},{value:`import { Plugin } from '@nocobase/server';

class PluginCustomAuditResourceServer extends Plugin {
  async load() {
    this.app.auditManager.registerAction('resource:action');
  }
}
`,paraId:1,tocIndex:2},{value:"setLogger()",paraId:2},{value:"\u8BBE\u7F6E\u5BA1\u8BA1\u65E5\u5FD7\u7684\u8F93\u51FA\u65B9\u6CD5\u3002",paraId:3,tocIndex:4},{value:`const auditManager = new AuditManager();
auditManager.setLogger({
  log: async (auditLog: AuditLog) => console.log(auditLog);
})
`,paraId:4,tocIndex:4},{value:"setLogger(logger: AuditLogger)",paraId:5,tocIndex:5},{value:`export interface AuditLog {
  uuid: string;
  dataSource: string;
  resource: string;
  action: string;
  sourceCollection?: string;
  sourceRecordUK?: string;
  targetCollection?: string;
  targetRecordUK?: string;
  userId: string;
  roleName: string;
  ip: string;
  ua: string;
  status: number;
  metadata?: Record<string, any>;
}

export interface AuditLogger {
  log(auditLog: AuditLog): Promise<void>;
}
`,paraId:6,tocIndex:6},{value:"registerAction()",paraId:2},{value:"\u6CE8\u518C\u53C2\u4E0E\u5BA1\u8BA1\u7684\u8D44\u6E90\u64CD\u4F5C\u3002",paraId:7,tocIndex:7},{value:"registerAction(action: Action)",paraId:8,tocIndex:8},{value:`export interface UserInfo {
  userId?: string;
  roleName?: string;
}

export interface SourceAndTarget {
  sourceCollection?: string;
  sourceRecordUK?: string;
  targetCollection?: string;
  targetRecordUK?: string;
}

type Action =
  | string
  | {
      name: string;
      getMetaData?: (ctx: Context) => Promise<Record<string, any>>;
      getUserInfo?: (ctx: Context) => Promise<UserInfo>;
      getSourceAndTarget?: (ctx: Context) => Promise<SourceAndTarget>;
    };
`,paraId:9,tocIndex:9},{value:"\u652F\u6301\u51E0\u79CD\u5199\u6CD5:",paraId:10,tocIndex:10},{value:"\u5BF9\u6240\u6709\u8D44\u6E90\u751F\u6548",paraId:11,tocIndex:10},{value:`registerActions(['create']);
`,paraId:12,tocIndex:10},{value:"\u5BF9\u67D0\u4E2A\u8D44\u6E90\u7684\u6240\u6709\u64CD\u4F5C\u751F\u6548 ",paraId:13,tocIndex:10},{value:"resource:*",paraId:13,tocIndex:10},{value:`registerActions(['app:*']);
`,paraId:14,tocIndex:10},{value:"\u5BF9\u67D0\u4E2A\u8D44\u6E90\u7684\u67D0\u4E2A\u64CD\u4F5C\u751F\u6548 ",paraId:15,tocIndex:10},{value:"resouce:action",paraId:15,tocIndex:10},{value:`registerAction(['pm:update']);
`,paraId:16,tocIndex:10},{value:"\u652F\u6301\u4F20\u5165\u9488\u5BF9\u64CD\u4F5C\u81EA\u5B9A\u4E49\u7684 ",paraId:17,tocIndex:10},{value:"getMetaData",paraId:17,tocIndex:10},{value:", ",paraId:17,tocIndex:10},{value:"getUserInfo",paraId:17,tocIndex:10},{value:", ",paraId:17,tocIndex:10},{value:"getSourceAndTarget",paraId:17,tocIndex:10},{value:" \u65B9\u6CD5",paraId:17,tocIndex:10},{value:`registerActions([
  'create',
  { name: 'auth:signIn', getMetaData, getUserInfo, getSourceAndTarget },
]);
`,paraId:18,tocIndex:10},{value:"\u5F53\u6CE8\u518C\u7684\u63A5\u53E3\u6709\u91CD\u53E0\u65F6\uFF0C\u9897\u7C92\u5EA6\u7EC6\u7684\u6CE8\u518C\u65B9\u65B9\u5F0F\u4F18\u5148\u7EA7\u66F4\u9AD8\uFF0C\u4F8B\u5982\uFF1A",paraId:19,tocIndex:10},{value:"registerActions('create')",paraId:20,tocIndex:10},{value:"registerAction({ name: 'user:*', getMetaData })",paraId:21,tocIndex:10},{value:"registerAction({ name: 'user:create', getMetaData })",paraId:22,tocIndex:10},{value:"\u5BF9\u4E8E ",paraId:23,tocIndex:10},{value:"user:create",paraId:23,tocIndex:10},{value:" \u63A5\u53E3\uFF0C\u751F\u6548\u7684\u662F ",paraId:23,tocIndex:10},{value:"3",paraId:23,tocIndex:10},{value:".",paraId:23,tocIndex:10},{value:"registerActions()",paraId:2},{value:"\u6CE8\u518C\u591A\u4E2A\u53C2\u4E0E\u5BA1\u8BA1\u7684\u8D44\u6E90\u64CD\u4F5C\u3002",paraId:24,tocIndex:11},{value:"registerAction(actions: Action[])",paraId:25,tocIndex:12}]}}]);
