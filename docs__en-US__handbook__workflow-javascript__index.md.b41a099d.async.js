"use strict";(self.webpackChunknocobase_docs=self.webpackChunknocobase_docs||[]).push([[44161],{855917:function(o,n,t){t.r(n);var d=t(572269),h=t(793359),v=t(861788),l=t(719977),_=t(20190),s=t(24268),p=t(496057),I=t(585939),m=t(28484),j=t(635206),f=t(375553),g=t(156266),b=t(572333),i=t(841118),E=t(39297),O=t(868526),w=t(605019),r=t(614651),c=t(280936),u=t(667294),a=t(894349),e=t(785893);function x(){return(0,e.jsx)(r.dY,{children:(0,e.jsx)(u.Suspense,{fallback:(0,e.jsx)(c.Z,{}),children:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:"markdown",children:(0,e.jsxs)("h1",{id:"javascript",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#javascript",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"JavaScript"]})}),(0,e.jsx)(i.Z,{name:"workflow-script",link:"/handbook/workflow-script",commercial:"true"}),(0,e.jsxs)("div",{className:"markdown",children:[(0,e.jsx)("p",{children:a.texts[0].value}),(0,e.jsxs)("p",{children:[a.texts[1].value,(0,e.jsx)(r.rU,{to:"#feature-list",children:a.texts[2].value}),a.texts[3].value]}),(0,e.jsxs)("h2",{id:"user-manual",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#user-manual",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"User Manual"]}),(0,e.jsxs)("h3",{id:"creating-a-node",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#creating-a-node",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"Creating a Node"]}),(0,e.jsx)("p",{children:a.texts[4].value}),(0,e.jsx)("p",{children:(0,e.jsx)("img",{src:"https://static-docs.nocobase.com/20241007122632.png",alt:"20241007122632"})}),(0,e.jsxs)("h3",{id:"node-configuration",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#node-configuration",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"Node Configuration"]}),(0,e.jsx)("p",{children:(0,e.jsx)("img",{src:"https://static-docs.nocobase.com/20241007122825.png",alt:"20241007122825"})}),(0,e.jsxs)("h4",{id:"parameters",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#parameters",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"Parameters"]}),(0,e.jsxs)("p",{children:[a.texts[5].value,(0,e.jsx)("code",{children:a.texts[6].value}),a.texts[7].value,(0,e.jsx)("code",{children:a.texts[8].value}),a.texts[9].value]}),(0,e.jsxs)("h4",{id:"script-content",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#script-content",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"Script Content"]}),(0,e.jsxs)("p",{children:[a.texts[10].value,(0,e.jsx)("code",{children:a.texts[11].value}),a.texts[12].value]}),(0,e.jsx)("p",{children:a.texts[13].value}),(0,e.jsx)("p",{children:(0,e.jsx)("img",{src:"https://static-docs.nocobase.com/20241007153631.png",alt:"20241007153631"})}),(0,e.jsxs)("h4",{id:"timeout-setting",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#timeout-setting",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"Timeout Setting"]}),(0,e.jsxs)("p",{children:[a.texts[14].value,(0,e.jsx)("code",{children:a.texts[15].value}),a.texts[16].value]}),(0,e.jsxs)("h4",{id:"continue-workflow-on-error",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#continue-workflow-on-error",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"Continue Workflow on Error"]}),(0,e.jsx)("p",{children:a.texts[17].value})]}),(0,e.jsx)(l.Z,{type:"info",title:"Note",children:(0,e.jsx)("p",{children:a.texts[18].value})}),(0,e.jsxs)("div",{className:"markdown",children:[(0,e.jsxs)("h2",{id:"feature-list",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#feature-list",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"Feature List"]}),(0,e.jsxs)("h3",{id:"nodejs-version",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#nodejs-version",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"Node.js Version"]}),(0,e.jsx)("p",{children:a.texts[19].value}),(0,e.jsxs)("h3",{id:"module-support",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#module-support",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"Module Support"]}),(0,e.jsxs)("p",{children:[a.texts[20].value,(0,e.jsx)("code",{children:a.texts[21].value}),a.texts[22].value]}),(0,e.jsxs)("p",{children:[a.texts[23].value,(0,e.jsx)("code",{children:a.texts[24].value}),a.texts[25].value,(0,e.jsx)("code",{children:a.texts[26].value}),a.texts[27].value]}),(0,e.jsx)(s.Z,{lang:"ini",children:a.texts[28].value})]}),(0,e.jsx)(l.Z,{type:"info",title:"Note",children:(0,e.jsxs)("p",{children:[a.texts[29].value,(0,e.jsx)("code",{children:a.texts[30].value}),a.texts[31].value,(0,e.jsx)("code",{children:a.texts[32].value}),a.texts[33].value,(0,e.jsx)("strong",{children:a.texts[34].value}),a.texts[35].value]})}),(0,e.jsxs)("div",{className:"markdown",children:[(0,e.jsxs)("p",{children:[a.texts[36].value,(0,e.jsx)("code",{children:a.texts[37].value}),a.texts[38].value,(0,e.jsx)("code",{children:a.texts[39].value}),a.texts[40].value,(0,e.jsx)("code",{children:a.texts[41].value}),a.texts[42].value]}),(0,e.jsx)(s.Z,{lang:"shell",children:a.texts[43].value}),(0,e.jsxs)("p",{children:[a.texts[44].value,(0,e.jsx)("code",{children:a.texts[45].value}),a.texts[46].value]}),(0,e.jsx)(s.Z,{lang:"ini",children:a.texts[47].value}),(0,e.jsxs)("p",{children:[a.texts[48].value,(0,e.jsx)("code",{children:a.texts[49].value}),a.texts[50].value]}),(0,e.jsx)(s.Z,{lang:"js",children:a.texts[51].value}),(0,e.jsxs)("h3",{id:"global-variables",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#global-variables",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"Global Variables"]}),(0,e.jsxs)("p",{children:[a.texts[52].value,(0,e.jsx)("code",{children:a.texts[53].value}),a.texts[54].value,(0,e.jsx)("code",{children:a.texts[55].value}),a.texts[56].value,(0,e.jsx)("code",{children:a.texts[57].value}),a.texts[58].value,(0,e.jsx)("code",{children:a.texts[59].value}),a.texts[60].value,(0,e.jsx)("strong",{children:a.texts[61].value}),a.texts[62].value]}),(0,e.jsx)(s.Z,{lang:"js",children:a.texts[63].value}),(0,e.jsxs)("h3",{id:"input-parameters",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#input-parameters",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"Input Parameters"]}),(0,e.jsxs)("p",{children:[a.texts[64].value,(0,e.jsx)("code",{children:a.texts[65].value}),a.texts[66].value,(0,e.jsx)("code",{children:a.texts[67].value}),a.texts[68].value,(0,e.jsx)("code",{children:a.texts[69].value}),a.texts[70].value,(0,e.jsx)("code",{children:a.texts[71].value}),a.texts[72].value,(0,e.jsx)("code",{children:a.texts[73].value}),a.texts[74].value]}),(0,e.jsxs)("h3",{id:"return-values",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#return-values",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"Return Values"]}),(0,e.jsxs)("p",{children:[a.texts[75].value,(0,e.jsx)("code",{children:a.texts[76].value}),a.texts[77].value,(0,e.jsx)("code",{children:a.texts[78].value}),a.texts[79].value]}),(0,e.jsx)(s.Z,{lang:"js",children:a.texts[80].value}),(0,e.jsxs)("h3",{id:"output-logs",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#output-logs",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"Output (Logs)"]}),(0,e.jsxs)("p",{children:[(0,e.jsx)("strong",{children:a.texts[81].value}),a.texts[82].value,(0,e.jsx)("code",{children:a.texts[83].value}),a.texts[84].value]}),(0,e.jsx)(s.Z,{lang:"js",children:a.texts[85].value}),(0,e.jsx)("p",{children:a.texts[86].value}),(0,e.jsxs)("h3",{id:"asynchronous-operations",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#asynchronous-operations",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"Asynchronous Operations"]}),(0,e.jsxs)("p",{children:[(0,e.jsx)("strong",{children:a.texts[87].value}),a.texts[88].value,(0,e.jsx)("code",{children:a.texts[89].value}),a.texts[90].value,(0,e.jsx)("code",{children:a.texts[91].value}),a.texts[92].value,(0,e.jsx)("strong",{children:a.texts[93].value}),a.texts[94].value,(0,e.jsx)("code",{children:a.texts[95].value}),a.texts[96].value]}),(0,e.jsx)(s.Z,{lang:"js",children:a.texts[97].value}),(0,e.jsxs)("h3",{id:"timers",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#timers",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"Timers"]}),(0,e.jsxs)("p",{children:[a.texts[98].value,(0,e.jsx)("code",{children:a.texts[99].value}),a.texts[100].value,(0,e.jsx)("code",{children:a.texts[101].value}),a.texts[102].value,(0,e.jsx)("code",{children:a.texts[103].value}),a.texts[104].value,(0,e.jsx)("code",{children:a.texts[105].value}),a.texts[106].value]}),(0,e.jsx)(s.Z,{lang:"js",children:a.texts[107].value})]})]})})})}n.default=x},894349:function(o,n,t){t.r(n),t.d(n,{texts:function(){return d}});const d=[{value:"The JavaScript node allows users to execute custom Node.js scripts within a workflow. These scripts can utilize upstream workflow variables as parameters and return values that subsequent nodes can use.",paraId:0},{value:"The script supports most Node.js features but has some differences from the native execution environment. See the ",paraId:1},{value:"Feature List",paraId:2},{value:" for details.",paraId:1},{value:"In the workflow configuration interface, click the plus (\u201C+\u201D) button in the workflow to add a \u201CScript\u201D node:",paraId:3,tocIndex:2},{value:"Use parameters to pass variables or static values from the workflow context into the script, making them accessible in the script logic. ",paraId:4,tocIndex:4},{value:"name",paraId:4,tocIndex:4},{value:" represents the parameter name, which will serve as the variable name in the script. ",paraId:4,tocIndex:4},{value:"value",paraId:4,tocIndex:4},{value:" represents the parameter value, which can be a workflow variable or a constant.",paraId:4,tocIndex:4},{value:"The script content functions as a single function where you can write any JavaScript code supported by the Node.js environment. Use the ",paraId:5,tocIndex:5},{value:"return",paraId:5,tocIndex:5},{value:" statement to provide a value as the node's output, making it available as a variable for downstream nodes.",paraId:5,tocIndex:5},{value:"After writing the script, use the test button below the editor to open a test execution dialog. Populate parameters with static values for simulation. The dialog displays the return value and output (logs) after execution.",paraId:6,tocIndex:5},{value:"Set the timeout in milliseconds. A value of ",paraId:7,tocIndex:6},{value:"0",paraId:7,tocIndex:6},{value:" means no timeout.",paraId:7,tocIndex:6},{value:"If enabled, the workflow will continue even if the script encounters an error or timeout.",paraId:8,tocIndex:7},{value:"When a script fails, it will not return a value, and the node's output will contain the error message. If subsequent nodes use the result variable from this script node, handle it carefully.",paraId:9},{value:"The Node.js version matches the version used by the main application.",paraId:10,tocIndex:9},{value:"The script allows restricted use of modules, adhering to the CommonJS standard. Use the ",paraId:11,tocIndex:10},{value:"require()",paraId:11,tocIndex:10},{value:" directive to import modules in your code.",paraId:11,tocIndex:10},{value:"It supports Node.js native modules and modules installed in ",paraId:12,tocIndex:10},{value:"node_modules",paraId:12,tocIndex:10},{value:" (including dependencies used by NocoBase). To make modules available in the code, declare them in the application environment variable ",paraId:12,tocIndex:10},{value:"WORKFLOW_SCRIPT_MODULES",paraId:12,tocIndex:10},{value:". Separate multiple module names with commas, e.g.:",paraId:12,tocIndex:10},{value:`WORKFLOW_SCRIPT_MODULES=crypto,timers,lodash,dayjs
`,paraId:13,tocIndex:10},{value:"Modules not declared in ",paraId:14},{value:"WORKFLOW_SCRIPT_MODULES",paraId:14},{value:", including native Node.js modules or installed ",paraId:14},{value:"node_modules",paraId:14},{value:", ",paraId:14},{value:"cannot",paraId:14},{value:" be used in scripts. This strategy allows administrators to control the modules accessible to users, reducing the risk of excessive script permissions.",paraId:14},{value:"When in a non-source-deployed environment, if a module is not installed in ",paraId:15},{value:"node_modules",paraId:15},{value:", you can manually install the required package into the ",paraId:15},{value:"storage",paraId:15},{value:" directory. For example, to use the ",paraId:15},{value:"exceljs",paraId:15},{value:" package, you can perform the following steps:",paraId:15},{value:`cd storage
npm i --no-save --no-package-lock --prefix . exceljs
`,paraId:16},{value:"Then add the package's relative (or absolute) path based on the application's CWD (current working directory) to the environment variable ",paraId:17},{value:"WORKFLOW_SCRIPT_MODULES",paraId:17},{value:":",paraId:17},{value:`WORKFLOW_SCRIPT_MODULES=./storage/node_modules/exceljs
`,paraId:18},{value:"You can then use the ",paraId:19},{value:"exceljs",paraId:19},{value:" package in your script:",paraId:19},{value:`const ExcelJS = require('exceljs');
// ...
`,paraId:20},{value:"Global variables such as ",paraId:21,tocIndex:11},{value:"global",paraId:21,tocIndex:11},{value:", ",paraId:21,tocIndex:11},{value:"process",paraId:21,tocIndex:11},{value:", ",paraId:21,tocIndex:11},{value:"__dirname",paraId:21,tocIndex:11},{value:", and ",paraId:21,tocIndex:11},{value:"__filename",paraId:21,tocIndex:11},{value:" are ",paraId:21,tocIndex:11},{value:"not supported",paraId:21,tocIndex:11},{value:".",paraId:21,tocIndex:11},{value:`console.log(global); // will throw error: "global is not defined"
`,paraId:22,tocIndex:11},{value:"Parameters configured in the node are treated as global variables in the script and can be used directly. Only basic types such as ",paraId:23,tocIndex:12},{value:"boolean",paraId:23,tocIndex:12},{value:", ",paraId:23,tocIndex:12},{value:"number",paraId:23,tocIndex:12},{value:", ",paraId:23,tocIndex:12},{value:"string",paraId:23,tocIndex:12},{value:", ",paraId:23,tocIndex:12},{value:"object",paraId:23,tocIndex:12},{value:", and arrays are supported. ",paraId:23,tocIndex:12},{value:"Date",paraId:23,tocIndex:12},{value:" objects are converted to ISO-formatted strings when passed. Other complex types, such as custom class instances, cannot be directly passed.",paraId:23,tocIndex:12},{value:"Use the ",paraId:24,tocIndex:13},{value:"return",paraId:24,tocIndex:13},{value:" statement to return data of basic types (same as parameter rules) to the node as its output. If the code does not contain a ",paraId:24,tocIndex:13},{value:"return",paraId:24,tocIndex:13},{value:" statement, the node will have no output value.",paraId:24,tocIndex:13},{value:`return 123;
`,paraId:25,tocIndex:13},{value:"Supports",paraId:26,tocIndex:14},{value:" logging via ",paraId:26,tocIndex:14},{value:"console",paraId:26,tocIndex:14},{value:".",paraId:26,tocIndex:14},{value:`console.log('hello world!');
`,paraId:27,tocIndex:14},{value:"The script node\u2019s output will also be recorded in the corresponding workflow\u2019s log files.",paraId:28,tocIndex:14},{value:"Supports",paraId:29,tocIndex:15},{value:" asynchronous functions using ",paraId:29,tocIndex:15},{value:"async",paraId:29,tocIndex:15},{value:" and ",paraId:29,tocIndex:15},{value:"await",paraId:29,tocIndex:15},{value:". It also ",paraId:29,tocIndex:15},{value:"supports",paraId:29,tocIndex:15},{value:" the global ",paraId:29,tocIndex:15},{value:"Promise",paraId:29,tocIndex:15},{value:" object.",paraId:29,tocIndex:15},{value:`async function test() {
  return Promise.resolve(1);
}

const value = await test();
return value;
`,paraId:30,tocIndex:15},{value:"To use methods like ",paraId:31,tocIndex:16},{value:"setTimeout",paraId:31,tocIndex:16},{value:", ",paraId:31,tocIndex:16},{value:"setInterval",paraId:31,tocIndex:16},{value:", or ",paraId:31,tocIndex:16},{value:"setImmediate",paraId:31,tocIndex:16},{value:", import them from the Node.js ",paraId:31,tocIndex:16},{value:"timers",paraId:31,tocIndex:16},{value:" package.",paraId:31,tocIndex:16},{value:`const { setTimeout, setInterval, setImmediate, clearTimeout, clearInterval, clearImmediate } = require('timers');

async function sleep(time) {
  return new Promise((resolve) => setTimeout(resolve, time));
}

await sleep(1000);

return 123;
`,paraId:32,tocIndex:16}]}}]);
