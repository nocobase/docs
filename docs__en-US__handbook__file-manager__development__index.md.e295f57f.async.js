"use strict";(self.webpackChunknocobase_docs=self.webpackChunknocobase_docs||[]).push([[16357],{389194:function(i,a,n){n.r(a);var l=n(572269),x=n(793359),u=n(861788),_=n(719977),h=n(20190),d=n(24268),v=n(496057),m=n(585939),p=n(28484),I=n(635206),f=n(375553),j=n(156266),E=n(572333),y=n(841118),P=n(39297),M=n(868526),g=n(605019),s=n(614651),o=n(280936),r=n(667294),t=n(416501),e=n(785893);function c(){return(0,e.jsx)(s.dY,{children:(0,e.jsx)(r.Suspense,{fallback:(0,e.jsx)(o.Z,{}),children:(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)("div",{className:"markdown",children:[(0,e.jsxs)("h1",{id:"development",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#development",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"Development"]}),(0,e.jsxs)("h2",{id:"extend-client-file-type",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#extend-client-file-type",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"Extend client file type"]}),(0,e.jsx)("p",{children:t.texts[0].value}),(0,e.jsxs)("h3",{id:"example",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#example",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"Example"]}),(0,e.jsx)("p",{children:t.texts[1].value}),(0,e.jsx)(d.Z,{lang:"ts",children:t.texts[2].value}),(0,e.jsxs)("p",{children:[t.texts[3].value,(0,e.jsx)("code",{children:t.texts[4].value}),t.texts[5].value,(0,e.jsx)("code",{children:t.texts[6].value}),t.texts[7].value,(0,e.jsx)("code",{children:t.texts[8].value}),t.texts[9].value]}),(0,e.jsxs)("p",{children:[t.texts[10].value,(0,e.jsx)("code",{children:t.texts[11].value}),t.texts[12].value,(0,e.jsx)("code",{children:t.texts[13].value}),t.texts[14].value,(0,e.jsx)("code",{children:t.texts[15].value}),t.texts[16].value,(0,e.jsx)("code",{children:t.texts[17].value}),t.texts[18].value]}),(0,e.jsxs)("p",{children:[t.texts[19].value,(0,e.jsx)("code",{children:t.texts[20].value}),t.texts[21].value,(0,e.jsx)("code",{children:t.texts[22].value}),t.texts[23].value]}),(0,e.jsxs)("h3",{id:"api",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#api",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"API"]}),(0,e.jsx)(d.Z,{lang:"ts",children:t.texts[24].value}),(0,e.jsxs)("h4",{id:"attachmentfiletypes",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#attachmentfiletypes",children:(0,e.jsx)("span",{className:"icon icon-link"})}),(0,e.jsx)("code",{children:t.texts[25].value})]}),(0,e.jsxs)("p",{children:[(0,e.jsx)("code",{children:t.texts[26].value}),t.texts[27].value,(0,e.jsx)("code",{children:t.texts[28].value}),t.texts[29].value]}),(0,e.jsx)(d.Z,{lang:"ts",children:t.texts[30].value}),(0,e.jsxs)("h4",{id:"attachmentfiletypesadd",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#attachmentfiletypesadd",children:(0,e.jsx)("span",{className:"icon icon-link"})}),(0,e.jsx)("code",{children:t.texts[31].value})]}),(0,e.jsxs)("p",{children:[t.texts[32].value,(0,e.jsx)("code",{children:t.texts[33].value}),t.texts[34].value]}),(0,e.jsxs)("h4",{id:"attachmentfiletype",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#attachmentfiletype",children:(0,e.jsx)("span",{className:"icon icon-link"})}),(0,e.jsx)("code",{children:t.texts[35].value})]}),(0,e.jsxs)("h5",{id:"match",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#match",children:(0,e.jsx)("span",{className:"icon icon-link"})}),(0,e.jsx)("code",{children:t.texts[36].value})]}),(0,e.jsx)("p",{children:t.texts[37].value}),(0,e.jsxs)("p",{children:[t.texts[38].value,(0,e.jsx)("code",{children:t.texts[39].value}),t.texts[40].value]}),(0,e.jsxs)("ul",{children:[(0,e.jsxs)("li",{children:[(0,e.jsx)("code",{children:t.texts[41].value}),t.texts[42].value]}),(0,e.jsxs)("li",{children:[(0,e.jsx)("code",{children:t.texts[43].value}),t.texts[44].value]}),(0,e.jsxs)("li",{children:[(0,e.jsx)("code",{children:t.texts[45].value}),t.texts[46].value]}),(0,e.jsxs)("li",{children:[(0,e.jsx)("code",{children:t.texts[47].value}),t.texts[48].value]})]}),(0,e.jsxs)("p",{children:[t.texts[49].value,(0,e.jsx)("code",{children:t.texts[50].value}),t.texts[51].value]}),(0,e.jsxs)("h5",{id:"previewer",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#previewer",children:(0,e.jsx)("span",{className:"icon icon-link"})}),(0,e.jsx)("code",{children:t.texts[52].value})]}),(0,e.jsx)("p",{children:t.texts[53].value}),(0,e.jsx)("p",{children:t.texts[54].value}),(0,e.jsxs)("ul",{children:[(0,e.jsxs)("li",{children:[(0,e.jsx)("code",{children:t.texts[55].value}),t.texts[56].value]}),(0,e.jsxs)("li",{children:[(0,e.jsx)("code",{children:t.texts[57].value}),t.texts[58].value]}),(0,e.jsxs)("li",{children:[(0,e.jsx)("code",{children:t.texts[59].value}),t.texts[60].value]})]}),(0,e.jsxs)("p",{children:[t.texts[61].value,(0,e.jsx)("code",{children:t.texts[62].value}),t.texts[63].value,(0,e.jsx)("code",{children:t.texts[64].value}),t.texts[65].value]}),(0,e.jsx)(d.Z,{lang:"ts",children:t.texts[66].value})]})})})})}a.default=c},416501:function(i,a,n){n.r(a),n.d(a,{texts:function(){return l}});const l=[{value:"For uploaded files, the client UI can display different previews based on file types. The attachment field of file-manager uses a built-in browser-based (iframe) file preview capacity, supporting most file types (such as images, videos, audio, and PDFs) for direct preview in the browser. When a file type is not supported for browser preview or requires special interaction, additional preview components can be extended based on the file type.",paraId:0,tocIndex:1},{value:"For example, if you want to extend a carousel component for image files, you can use the following code:",paraId:1,tocIndex:2},{value:`import match from 'mime-match';
import { Plugin, attachmentFileTypes } from '@nocobase/client';

class MyPlugin extends Plugin {
  load() {
    attachmentFileTypes.add({
      match(file) {
        return match(file.mimetype, 'image/*');
      },
      Previewer({ index, list, onSwitchIndex }) {
        const onDownload = useCallback(
          (e) => {
            e.preventDefault();
            const file = list[index];
            saveAs(file.url, \`\${file.title}\${file.extname}\`);
          },
          [index, list],
        );
        return (
          <LightBox
            // discourageDownloads={true}
            mainSrc={list[index]?.url}
            nextSrc={list[(index + 1) % list.length]?.url}
            prevSrc={list[(index + list.length - 1) % list.length]?.url}
            onCloseRequest={() => onSwitchIndex(null)}
            onMovePrevRequest={() => onSwitchIndex((index + list.length - 1) % list.length)}
            onMoveNextRequest={() => onSwitchIndex((index + 1) % list.length)}
            imageTitle={list[index]?.title}
            toolbarButtons={[
              <button
                key={'preview-img'}
                style={{ fontSize: 22, background: 'none', lineHeight: 1 }}
                type="button"
                aria-label="Download"
                title="Download"
                className="ril-zoom-in ril__toolbarItemChild ril__builtinButton"
                onClick={onDownload}
              >
                <DownloadOutlined />
              </button>,
            ]}
          />
        );
      },
    });
  }
}
`,paraId:2,tocIndex:2},{value:"The ",paraId:3,tocIndex:2},{value:"attachmentFileTypes",paraId:3,tocIndex:2},{value:" is an entry object provided by the ",paraId:3,tocIndex:2},{value:"@nocobase/client",paraId:3,tocIndex:2},{value:" package for extending file types. You can use its ",paraId:3,tocIndex:2},{value:"add",paraId:3,tocIndex:2},{value:" method to extend a file type descriptor.",paraId:3,tocIndex:2},{value:"Each file type must implement a ",paraId:4,tocIndex:2},{value:"match()",paraId:4,tocIndex:2},{value:" method to check if the file type meets the requirements. In the example, the ",paraId:4,tocIndex:2},{value:"mime-match",paraId:4,tocIndex:2},{value:" package is used to check the file's ",paraId:4,tocIndex:2},{value:"mimetype",paraId:4,tocIndex:2},{value:" attribute. If it matches ",paraId:4,tocIndex:2},{value:"image/*",paraId:4,tocIndex:2},{value:", it is considered a file type that needs processing. If it does not match, it will fall back to the built-in type.",paraId:4,tocIndex:2},{value:"The ",paraId:5,tocIndex:2},{value:"Previewer",paraId:5,tocIndex:2},{value:" property on the type descriptor is the component used for previewing. When the file type matches, this component will be rendered for preview. It is generally recommended to use a modal component (like ",paraId:5,tocIndex:2},{value:"<Modal />",paraId:5,tocIndex:2},{value:") as the base container and place the preview and interactive content within that component to implement the preview functionality.",paraId:5,tocIndex:2},{value:`export interface FileModel {
  id: number;
  filename: string;
  path: string;
  title: string;
  url: string;
  extname: string;
  size: number;
  mimetype: string;
}

export interface PreviewerProps {
  index: number;
  list: FileModel[];
  onSwitchIndex(index): void;
}

export interface AttachmentFileType {
  match(file: any): boolean;
  Previewer?: React.ComponentType<PreviewerProps>;
}

export class AttachmentFileTypes {
  add(type: AttachmentFileType): void;
}
`,paraId:6,tocIndex:3},{value:"attachmentFileTypes",paraId:7},{value:"attachmentFileTypes",paraId:8,tocIndex:4},{value:" is a global instance which could be imported from ",paraId:8,tocIndex:4},{value:"@nocobase/client",paraId:8,tocIndex:4},{value:" package:",paraId:8,tocIndex:4},{value:`import { attachmentFileTypes } from '@nocobase/client';
`,paraId:9,tocIndex:4},{value:"attachmentFileTypes.add()",paraId:7},{value:"Register file type descriptor to the file type registry. The type of the descriptor is ",paraId:10,tocIndex:5},{value:"AttachmentFileType",paraId:10,tocIndex:5},{value:".",paraId:10,tocIndex:5},{value:"AttachmentFileType",paraId:7},{value:"match()",paraId:7},{value:"The match method of file type.",paraId:11,tocIndex:7},{value:"The argument ",paraId:12,tocIndex:7},{value:"file",paraId:12,tocIndex:7},{value:" is the uploaded file data object, including some properties could be used to check types.",paraId:12,tocIndex:7},{value:"mimetype",paraId:13,tocIndex:7},{value:": Mimetype",paraId:13,tocIndex:7},{value:"extname",paraId:13,tocIndex:7},{value:': Extension name of file, including "."',paraId:13,tocIndex:7},{value:"path",paraId:13,tocIndex:7},{value:": Relative path of the file storing",paraId:13,tocIndex:7},{value:"url",paraId:13,tocIndex:7},{value:": File URL",paraId:13,tocIndex:7},{value:"The return value type is ",paraId:14,tocIndex:7},{value:"boolean",paraId:14,tocIndex:7},{value:", means matched or not.",paraId:14,tocIndex:7},{value:"Previewer",paraId:7},{value:"Component used to preview file.",paraId:15,tocIndex:8},{value:"Props:",paraId:16,tocIndex:8},{value:"index",paraId:17,tocIndex:8},{value:": Index value in attachemnts list",paraId:17,tocIndex:8},{value:"list",paraId:17,tocIndex:8},{value:": Attachemnt list",paraId:17,tocIndex:8},{value:"onSwitchIndex",paraId:17,tocIndex:8},{value:": Method to switch preview index",paraId:17,tocIndex:8},{value:"For ",paraId:18,tocIndex:8},{value:"onSwitchIndex",paraId:18,tocIndex:8},{value:", any index value in the list could be used, to switch to other file. If ",paraId:18,tocIndex:8},{value:"null",paraId:18,tocIndex:8},{value:" is used as argument, the preview component will be closed.",paraId:18,tocIndex:8},{value:`onSwitchIndex(null);
`,paraId:19,tocIndex:8}]}}]);
