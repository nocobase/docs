"use strict";(self.webpackChunknocobase_docs=self.webpackChunknocobase_docs||[]).push([[30105],{260782:function(s,n,a){a.r(n);var o=a(572269),h=a(793359),_=a(861788),u=a(719977),x=a(20190),v=a(24268),d=a(496057),g=a(585939),p=a(28484),I=a(635206),m=a(375553),f=a(156266),j=a(572333),E=a(841118),b=a(39297),P=a(868526),w=a(605019),r=a(614651),i=a(280936),l=a(667294),t=a(18290),e=a(785893);function c(){return(0,e.jsx)(r.dY,{children:(0,e.jsx)(l.Suspense,{fallback:(0,e.jsx)(i.Z,{}),children:(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)("div",{className:"markdown",children:[(0,e.jsxs)("h1",{id:"collection-event",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#collection-event",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"Collection event"]}),(0,e.jsx)("p",{children:t.texts[0].value}),(0,e.jsxs)("h2",{id:"basic-usage",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#basic-usage",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"Basic Usage"]}),(0,e.jsx)("p",{children:t.texts[1].value}),(0,e.jsxs)("ol",{children:[(0,e.jsx)("li",{children:t.texts[2].value}),(0,e.jsx)("li",{children:t.texts[3].value}),(0,e.jsx)("li",{children:t.texts[4].value}),(0,e.jsx)("li",{children:t.texts[5].value})]}),(0,e.jsx)("p",{children:(0,e.jsx)("img",{src:"https://static-docs.nocobase.com/81275602742deb71e0c830eb97aa612c.png",alt:"Collection Events_Trigger Timing Selection"})}),(0,e.jsx)("p",{children:t.texts[6].value}),(0,e.jsx)("p",{children:(0,e.jsx)("img",{src:"https://static-docs.nocobase.com/874a1475f01298b3c00267b2b4674611.png",alt:"Collection Events_Selection of Fields that Have Changed"})}),(0,e.jsx)("p",{children:t.texts[7].value}),(0,e.jsx)("p",{children:(0,e.jsx)("img",{src:"https://static-docs.nocobase.com/264ae3835dcd75cee0eef7812c11fe0c.png",alt:"Collection Events_Configuring Conditions for Data Satisfying"})}),(0,e.jsx)("p",{children:t.texts[8].value}),(0,e.jsxs)("h2",{id:"related-tips",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#related-tips",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"Related Tips"]}),(0,e.jsxs)("h3",{id:"batch-data-action-triggering-is-not-supported",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#batch-data-action-triggering-is-not-supported",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"Batch data action triggering is not supported"]}),(0,e.jsx)("p",{children:t.texts[9].value}),(0,e.jsxs)("h3",{id:"data-operations-out-of-nocobase-application-will-not-trigger",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#data-operations-out-of-nocobase-application-will-not-trigger",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"Data operations out of NocoBase application will not trigger"]}),(0,e.jsx)("p",{children:t.texts[10].value}),(0,e.jsx)("p",{children:t.texts[11].value}),(0,e.jsxs)("h3",{id:"external-data-sources",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#external-data-sources",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"External Data Sources"]}),(0,e.jsxs)("p",{children:[t.texts[12].value,(0,e.jsx)("code",{children:t.texts[13].value}),t.texts[14].value]}),(0,e.jsxs)("h2",{id:"example",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#example",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"Example"]}),(0,e.jsx)("p",{children:t.texts[15].value}),(0,e.jsx)("p",{children:t.texts[16].value}),(0,e.jsxs)(d.Z,{children:[(0,e.jsx)("thead",{children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{children:t.texts[17].value}),(0,e.jsx)("th",{children:t.texts[18].value})]})}),(0,e.jsxs)("tbody",{children:[(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{children:t.texts[19].value}),(0,e.jsx)("td",{children:t.texts[20].value})]}),(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{children:t.texts[21].value}),(0,e.jsx)("td",{children:t.texts[22].value})]}),(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{children:t.texts[23].value}),(0,e.jsx)("td",{children:t.texts[24].value})]})]})]}),(0,e.jsxs)(d.Z,{children:[(0,e.jsx)("thead",{children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{children:t.texts[25].value}),(0,e.jsx)("th",{children:t.texts[26].value})]})}),(0,e.jsxs)("tbody",{children:[(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{children:t.texts[27].value}),(0,e.jsx)("td",{children:t.texts[28].value})]}),(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{children:t.texts[29].value}),(0,e.jsx)("td",{children:t.texts[30].value})]}),(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{children:t.texts[31].value}),(0,e.jsx)("td",{children:t.texts[32].value})]})]})]}),(0,e.jsx)("p",{children:t.texts[33].value}),(0,e.jsxs)(d.Z,{children:[(0,e.jsx)("thead",{children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{children:t.texts[34].value}),(0,e.jsx)("th",{children:t.texts[35].value}),(0,e.jsx)("th",{children:t.texts[36].value})]})}),(0,e.jsxs)("tbody",{children:[(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{children:t.texts[37].value}),(0,e.jsx)("td",{children:t.texts[38].value}),(0,e.jsx)("td",{children:t.texts[39].value})]}),(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{children:t.texts[40].value}),(0,e.jsx)("td",{children:t.texts[41].value}),(0,e.jsx)("td",{children:t.texts[42].value})]})]})]}),(0,e.jsx)("p",{children:t.texts[43].value}),(0,e.jsx)("p",{children:(0,e.jsx)("img",{src:"https://static-docs.nocobase.com/094392a870dddc65aeb20357f62ddc08.png",alt:"Collection Events_Example_Add Order Trigger"})}),(0,e.jsx)("p",{children:t.texts[44].value}),(0,e.jsxs)("ul",{children:[(0,e.jsx)("li",{children:t.texts[45].value}),(0,e.jsx)("li",{children:t.texts[46].value}),(0,e.jsx)("li",{children:t.texts[47].value}),(0,e.jsx)("li",{children:t.texts[48].value})]}),(0,e.jsx)("p",{children:t.texts[49].value}),(0,e.jsx)("p",{children:(0,e.jsx)("img",{src:"https://static-docs.nocobase.com/7713ea1aaa0f52a0dc3c92aba5e58f05.png",alt:"Collection Events_Example_Add Order Workflow Arrangement"})}),(0,e.jsx)("p",{children:t.texts[50].value}),(0,e.jsx)("p",{children:t.texts[51].value}),(0,e.jsx)("p",{children:(0,e.jsx)("img",{src:"https://static-docs.nocobase.com/24cbe51e24ba4804b3bd48d99415c54f.png",alt:"Collection Events_Example_Add Order Execution Result"})})]})})})})}n.default=c},18290:function(s,n,a){a.r(n),a.d(n,{texts:function(){return o}});const o=[{value:"Trigger types of collection events will listen for adding, deleting and updating events of the collection. When an action on the record of collection occurs and meets the configured conditions, the corresponding workflow will be triggered. For example, reducing the inventory of goods after adding a new order, waiting for manual review after adding a comment, etc.",paraId:0,tocIndex:0},{value:"There are several types of changes to the collection:",paraId:1,tocIndex:1},{value:"After a record added.",paraId:2,tocIndex:1},{value:"After a record updated.",paraId:2,tocIndex:1},{value:"After a record added or updated.",paraId:2,tocIndex:1},{value:"After a record deleted.",paraId:2,tocIndex:1},{value:"You can choose the timing of the trigger according to the needs of the business. When change type selected that includes updating a record, you can also limit the fields that have changed. Only when the selected fields change will the trigger condition be satisfied. If none are selected, it means that all fields changing will trigger.",paraId:3,tocIndex:1},{value:"In more detail, conditions can be configured for each field of the triggered record. It only triggers when the conditions of the fields are met.",paraId:4,tocIndex:1},{value:"After the collection event is triggered, the source record of the event will be injected into the execution plan as trigger context data for subsequent nodes to use as variables. However, when subsequent nodes need to use the association fields of this record, preloading of the association fields needs to be configured first. The selected association fields will be injected into the context after triggering and can be selected and used by path.",paraId:5,tocIndex:1},{value:"Collection events do not support triggering on batch data action for now. For example, when adding article record and simultaneously adding multiple tag records of the article (many-to-many relationship data), only the workflow for adding the article will be triggered, and the workflows for adding multiple tags simultaneously will not be triggered. For associating or adding of many-to-many association records, the workflow of the intermediate collection will not be triggered either.",paraId:6,tocIndex:3},{value:"Data actions on collections through HTTP API calls to the application interface can also trigger corresponding events. However, if the data changes are not made through the NodoBase application but directly through database operations, the corresponding events will not be triggered. For example, the triggers in the database itself will not be associated with workflows in the application.",paraId:7,tocIndex:4},{value:"Also, using the SQL node to operate on the database is equivalent to directly operating on the database and will not trigger collection events.",paraId:8,tocIndex:4},{value:"from ",paraId:9,tocIndex:5},{value:"0.20",paraId:9,tocIndex:5},{value:", workflow started to support external data sources. If an external data source plugin is used and the collection event is configured for an external data source, as long as the data operation on this data source is completed within the application (user addition, update, and workflow data operations, etc.), the corresponding collection event can be triggered. However, if the data change is made through other systems or directly within the external database, the collection event will not be triggered.",paraId:9,tocIndex:5},{value:"Take an example scenario of calculating the total price and deducting inventory after adding an order.",paraId:10,tocIndex:6},{value:"First, we create the product collection and the order collection, and the data model is as follows:",paraId:11,tocIndex:6},{value:"Field Name",paraId:12,tocIndex:6},{value:"Field Type",paraId:12,tocIndex:6},{value:"Product Name",paraId:12,tocIndex:6},{value:"Single Line Text",paraId:12,tocIndex:6},{value:"Price",paraId:12,tocIndex:6},{value:"Number",paraId:12,tocIndex:6},{value:"Inventory",paraId:12,tocIndex:6},{value:"Integer",paraId:12,tocIndex:6},{value:"Field Name",paraId:13,tocIndex:6},{value:"Field Type",paraId:13,tocIndex:6},{value:"Order Number",paraId:13,tocIndex:6},{value:"Auto Number",paraId:13,tocIndex:6},{value:"Order Product",paraId:13,tocIndex:6},{value:"Many-to-One (Product)",paraId:13,tocIndex:6},{value:"Order Total Price",paraId:13,tocIndex:6},{value:"Number",paraId:13,tocIndex:6},{value:"And add basic product data:",paraId:14,tocIndex:6},{value:"Product Name",paraId:15,tocIndex:6},{value:"Price",paraId:15,tocIndex:6},{value:"Inventory",paraId:15,tocIndex:6},{value:"iPhone 14 Pro",paraId:15,tocIndex:6},{value:"7999",paraId:15,tocIndex:6},{value:"10",paraId:15,tocIndex:6},{value:"iPhone 13 Pro",paraId:15,tocIndex:6},{value:"5999",paraId:15,tocIndex:6},{value:"0",paraId:15,tocIndex:6},{value:"Then create a workflow based on the collection event of the order:",paraId:16,tocIndex:6},{value:"Several configuration items:",paraId:17,tocIndex:6},{value:'Data collection: Select the "Order" table.',paraId:18,tocIndex:6},{value:'Trigger on: Select "After Adding Data" trigger.',paraId:18,tocIndex:6},{value:"Condition: Leave it blank.",paraId:18,tocIndex:6},{value:'Preload associations: Check "Product".',paraId:18,tocIndex:6},{value:"Then configure other nodes based on the logic of the workflow, check if the product inventory is greater than 0, and deduct inventory if it is, otherwise delete the order as it is invalid:",paraId:19,tocIndex:6},{value:"The configuration of the nodes will be detailed in the documentation of the specific types.",paraId:20,tocIndex:6},{value:'Enable the workflow and test by adding an order through the UI. After placing an order for "iPhone 14 Pro", the inventory of the corresponding product will be reduced to 9. However, if an order is placed for "iPhone 13 Pro", the order will be deleted due to insufficient inventory.',paraId:21,tocIndex:6}]}}]);
