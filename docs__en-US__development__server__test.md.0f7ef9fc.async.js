"use strict";(self.webpackChunknocobase_docs=self.webpackChunknocobase_docs||[]).push([[50699],{10389:function(d,s,n){n.r(s);var r=n(572269),_=n(793359),p=n(861788),i=n(719977),x=n(20190),t=n(24268),m=n(496057),h=n(585939),v=n(28484),I=n(635206),j=n(375553),g=n(156266),E=n(572333),b=n(841118),f=n(39297),P=n(868526),y=n(605019),l=n(614651),o=n(280936),c=n(667294),a=n(65156),e=n(785893);function u(){return(0,e.jsx)(l.dY,{children:(0,e.jsx)(c.Suspense,{fallback:(0,e.jsx)(o.Z,{}),children:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:"markdown",children:[(0,e.jsxs)("h1",{id:"testing",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#testing",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"Testing"]}),(0,e.jsxs)("p",{children:[a.texts[0].value,(0,e.jsx)("a",{href:"https://jestjs.io/",children:a.texts[1].value}),a.texts[2].value,(0,e.jsx)("code",{children:a.texts[3].value}),a.texts[4].value,(0,e.jsx)("code",{children:a.texts[5].value}),a.texts[6].value]})]}),(0,e.jsx)(i.Z,{type:"warning",children:(0,e.jsxs)("p",{children:[a.texts[7].value,(0,e.jsx)("code",{children:a.texts[8].value}),a.texts[9].value]})}),(0,e.jsxs)("div",{className:"markdown",children:[(0,e.jsxs)("h2",{id:"mockdatabase",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#mockdatabase",children:(0,e.jsx)("span",{className:"icon icon-link"})}),(0,e.jsx)("code",{children:a.texts[10].value})]}),(0,e.jsx)("p",{children:a.texts[11].value}),(0,e.jsx)(t.Z,{lang:"ts",children:a.texts[12].value}),(0,e.jsxs)("h2",{id:"mockserver",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#mockserver",children:(0,e.jsx)("span",{className:"icon icon-link"})}),(0,e.jsx)("code",{children:a.texts[13].value})]}),(0,e.jsxs)("p",{children:[a.texts[14].value,(0,e.jsx)("code",{children:a.texts[15].value}),a.texts[16].value,(0,e.jsx)("code",{children:a.texts[17].value}),a.texts[18].value,(0,e.jsx)("code",{children:a.texts[19].value}),a.texts[20].value]}),(0,e.jsx)(t.Z,{lang:"ts",children:a.texts[21].value}),(0,e.jsxs)("h2",{id:"common-application-processes",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#common-application-processes",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"Common Application Processes"]}),(0,e.jsx)("p",{children:a.texts[22].value}),(0,e.jsxs)("h3",{id:"install-then-start",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#install-then-start",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"Install then Start"]}),(0,e.jsx)("p",{children:a.texts[23].value}),(0,e.jsx)(t.Z,{lang:"bash",children:a.texts[24].value}),(0,e.jsx)("p",{children:a.texts[25].value}),(0,e.jsx)(t.Z,{lang:"ts",children:a.texts[26].value}),(0,e.jsxs)("h3",{id:"start-then-install",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#start-then-install",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"Start then Install"]}),(0,e.jsx)("p",{children:a.texts[27].value}),(0,e.jsx)(t.Z,{lang:"bash",children:a.texts[28].value}),(0,e.jsx)("p",{children:a.texts[29].value}),(0,e.jsx)(t.Z,{lang:"ts",children:a.texts[30].value}),(0,e.jsxs)("h3",{id:"quickstart-auto-install-or-upgrade",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#quickstart-auto-install-or-upgrade",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"Quickstart (Auto Install or Upgrade)"]}),(0,e.jsx)("p",{children:a.texts[31].value}),(0,e.jsx)(t.Z,{lang:"bash",children:a.texts[32].value}),(0,e.jsx)("p",{children:a.texts[33].value}),(0,e.jsx)(t.Z,{lang:"ts",children:a.texts[34].value}),(0,e.jsxs)("h3",{id:"reinstall-an-already-installed-and-started-application",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#reinstall-an-already-installed-and-started-application",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"Reinstall an Already Installed and Started Application"]}),(0,e.jsx)("p",{children:a.texts[35].value}),(0,e.jsx)(t.Z,{lang:"bash",children:a.texts[36].value}),(0,e.jsx)("p",{children:a.texts[37].value}),(0,e.jsx)(t.Z,{lang:"ts",children:a.texts[38].value}),(0,e.jsxs)("h3",{id:"upgrade-the-application-before-starting",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#upgrade-the-application-before-starting",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"Upgrade the Application (Before Starting)"]}),(0,e.jsx)("p",{children:a.texts[39].value}),(0,e.jsx)(t.Z,{lang:"bash",children:a.texts[40].value}),(0,e.jsx)("p",{children:a.texts[41].value}),(0,e.jsx)(t.Z,{lang:"ts",children:a.texts[42].value}),(0,e.jsxs)("h3",{id:"upgrade-the-application-after-starting",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#upgrade-the-application-after-starting",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"Upgrade the Application (After Starting)"]}),(0,e.jsx)(t.Z,{lang:"bash",children:a.texts[43].value}),(0,e.jsx)("p",{children:a.texts[44].value}),(0,e.jsx)(t.Z,{lang:"ts",children:a.texts[45].value}),(0,e.jsxs)("h3",{id:"activate-a-plugin",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#activate-a-plugin",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"Activate a Plugin"]}),(0,e.jsx)("p",{children:a.texts[46].value}),(0,e.jsx)(t.Z,{lang:"bash",children:a.texts[47].value}),(0,e.jsx)("p",{children:a.texts[48].value}),(0,e.jsx)(t.Z,{lang:"ts",children:a.texts[49].value}),(0,e.jsxs)("h3",{id:"disable-a-plugin",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#disable-a-plugin",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"Disable a Plugin"]}),(0,e.jsx)("p",{children:a.texts[50].value}),(0,e.jsx)(t.Z,{lang:"bash",children:a.texts[51].value}),(0,e.jsx)("p",{children:a.texts[52].value}),(0,e.jsx)(t.Z,{lang:"ts",children:a.texts[53].value})]})]})})})}s.default=u},65156:function(d,s,n){n.r(s),n.d(s,{texts:function(){return r}});const r=[{value:"Testing is based on the ",paraId:0,tocIndex:0},{value:"Jest",paraId:0,tocIndex:0},{value:" testing framework. To facilitate writing tests, ",paraId:0,tocIndex:0},{value:"mockDatabase()",paraId:0,tocIndex:0},{value:" and ",paraId:0,tocIndex:0},{value:"mockServer()",paraId:0,tocIndex:0},{value:" are provided for testing database and server-side applications.",paraId:0,tocIndex:0},{value:"The test environment variables are configured in the ",paraId:1},{value:".env.test",paraId:1},{value:" file. It's recommended to use a separate test database for testing.",paraId:1},{value:"mockDatabase()",paraId:2},{value:"A fully isolated db testing environment is provided by default.",paraId:3,tocIndex:1},{value:`import { mockDatabase } from '@nocobase/test';

describe('my db suite', () => {
  let db;

  beforeEach(async () => {
    db = mockDatabase();
    db.collection({
      name: 'posts',
      fields: [
        {
          type: 'string',
          name: 'title',
        },
      ],
    });
    await db.sync();
  });

  afterEach(async () => {
    await db.close();
  });

  test('my case', async () => {
    const repository = db.getRepository('posts');
    const post = await repository.create({
      values: {
        title: 'hello',
      },
    });

    expect(post.get('title')).toEqual('hello');
  });
});
`,paraId:4,tocIndex:1},{value:"mockServer()",paraId:2},{value:"A mock server application instance is provided, with the corresponding app.db being a ",paraId:5,tocIndex:2},{value:"mockDatabase()",paraId:5,tocIndex:2},{value:" instance. Additionally, a convenient ",paraId:5,tocIndex:2},{value:"app.agent()",paraId:5,tocIndex:2},{value:" is available for testing HTTP APIs. For Resource Action specific to NocoBase, ",paraId:5,tocIndex:2},{value:"app.agent().resource()",paraId:5,tocIndex:2},{value:" is encapsulated for testing the Action of resources.",paraId:5,tocIndex:2},{value:`import { MockServer, mockServer } from '@nocobase/test';

// Each plugin's minimal installation app is different, the necessary plugins need to be added according to their own conditions.
async function createApp(options: any = {}) {
  const app = mockServer({
    ...options,
    plugins: [
      'acl',
      'users',
      'collection-manager',
      'error-handler',
      ...options.plugins,
    ],
    // Other configuration parameters might also be present.
  });
  // Here, some logic that needs special handling can be supplemented, such as importing data tables needed for testing.
  return app;
}

// Most tests need to start the application, so a common startup method can also be provided.
async function startApp() {
  const app = createApp();
  await app.quickstart({
    // Before running tests, clear the database.
    clean: true,
  });
  return app;
}

describe('test example', () => {
  let app: MockServer;

  beforeEach(async () => {
    app = await startApp();
  });

  afterEach(async () => {
    // After running the tests, clear the database.
    await app.destroy();
    // Stop without clearing the database.
    await app.stop();
  });

  test('case1', async () => {
    // coding...
  });
});
`,paraId:6,tocIndex:2},{value:"If you need to test different processes, you can execute related commands according to the following examples.",paraId:7,tocIndex:3},{value:"Terminal command line",paraId:8,tocIndex:4},{value:`yarn nocobase install
yarn start
`,paraId:9,tocIndex:4},{value:"Preliminary test process",paraId:10,tocIndex:4},{value:`const app = mockServer();
await app.runCommand('install');
await app.runCommand('start');
`,paraId:11,tocIndex:4},{value:"Terminal command line",paraId:12,tocIndex:5},{value:`yarn start # Stay in memory
# Execute in another terminal
yarn nocobase install
`,paraId:13,tocIndex:5},{value:"Preliminary test process",paraId:14,tocIndex:5},{value:`const app = mockServer();
await app.runCommand('start');
await app.runCommand('install');
`,paraId:15,tocIndex:5},{value:"Terminal command line",paraId:16,tocIndex:6},{value:`yarn start --quickstart
`,paraId:17,tocIndex:6},{value:"Preliminary test process",paraId:18,tocIndex:6},{value:`const app = mockServer();
await app.runCommand('start', '--quickstart');
`,paraId:19,tocIndex:6},{value:"Terminal command line",paraId:20,tocIndex:7},{value:`yarn start --quickstart
# Execute in another terminal
yarn nocobase install -f
`,paraId:21,tocIndex:7},{value:"Preliminary test process",paraId:22,tocIndex:7},{value:`const app = mockServer();
await app.runCommand('start', '--quickstart');
await app.runCommand('install', '-f');
`,paraId:23,tocIndex:7},{value:"Terminal command line",paraId:24,tocIndex:8},{value:`yarn nocobase upgrade
yarn start
`,paraId:25,tocIndex:8},{value:"Preliminary test process",paraId:26,tocIndex:8},{value:`const app = mockServer();
await app.runCommand('upgrade', '-f');
await app.runCommand('start', '--quickstart');
`,paraId:27,tocIndex:8},{value:`yarn start # Stay in memory
# Execute in another terminal
yarn nocobase upgrade
`,paraId:28,tocIndex:9},{value:"Preliminary test process",paraId:29,tocIndex:9},{value:`const app = mockServer();
await app.runCommand('start', '--quickstart');
await app.runCommand('upgrade', '-f');
`,paraId:30,tocIndex:9},{value:"Terminal command line",paraId:31,tocIndex:10},{value:`yarn start --quickstart
yarn pm enable @my-project/plugin-hello
`,paraId:32,tocIndex:10},{value:"Preliminary test process",paraId:33,tocIndex:10},{value:`const app = mockServer();
await app.runCommand('start', '--quickstart');
await app.runCommand('pm', 'enable', '@my-project/plugin-hello');
`,paraId:34,tocIndex:10},{value:"Terminal command line",paraId:35,tocIndex:11},{value:`yarn start --quickstart
yarn pm disable @my-project/plugin-hello
`,paraId:36,tocIndex:11},{value:"Preliminary test process",paraId:37,tocIndex:11},{value:`const app = mockServer();
await app.runCommand('start', '--quickstart');
await app.runCommand('pm', 'disable', '@my-project/plugin-hello');
`,paraId:38,tocIndex:11}]}}]);
