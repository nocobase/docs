"use strict";(self.webpackChunknocobase_docs=self.webpackChunknocobase_docs||[]).push([[45716],{970949:function(r,o,t){t.r(o);var d=t(572269),u=t(793359),h=t(861788),x=t(719977),p=t(20190),a=t(24268),m=t(496057),v=t(585939),_=t(28484),I=t(635206),f=t(375553),g=t(156266),j=t(572333),b=t(841118),D=t(39297),E=t(868526),P=t(605019),s=t(614651),i=t(280936),l=t(667294),n=t(283015),e=t(785893);function c(){return(0,e.jsx)(s.dY,{children:(0,e.jsx)(l.Suspense,{fallback:(0,e.jsx)(i.Z,{}),children:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:"markdown",children:[(0,e.jsxs)("h1",{id:"designable",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#designable",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"Designable"]}),(0,e.jsxs)("p",{children:[n.texts[0].value,(0,e.jsx)("code",{children:n.texts[1].value}),n.texts[2].value]}),(0,e.jsx)(a.Z,{lang:"ts",children:n.texts[3].value}),(0,e.jsxs)("p",{children:[n.texts[4].value,(0,e.jsx)("code",{children:n.texts[5].value}),n.texts[6].value]}),(0,e.jsx)(a.Z,{lang:"javascript",children:n.texts[7].value}),(0,e.jsxs)("h2",{id:"createdesignable-vs-usedesignable",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#createdesignable-vs-usedesignable",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"createDesignable vs useDesignable"]}),(0,e.jsxs)("ul",{children:[(0,e.jsxs)("li",{children:[(0,e.jsx)("code",{children:n.texts[8].value}),n.texts[9].value,(0,e.jsx)("code",{children:n.texts[10].value}),n.texts[11].value,(0,e.jsx)("code",{children:n.texts[12].value}),n.texts[13].value,(0,e.jsx)("code",{children:n.texts[14].value}),n.texts[15].value]}),(0,e.jsxs)("li",{children:[(0,e.jsx)("code",{children:n.texts[16].value}),n.texts[17].value,(0,e.jsx)("code",{children:n.texts[18].value}),n.texts[19].value]}),(0,e.jsxs)("li",{children:[(0,e.jsx)("code",{children:n.texts[20].value}),n.texts[21].value,(0,e.jsx)("code",{children:n.texts[22].value}),n.texts[23].value,(0,e.jsx)("code",{children:n.texts[24].value}),n.texts[25].value]})]}),(0,e.jsx)("p",{children:n.texts[26].value}),(0,e.jsxs)("ul",{children:[(0,e.jsxs)("li",{children:[n.texts[27].value,(0,e.jsx)("code",{children:n.texts[28].value}),n.texts[29].value]}),(0,e.jsxs)("li",{children:[n.texts[30].value,(0,e.jsx)("code",{children:n.texts[31].value}),n.texts[32].value]}),(0,e.jsxs)("li",{children:[n.texts[33].value,(0,e.jsx)("code",{children:n.texts[34].value}),n.texts[35].value]})]}),(0,e.jsxs)("h2",{id:"design-capabilities-of-designable",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#design-capabilities-of-designable",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"Design capabilities of designable"]}),(0,e.jsx)("p",{children:n.texts[36].value}),(0,e.jsxs)("ul",{children:[(0,e.jsx)("li",{children:n.texts[37].value}),(0,e.jsx)("li",{children:n.texts[38].value}),(0,e.jsx)("li",{children:n.texts[39].value}),(0,e.jsx)("li",{children:n.texts[40].value}),(0,e.jsx)("li",{children:n.texts[41].value})]}),(0,e.jsxs)("h3",{id:"add-insert-at-an-adjacent-position-of-the-current-node",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#add-insert-at-an-adjacent-position-of-the-current-node",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"Add: Insert at an adjacent position of the current node"]}),(0,e.jsxs)("p",{children:[n.texts[42].value,(0,e.jsx)("a",{href:"https://dom.spec.whatwg.org/#insert-adjacent",children:n.texts[43].value}),n.texts[44].value,(0,e.jsx)("code",{children:n.texts[45].value}),n.texts[46].value]}),(0,e.jsx)("p",{children:n.texts[47].value}),(0,e.jsx)(a.Z,{lang:"html",children:n.texts[48].value}),(0,e.jsx)("p",{children:n.texts[49].value}),(0,e.jsx)(a.Z,{lang:"ts",children:n.texts[50].value}),(0,e.jsxs)("p",{children:[n.texts[51].value,(0,e.jsx)("code",{children:n.texts[52].value}),n.texts[53].value]})]}),(0,e.jsx)(s.Dl,{demo:{id:"docs-en-us-development-client-ui-schema-designable-demo-0"},previewerProps:{}}),(0,e.jsx)("div",{className:"markdown",children:(0,e.jsxs)("p",{children:[n.texts[54].value,(0,e.jsx)("code",{children:n.texts[55].value}),n.texts[56].value]})}),(0,e.jsx)(s.Dl,{demo:{id:"docs-en-us-development-client-ui-schema-designable-demo-1"},previewerProps:{}}),(0,e.jsxs)("div",{className:"markdown",children:[(0,e.jsxs)("h3",{id:"query-find-child-nodes",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#query-find-child-nodes",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"Query: Find child nodes"]}),(0,e.jsxs)("p",{children:[n.texts[57].value,(0,e.jsx)("code",{children:n.texts[58].value}),n.texts[59].value,(0,e.jsx)("code",{children:n.texts[60].value}),n.texts[61].value,(0,e.jsx)("code",{children:n.texts[62].value}),n.texts[63].value]}),(0,e.jsxs)("h4",{id:"findproperties",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#findproperties",children:(0,e.jsx)("span",{className:"icon icon-link"})}),(0,e.jsx)("code",{children:n.texts[64].value})]}),(0,e.jsx)("p",{children:n.texts[65].value}),(0,e.jsx)(a.Z,{lang:"ts",children:n.texts[66].value}),(0,e.jsx)("p",{children:n.texts[67].value}),(0,e.jsx)(a.Z,{lang:"ts",children:n.texts[68].value}),(0,e.jsxs)("h4",{id:"findproperty",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#findproperty",children:(0,e.jsx)("span",{className:"icon icon-link"})}),(0,e.jsx)("code",{children:n.texts[69].value})]}),(0,e.jsx)("p",{children:n.texts[70].value}),(0,e.jsx)(a.Z,{lang:"ts",children:n.texts[71].value}),(0,e.jsx)("p",{children:n.texts[72].value}),(0,e.jsx)(a.Z,{lang:"ts",children:n.texts[73].value}),(0,e.jsxs)("h3",{id:"modify-change-schema-parameters",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#modify-change-schema-parameters",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"Modify: Change schema parameters"]}),(0,e.jsx)(a.Z,{lang:"ts",children:n.texts[74].value}),(0,e.jsxs)("h3",{id:"delete-delete-the-current-node-or-a-specific-child-node",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#delete-delete-the-current-node-or-a-specific-child-node",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"Delete: Delete the current node or a specific child node"]}),(0,e.jsx)(a.Z,{lang:"ts",children:n.texts[75].value}),(0,e.jsxs)("h3",{id:"move-move-between-nodes",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#move-move-between-nodes",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"Move: Move between nodes"]}),(0,e.jsxs)("p",{children:[(0,e.jsx)("code",{children:n.texts[76].value}),n.texts[77].value]}),(0,e.jsx)(a.Z,{lang:"javascript",children:n.texts[78].value})]})]})})})}o.default=c},283015:function(r,o,t){t.r(o),t.d(o,{texts:function(){return d}});const d=[{value:"NocoBase provides design capabilities for Schema through the ",paraId:0,tocIndex:0},{value:"createDesignable()",paraId:0,tocIndex:0},{value:" method.",paraId:0,tocIndex:0},{value:`import React from 'react';
import { Schema } from '@formily/json-schema';
import { createDesignable } from '@nocobase/client';

// Create a schema example
const current = new Schema({
  name: 'root',
  type: 'void',
  'x-component': 'Page',
});

// Create a designable for the current schema
const dn = createDesignable({
  current,
});

// Add a hello node inside the schema node
dn.insertAfterBegin({
  name: 'hello',
  type: 'void',
  'x-component': 'Hello',
});

console.log(current.toJSON());
{
  "name": "root",
  "type": "void",
  "x-component": "Page",
  "properties": {
    "hello": {
      "type": "void",
      "name": "hello",
      "x-component": "Hello",
      "x-index": 0
    }
  }
}
`,paraId:1,tocIndex:0},{value:"In the Schema component, ",paraId:2,tocIndex:0},{value:"useDesignable()",paraId:2,tocIndex:0},{value:" can be directly used to handle the current Schema node.",paraId:2,tocIndex:0},{value:`import React from 'react';
import { Button } from 'antd';
import {
  SchemaComponent,
  SchemaComponentProvider,
  useDesignable,
} from '@nocobase.client';

const Hello = () => <h1>Hello, world!</h1>;

const Page = (props) => {
  const dn = useDesignable();
  return (
    <div>
      <Button
        onClick={() => {
          dn.insertAfterBegin({
            type: 'void',
            'x-component': 'Hello',
          });
        }}
      >
        Click to add a child node
      </Button>
      {props.children}
    </div>
  );
};

const schema = {
  type: 'void',
  name: 'page',
  'x-component': 'Page',
};

export default () => {
  return (
    <SchemaComponentProvider components={{ Page, Hello }}>
      <SchemaComponent schema={schema} />
    </SchemaComponentProvider>
  );
};
`,paraId:3,tocIndex:0},{value:"createDesignable",paraId:4,tocIndex:1},{value:" requires the ",paraId:4,tocIndex:1},{value:"current",paraId:4,tocIndex:1},{value:" parameter, while ",paraId:4,tocIndex:1},{value:"useDesignable",paraId:4,tocIndex:1},{value:" is used directly on the current node without needing ",paraId:4,tocIndex:1},{value:"current",paraId:4,tocIndex:1},{value:".",paraId:4,tocIndex:1},{value:"createDesignable",paraId:4,tocIndex:1},{value:" can be used in events, while ",paraId:4,tocIndex:1},{value:"useDesignable",paraId:4,tocIndex:1},{value:" is a React hook method that must be executed first.",paraId:4,tocIndex:1},{value:"createDesignable",paraId:4,tocIndex:1},{value:"'s ",paraId:4,tocIndex:1},{value:"current",paraId:4,tocIndex:1},{value:" can be any schema, while ",paraId:4,tocIndex:1},{value:"useDesignable",paraId:4,tocIndex:1},{value:" can only be the current schema.",paraId:4,tocIndex:1},{value:"Use cases:",paraId:5,tocIndex:1},{value:"If it's clear that the operation is on the current node, using ",paraId:6,tocIndex:1},{value:"useDesignable",paraId:6,tocIndex:1},{value:" is more convenient.",paraId:6,tocIndex:1},{value:"If the operation is not on the current node, ",paraId:6,tocIndex:1},{value:"createDesignable",paraId:6,tocIndex:1},{value:" is more appropriate.",paraId:6,tocIndex:1},{value:"If the operation is triggered by an event, such as drag and drop, ",paraId:6,tocIndex:1},{value:"createDesignable",paraId:6,tocIndex:1},{value:" is more suitable.",paraId:6,tocIndex:1},{value:"The design capabilities provided by designable for schema are reflected in:",paraId:7,tocIndex:2},{value:"Add: Insert at an adjacent position of the current node.",paraId:8,tocIndex:2},{value:"Query: Find child nodes.",paraId:8,tocIndex:2},{value:"Modify: Change schema parameters via patch.",paraId:8,tocIndex:2},{value:"Delete: Delete the current node or a specific child node.",paraId:8,tocIndex:2},{value:"Move: Move between nodes.",paraId:8,tocIndex:2},{value:"Similar to the DOM's ",paraId:9,tocIndex:3},{value:"insert adjacent",paraId:9,tocIndex:3},{value:" concept, Schema also provides the ",paraId:9,tocIndex:3},{value:"insertAdjacent()",paraId:9,tocIndex:3},{value:" method for resolving adjacent position insertion issues.",paraId:9,tocIndex:3},{value:"Four adjacent positions:",paraId:10,tocIndex:3},{value:`<!-- root -->
<div>
  <!-- beforeBegin Insert before the current node -->
  <p>
    <!-- afterBegin Insert before the first child of the current node -->
    ...
    <!-- beforeEnd Insert after the last child of the current node -->
  </p>
  <!-- afterEnd Insert after the current node -->
</div>
`,paraId:11,tocIndex:3},{value:"The Schema is written as follows:",paraId:12,tocIndex:3},{value:`{
  type: 'void',
  'x-component': 'div',
  properties: {
    // beforeBegin Insert before the current node
    node1: {
      type: 'void',
      'x-component': 'p',
      properties: {
        // afterBegin Insert before the first child of the current node
        // ...
        // beforeEnd Insert after the last child of the current node
      },
    },
    // afterEnd Insert after the current node
  },
}
`,paraId:13,tocIndex:3},{value:"Use ",paraId:14,tocIndex:3},{value:"useDesignable()",paraId:14,tocIndex:3},{value:" to insert at an adjacent position of the current schema.",paraId:14,tocIndex:3},{value:"Use ",paraId:15},{value:"createDesignable()",paraId:15},{value:" to insert at an adjacent position of a specified schema.",paraId:15},{value:"formily's json-schema provides ",paraId:16,tocIndex:4},{value:"reduceProperties",paraId:16,tocIndex:4},{value:" for traversing and finding nodes, but it's too cumbersome to use. Therefore, Designable provides easier-to-use ",paraId:16,tocIndex:4},{value:"findProperties",paraId:16,tocIndex:4},{value:" and ",paraId:16,tocIndex:4},{value:"findProperty",paraId:16,tocIndex:4},{value:" methods to find child nodes.",paraId:16,tocIndex:4},{value:"findProperties",paraId:17},{value:"Find all child nodes that meet the conditions and return an array.",paraId:18,tocIndex:5},{value:`interface FindOptions {
  // Filter conditions
  filter: any;
  // Elements to skip during the search
  skipOn?: (s: Schema) => boolean;
  // Exit when finding a certain element
  breakOn?: (s: Schema) => boolean;
  // Recursive search
  recursive?: boolean;
}

class Designable {
  findProperties(options: FindOptions): Schema[];
}
`,paraId:19,tocIndex:5},{value:"Example to find all nodes that meet the conditions:",paraId:20,tocIndex:5},{value:`const items = dn.findProperties({
  filter: {
    'x-component': 'Hello',
  },
});
// [current.properties.hello1, current.properties.hello2]
console.log(items.map((s) => schema.toJSON()));
[
  {
    name: 'hello1',
    type: 'void',
    'x-component': 'Hello',
  },
  {
    name: 'hello2',
    type: 'void',
    'x-component': 'Hello',
  },
];
`,paraId:21,tocIndex:5},{value:"findProperty",paraId:17},{value:"Find the first child node that meets the conditions.",paraId:22,tocIndex:6},{value:`interface FindOptions {
  // Filter conditions
  filter: any;
  // Elements to skip during the search
  skipOn?: (s: Schema) => boolean;
  // Exit when finding a certain element
  breakOn?: (s: Schema) => boolean;
  // Recursive search
  recursive?: boolean;
}

class Designable {
  findProperty(options: FindOptions): Schema | null;
}
`,paraId:23,tocIndex:6},{value:"Example:",paraId:24,tocIndex:6},{value:`const current = new Schema({
  name: 'root',
  type: 'void',
  'x-component': 'Page',
  properties: {
    hello1: {
      type: 'void',
      'x-component': 'Hello',
    },
    hello2: {
      type: 'void',
      'x-component': 'Hello',
    }
  }
});

const dn = createDesignable({ current });

const schema = dn.findProperty({
  filter: {
    'x-component': 'Hello',
  },
});
// current.properties.hello1
console.log(schema.toJSON());
{
  name: 'hello1',
  type: 'void',
  'x-component': 'Hello',
}
`,paraId:25,tocIndex:6},{value:`const current = new Schema({
  name: 'root',
  type: 'void',
  'x-component': 'Page',
});

const dn = createDesignable({
  current,
});

dn.deepMerge({
  'x-component-props': {},
});

dn.shallowMerge({
  'x-component-props': {},
});
`,paraId:26,tocIndex:7},{value:`const current = new Schema({
  name: 'root',
  type: 'void',
  'x-component': 'Page',
});

const dn = createDesignable({
  current,
});

dn.remove();

dn.remove({
  filter: (s) => boolean,
  skipOn: (s) => boolean,
  breakOn: (s) => boolean,
  recursive: true,
  removeParentsIfNoChildren: true,
});
`,paraId:27,tocIndex:8},{value:"insertAdjacent",paraId:28,tocIndex:9},{value:" and other methods can also be used for node drag and drop movement.",paraId:28,tocIndex:9},{value:`import React from 'react';
import { uid } from '@formily/shared';
import { observer, useField, useFieldSchema } from '@formily/react';
import {
  DndContext,
  DragEndEvent,
  useDraggable,
  useDroppable,
} from '@dnd-kit/core';
import {
  SchemaComponent,
  SchemaComponentProvider,
  createDesignable,
  useSchemaComponentContext,
} from '@nocobase/client';

const useDragEnd = () => {
  const { refresh } = useSchemaComponentContext();

  return ({ active, over }: DragEndEvent) => {
    const activeSchema = active?.data?.current?.schema;
    const overSchema = over?.data?.current?.schema;

    if (!activeSchema or !overSchema) {
      return;
    }

    if (activeSchema === overSchema) {
      return;
    }

    const dn = createDesignable({
      current: overSchema,
    });

    dn.on('insertAdjacent', refresh);
    dn.insertBeforeBeginOrAfterEnd(activeSchema);
  };
};

const Page = observer((props) => {
  return <DndContext onDragEnd={useDragEnd()}>{props.children}</DndContext>;
});

function Draggable(props) {
  const { attributes, listeners, setNodeRef, transform } = useDraggable({
    id: props.id,
    data: props.data,
  });
  const style = transform
    ? {
        transform: \`translate3d(\${transform.x}px, \${transform.y}px, 0)\`,
      }
    : undefined;

  return (
    <button ref={setNodeRef} style={style} {...listeners} {...attributes}>
      {props.children}
    </button>
  );
}

function Droppable(props) {
  const { isOver, setNodeRef } = useDroppable({
    id: props.id,
    data: props.data,
  });
  const style = {
    color: isOver ? 'green' : undefined,
  };

  return (
    <div ref={setNodeRef} style={style}>
      {props.children}
    </div>
  );
}

const Block = observer((props) => {
  const field = useField();
  const fieldSchema = useFieldSchema();
  return (
    <Droppable id={field.address.toString()} data={{ schema: fieldSchema }}>
      <div style={{ marginBottom: 20, padding: '20px', background: '#f1f1f1' }}>
        Block {fieldSchema.name}{' '}
        <Draggable id={field.address.toString()} data={{ schema: fieldSchema }}>
          Drag
        </Draggable>
      </div>
    </Droppable>
  );
});

export default function App() {
  return (
    <SchemaComponentProvider components={{ Page, Block }}>
      <SchemaComponent
        schema={{
          type: 'void',
          name: 'page',
          'x-component': 'Page',
          properties: {
            block1: {
              'x-component': 'Block',
            },
            block2: {
              'x-component': 'Block',
            },
            block3: {
              'x-component': 'Block',
            },
          },
        }}
      />
    </SchemaComponentProvider>
  );
}
`,paraId:29,tocIndex:9}]}}]);
