"use strict";(self.webpackChunknocobase_docs=self.webpackChunknocobase_docs||[]).push([[80551],{296563:function(l,s,a){a.r(s);var d=a(572269),c=a(793359),x=a(861788),_=a(719977),h=a(20190),n=a(24268),p=a(496057),v=a(585939),I=a(28484),m=a(635206),g=a(375553),j=a(156266),f=a(572333),P=a(841118),b=a(39297),E=a(868526),C=a(605019),o=a(614651),r=a(280936),i=a(667294),t=a(199098),e=a(785893);function u(){return(0,e.jsx)(o.dY,{children:(0,e.jsx)(i.Suspense,{fallback:(0,e.jsx)(r.Z,{}),children:(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)("div",{className:"markdown",children:[(0,e.jsxs)("h1",{id:"global-context",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#global-context",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"Global Context"]}),(0,e.jsx)("p",{children:t.texts[0].value}),(0,e.jsxs)("h2",{id:"example-overview",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#example-overview",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"Example Overview"]}),(0,e.jsx)("p",{children:t.texts[1].value}),(0,e.jsxs)("p",{children:[t.texts[2].value,(0,e.jsx)("a",{href:"https://github.com/nocobase/plugin-samples/tree/main/packages/plugins/%40nocobase-sample/plugin-provider-context",children:t.texts[3].value}),t.texts[4].value]}),(0,e.jsxs)("h2",{id:"plugin-initialization",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#plugin-initialization",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"Plugin Initialization"]}),(0,e.jsxs)("p",{children:[t.texts[5].value,(0,e.jsx)(o.rU,{to:"/development/your-first-plugin",children:t.texts[6].value}),t.texts[7].value]}),(0,e.jsx)(n.Z,{lang:"bash",children:t.texts[8].value}),(0,e.jsx)("p",{children:t.texts[9].value}),(0,e.jsx)(n.Z,{lang:"bash",children:t.texts[10].value}),(0,e.jsx)("p",{children:t.texts[11].value}),(0,e.jsx)(n.Z,{lang:"bash",children:t.texts[12].value}),(0,e.jsxs)("p",{children:[t.texts[13].value,(0,e.jsx)("a",{href:"http://localhost:13000/admin/pm/list/local/",children:t.texts[14].value}),t.texts[15].value]}),(0,e.jsxs)("h2",{id:"feature-implementation",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#feature-implementation",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"Feature Implementation"]}),(0,e.jsxs)("p",{children:[t.texts[16].value,(0,e.jsx)("code",{children:t.texts[17].value}),t.texts[18].value]}),(0,e.jsxs)("h3",{id:"1-creating-the-context",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#1-creating-the-context",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"1. Creating the Context"]}),(0,e.jsx)(n.Z,{lang:"tsx",children:t.texts[19].value}),(0,e.jsxs)("p",{children:[t.texts[20].value,(0,e.jsx)("code",{children:t.texts[21].value}),t.texts[22].value]}),(0,e.jsxs)("p",{children:[t.texts[23].value,(0,e.jsx)("code",{children:t.texts[24].value}),t.texts[25].value,(0,e.jsx)(o.rU,{to:"/plugin-samples/plugin-settings/form",children:t.texts[26].value}),t.texts[27].value]}),(0,e.jsxs)("h3",{id:"2-registering-the-plugin-into-the-system",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#2-registering-the-plugin-into-the-system",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"2. Registering the Plugin into the System"]}),(0,e.jsxs)("p",{children:[t.texts[28].value,(0,e.jsx)("code",{children:t.texts[29].value}),t.texts[30].value,(0,e.jsx)("code",{children:t.texts[31].value}),t.texts[32].value]}),(0,e.jsx)(n.Z,{lang:"tsx",children:t.texts[33].value}),(0,e.jsxs)("h3",{id:"3-accessing-context-data",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#3-accessing-context-data",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"3. Accessing Context Data"]}),(0,e.jsxs)("p",{children:[t.texts[34].value,(0,e.jsx)("code",{children:t.texts[35].value}),t.texts[36].value,(0,e.jsx)("code",{children:t.texts[37].value}),t.texts[38].value]}),(0,e.jsx)("p",{children:t.texts[39].value}),(0,e.jsxs)("h4",{id:"31-using-it-within-this-plugin",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#31-using-it-within-this-plugin",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"3.1 Using it Within This Plugin"]}),(0,e.jsxs)("p",{children:[t.texts[40].value,(0,e.jsx)("code",{children:t.texts[41].value}),t.texts[42].value]}),(0,e.jsx)(n.Z,{lang:"tsx",children:t.texts[43].value}),(0,e.jsxs)("p",{children:[t.texts[44].value,(0,e.jsx)("a",{href:"http://localhost:13000/admin/features-test",children:t.texts[45].value}),t.texts[46].value]}),(0,e.jsx)("p",{children:(0,e.jsx)("img",{src:"https://static-docs.nocobase.com/img_v3_02av_51b7cb08-1b42-42f4-b553-49b4e3f217bg.jpg",alt:"img_v3_02av_51b7cb08-1b42-42f4-b553-49b4e3f217bg"})}),(0,e.jsxs)("h4",{id:"32-using-it-in-other-plugins",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#32-using-it-in-other-plugins",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"3.2 Using it in Other Plugins"]}),(0,e.jsxs)("p",{children:[t.texts[47].value,(0,e.jsx)("code",{children:t.texts[48].value}),t.texts[49].value,(0,e.jsx)("code",{children:t.texts[50].value}),t.texts[51].value]}),(0,e.jsxs)("p",{children:[t.texts[52].value,(0,e.jsx)("code",{children:t.texts[53].value}),t.texts[54].value]}),(0,e.jsx)(n.Z,{lang:"tsx",children:t.texts[55].value}),(0,e.jsxs)("p",{children:[t.texts[56].value,(0,e.jsx)("code",{children:t.texts[57].value}),t.texts[58].value,(0,e.jsx)("code",{children:t.texts[59].value}),t.texts[60].value]}),(0,e.jsx)(n.Z,{lang:"tsx",children:t.texts[61].value}),(0,e.jsxs)("p",{children:[t.texts[62].value,(0,e.jsx)("code",{children:t.texts[63].value}),t.texts[64].value,(0,e.jsx)("code",{children:t.texts[65].value}),t.texts[66].value]}),(0,e.jsxs)("h2",{id:"packaging-and-deploying-to-production",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#packaging-and-deploying-to-production",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"Packaging and Deploying to Production"]}),(0,e.jsxs)("p",{children:[t.texts[67].value,(0,e.jsx)(o.rU,{to:"/development/your-first-plugin#build-and-package-plugin",children:t.texts[68].value}),t.texts[69].value]}),(0,e.jsx)("p",{children:t.texts[70].value}),(0,e.jsx)(n.Z,{lang:"bash",children:t.texts[71].value}),(0,e.jsxs)("p",{children:[t.texts[72].value,(0,e.jsx)("code",{children:t.texts[73].value}),t.texts[74].value]}),(0,e.jsx)(n.Z,{lang:"bash",children:t.texts[75].value}),(0,e.jsxs)("p",{children:[t.texts[76].value,(0,e.jsx)("code",{children:t.texts[77].value}),t.texts[78].value,(0,e.jsx)(o.rU,{to:"/welcome/getting-started/plugin",children:t.texts[79].value}),t.texts[80].value]})]})})})})}s.default=u},199098:function(l,s,a){a.r(s),a.d(s,{texts:function(){return d}});const d=[{value:"In many situations, we need to store data in a global context so that it can be accessed anywhere, such as themes, permissions, and more.",paraId:0,tocIndex:0},{value:"We need to implement a feature toggle plugin to control the activation or deactivation of certain functions.",paraId:1,tocIndex:1},{value:"The full sample code for this document can be viewed in the ",paraId:2,tocIndex:1},{value:"plugin-samples",paraId:2,tocIndex:1},{value:" repository.",paraId:2,tocIndex:1},{value:"Following the instructions in ",paraId:3,tocIndex:2},{value:"Writing Your First Plugin",paraId:4,tocIndex:2},{value:", if you don\u2019t already have a project, you can create one. If you already have a project or have cloned the source code, you can skip this step.",paraId:3,tocIndex:2},{value:`yarn create nocobase-app my-nocobase-app -d postgres
cd my-nocobase-app
yarn install
yarn nocobase install
`,paraId:5,tocIndex:2},{value:"Next, initialize a plugin and add it to the system:",paraId:6,tocIndex:2},{value:`yarn pm create @nocobase-sample/plugin-provider-context
yarn pm enable @nocobase-sample/plugin-provider-context
`,paraId:7,tocIndex:2},{value:"Then, start the project:",paraId:8,tocIndex:2},{value:`yarn dev
`,paraId:9,tocIndex:2},{value:"After logging in, you can visit ",paraId:10,tocIndex:2},{value:"http://localhost:13000/admin/pm/list/local/",paraId:10,tocIndex:2},{value:" to verify that the plugin has been installed and enabled.",paraId:10,tocIndex:2},{value:"The implementation of the global context requires utilizing React\u2019s ",paraId:11,tocIndex:3},{value:"Context",paraId:11,tocIndex:3},{value:" API.",paraId:11,tocIndex:3},{value:`import { useRequest } from '@nocobase/client';
import { Spin } from 'antd';
import React, { FC, createContext, ReactNode } from 'react';

const FeaturesContext = createContext<Record<string, boolean>>({});

const mockRequest = () => new Promise((resolve) => {
  resolve({ data: { feature1: true, feature2: false } })
})

export const FeaturesProvider: FC<{ children: ReactNode }> = ({ children }) => {
  const { loading, data } = useRequest<{ data: Record<string, boolean> }>(mockRequest);

  if (loading) return <Spin />;

  return <FeaturesContext.Provider value={data.data}>{children}</FeaturesContext.Provider>;
};

export const useFeatures = () => React.useContext(FeaturesContext);

export const useFeature = (feature: string) => {
  const features = useFeatures();
  return features[feature];
}
`,paraId:12,tocIndex:4},{value:"Don\u2019t forget to render the ",paraId:13,tocIndex:4},{value:"children",paraId:13,tocIndex:4},{value:" component.",paraId:13,tocIndex:4},{value:"For configuration and data related to ",paraId:14,tocIndex:4},{value:"features",paraId:14,tocIndex:4},{value:", refer to the ",paraId:14,tocIndex:4},{value:"Plugin Form Configuration Page",paraId:15,tocIndex:4},{value:" for example usage. In this case, we're using mock data.",paraId:14,tocIndex:4},{value:"Modify the ",paraId:16,tocIndex:5},{value:"packages/plugins/@nocobase-sample/plugin-provider-context/src/index.ts",paraId:16,tocIndex:5},{value:" file to register the ",paraId:16,tocIndex:5},{value:"FeaturesProvider",paraId:16,tocIndex:5},{value:" component into the system.",paraId:16,tocIndex:5},{value:`import { Plugin } from '@nocobase/client';
import { FeaturesProvider } from './FeaturesProvider';

export class PluginProviderContextClient extends Plugin {
  async load() {
    this.app.addProvider(FeaturesProvider)
  }
}

export default PluginProviderContextClient;
`,paraId:17,tocIndex:5},{value:"To access the context data, you can use the ",paraId:18,tocIndex:6},{value:"useFeatures",paraId:18,tocIndex:6},{value:" and ",paraId:18,tocIndex:6},{value:"useFeature",paraId:18,tocIndex:6},{value:" methods.",paraId:18,tocIndex:6},{value:"There are two cases: using it within this plugin or in other plugins.",paraId:19,tocIndex:6},{value:"Modify the ",paraId:20,tocIndex:7},{value:"packages/plugins/@nocobase-sample/plugin-provider-context/src/index.ts",paraId:20,tocIndex:7},{value:" file to add a test page for checking the context data.",paraId:20,tocIndex:7},{value:`import React from 'react';
import { Plugin } from '@nocobase/client';

import { FeaturesProvider, useFeature } from './FeaturesProvider';

const TestPage = () => {
  const feature1 = useFeature('feature1');
  const feature2 = useFeature('feature2');

  return (
    <div>
      <h1>Feature1: {feature1 ? 'Enabled' : 'Disabled'}</h1>
      <h1>Feature2: {feature2 ? 'Enabled' : 'Disabled'}</h1>
    </div>
  );
};

export class PluginProviderContextClient extends Plugin {
  async load() {
    this.app.addProvider(FeaturesProvider)

    this.app.router.add(\`admin.features-test\`, {
      path: '/admin/features-test',
      Component: TestPage,
    })
  }
}

export default PluginProviderContextClient;
`,paraId:21,tocIndex:7},{value:"Now, visit ",paraId:22,tocIndex:7},{value:"http://localhost:13000/admin/features-test",paraId:22,tocIndex:7},{value:" to see the context data.",paraId:22,tocIndex:7},{value:"If you need to use the context in other plugins, you should export the ",paraId:23,tocIndex:8},{value:"useFeatures",paraId:23,tocIndex:8},{value:" and ",paraId:23,tocIndex:8},{value:"useFeature",paraId:23,tocIndex:8},{value:" methods.",paraId:23,tocIndex:8},{value:"Modify the ",paraId:24,tocIndex:8},{value:"packages/plugins/@nocobase-sample/plugin-provider-context/src/index.ts",paraId:24,tocIndex:8},{value:" file:",paraId:24,tocIndex:8},{value:`export { useFeatures, useFeature } from './FeaturesProvider';
`,paraId:25,tocIndex:8},{value:"Then, you can use the ",paraId:26,tocIndex:8},{value:"useFeatures",paraId:26,tocIndex:8},{value:" and ",paraId:26,tocIndex:8},{value:"useFeature",paraId:26,tocIndex:8},{value:" methods as shown below:",paraId:26,tocIndex:8},{value:`import { useFeature } from '@nocobase-sample/plugin-provider-context/client';
`,paraId:27,tocIndex:8},{value:"Note that the import path should be ",paraId:28,tocIndex:8},{value:"'@nocobase-sample/plugin-provider-context/client'",paraId:28,tocIndex:8},{value:" rather than ",paraId:28,tocIndex:8},{value:"'@nocobase-sample/plugin-provider-context'",paraId:28,tocIndex:8},{value:".",paraId:28,tocIndex:8},{value:"Following the ",paraId:29,tocIndex:9},{value:"Build and Package Plugin",paraId:30,tocIndex:9},{value:" guide, you can package the plugin and upload it to the production environment.",paraId:29,tocIndex:9},{value:"If you cloned the source code, you\u2019ll need to perform a full build to include the plugin's dependencies.",paraId:31,tocIndex:9},{value:`yarn build
`,paraId:32,tocIndex:9},{value:"If the project was created using ",paraId:33,tocIndex:9},{value:"create-nocobase-app",paraId:33,tocIndex:9},{value:", simply run:",paraId:33,tocIndex:9},{value:`yarn build @nocobase-sample/plugin-provider-context --tar
`,paraId:34,tocIndex:9},{value:"This will generate the ",paraId:35,tocIndex:9},{value:"storage/tar/@nocobase-sample/plugin-provider-context.tar.gz",paraId:35,tocIndex:9},{value:" file, which can then be installed by following the ",paraId:35,tocIndex:9},{value:"upload process",paraId:36,tocIndex:9},{value:".",paraId:35,tocIndex:9}]}}]);
