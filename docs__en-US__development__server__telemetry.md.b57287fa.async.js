"use strict";(self.webpackChunknocobase_docs=self.webpackChunknocobase_docs||[]).push([[24515],{402593:function(l,a,n){n.r(a);var i=n(572269),u=n(793359),m=n(861788),r=n(719977),h=n(20190),s=n(24268),x=n(496057),p=n(585939),v=n(28484),j=n(635206),I=n(375553),E=n(156266),f=n(572333),P=n(841118),M=n(39297),g=n(868526),b=n(605019),o=n(614651),d=n(280936),_=n(667294),t=n(851843),e=n(785893);function c(){return(0,e.jsx)(o.dY,{children:(0,e.jsx)(_.Suspense,{fallback:(0,e.jsx)(d.Z,{}),children:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:"markdown",children:(0,e.jsxs)("h1",{id:"telemetry",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#telemetry",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"Telemetry"]})}),(0,e.jsx)(r.Z,{type:"warning",title:"Experimental"}),(0,e.jsx)("div",{className:"markdown",children:(0,e.jsxs)("p",{children:[t.texts[0].value,(0,e.jsx)("a",{href:"https://opentelemetry.io/",target:"_blank",children:t.texts[1].value}),t.texts[2].value]})}),(0,e.jsx)(r.Z,{type:"info",title:"Tip",children:(0,e.jsxs)("p",{children:[t.texts[3].value,(0,e.jsx)("code",{children:t.texts[4].value}),t.texts[5].value,(0,e.jsx)(o.rU,{to:"/welcome/getting-started/env#telemetry_enabled",children:t.texts[6].value}),t.texts[7].value]})}),(0,e.jsxs)("div",{className:"markdown",children:[(0,e.jsxs)("h2",{id:"instrumentation",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#instrumentation",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"Instrumentation"]}),(0,e.jsxs)("h3",{id:"metrics",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#metrics",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"Metrics"]}),(0,e.jsx)(s.Z,{lang:"ts",children:t.texts[8].value}),(0,e.jsx)("p",{children:t.texts[9].value}),(0,e.jsx)("ul",{children:(0,e.jsxs)("li",{children:[(0,e.jsx)("a",{href:"https://opentelemetry.io/docs/instrumentation/js/manual/#acquiring-a-meter",target:"_blank"}),(0,e.jsx)("a",{href:"https://opentelemetry.io/docs/instrumentation/js/manual/#acquiring-a-meter",children:t.texts[10].value})]})}),(0,e.jsxs)("h3",{id:"traces",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#traces",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"Traces"]}),(0,e.jsx)(s.Z,{lang:"ts",children:t.texts[11].value}),(0,e.jsx)("p",{children:t.texts[12].value}),(0,e.jsx)("ul",{children:(0,e.jsxs)("li",{children:[(0,e.jsx)("a",{href:"https://opentelemetry.io/docs/instrumentation/js/manual/#acquiring-a-tracer",target:"_blank"}),(0,e.jsx)("a",{href:"https://opentelemetry.io/docs/instrumentation/js/manual/#acquiring-a-tracer",children:t.texts[13].value})]})}),(0,e.jsxs)("h3",{id:"libraries",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#libraries",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"Libraries"]}),(0,e.jsx)(s.Z,{lang:"ts",children:t.texts[14].value})]}),(0,e.jsx)(r.Z,{type:"warning",children:(0,e.jsxs)("p",{children:[t.texts[15].value,(0,e.jsx)("code",{children:t.texts[16].value}),t.texts[17].value,(0,e.jsx)(o.rU,{to:"/development/life-cycle",children:t.texts[18].value}),t.texts[19].value,(0,e.jsx)("br",{}),t.texts[20].value,(0,e.jsx)("a",{href:"https://www.npmjs.com/package/@opentelemetry/instrumentation-koa",target:"_blank",children:t.texts[21].value}),t.texts[22].value,(0,e.jsx)("code",{children:t.texts[23].value}),t.texts[24].value,(0,e.jsx)("code",{children:t.texts[25].value}),t.texts[26].value,(0,e.jsx)("code",{children:t.texts[27].value}),t.texts[28].value,(0,e.jsx)("code",{children:t.texts[29].value}),t.texts[30].value]})}),(0,e.jsxs)("div",{className:"markdown",children:[(0,e.jsx)("p",{children:t.texts[31].value}),(0,e.jsx)("ul",{children:(0,e.jsxs)("li",{children:[(0,e.jsx)("a",{href:"https://opentelemetry.io/docs/instrumentation/js/libraries/",target:"_blank"}),(0,e.jsx)("a",{href:"https://opentelemetry.io/docs/instrumentation/js/libraries/",children:t.texts[32].value})]})}),(0,e.jsxs)("h2",{id:"collection",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#collection",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"Collection"]}),(0,e.jsxs)("h3",{id:"metrics-1",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#metrics-1",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"Metrics"]}),(0,e.jsx)(s.Z,{lang:"ts",children:t.texts[33].value}),(0,e.jsxs)("h3",{id:"traces-1",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#traces-1",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"Traces"]}),(0,e.jsx)(s.Z,{lang:"ts",children:t.texts[34].value}),(0,e.jsx)("p",{children:t.texts[35].value}),(0,e.jsx)("ul",{children:(0,e.jsxs)("li",{children:[(0,e.jsx)("a",{href:"https://opentelemetry.io/docs/instrumentation/js/exporters",target:"_blank"}),(0,e.jsx)("a",{href:"https://opentelemetry.io/docs/instrumentation/js/exporters",children:t.texts[36].value})]})})]})]})})})}a.default=c},851843:function(l,a,n){n.r(a),n.d(a,{texts:function(){return i}});const i=[{value:"The telemetry module of NocoBase is encapsulated based on ",paraId:0},{value:"OpenTelemetry",paraId:0},{value:". This article introduces how to use the telemetry module to collect Trace and Metric data to enhance the observability of the NocoBase system.",paraId:0},{value:"NocoBase needs to be configured with the environment variable ",paraId:1},{value:"TELEMETRY_ENABLED=true",paraId:1},{value:" before starting to enable telemetry data collection. See other configurations: ",paraId:1},{value:"Environment Variables - Telemetry",paraId:2},{value:".",paraId:1},{value:`const meter = app.telemetry.metric.getMeter();
const counter = meter.createCounter('event_counter', {});
counter.add(1);
`,paraId:3,tocIndex:2},{value:"References:",paraId:4,tocIndex:2},{value:"https://opentelemetry.io/docs/instrumentation/js/manual/#acquiring-a-meter",paraId:5,tocIndex:2},{value:`const tracer = app.telemetry.trace.getTracer();
tracer.startActiveSpan();
tracer.startSpan();
`,paraId:6,tocIndex:3},{value:"References:",paraId:7,tocIndex:3},{value:"https://opentelemetry.io/docs/instrumentation/js/manual/#acquiring-a-tracer",paraId:8,tocIndex:3},{value:`import { Plugin } from '@nocobase/server';
import { getNodeAutoInstrumentations } from '@opentelemetry/auto-instrumentations-node';

class InstrumentationPlugin extends Plugin {
  afterAdd() {
    this.app.on('beforeLoad', (app) => {
      app.telemetry.addInstrumentation(getNodeAutoInstrumentations());
    });
  }
}
`,paraId:9,tocIndex:4},{value:"In NocoBase, the initialization location of the telemetry module is ",paraId:10},{value:"app.beforeLoad",paraId:10},{value:", refer to: ",paraId:10},{value:"Lifecycle",paraId:11},{value:". Therefore, not all instrumentation libraries are suitable for NocoBase.",paraId:10},{value:`
For example, `,paraId:10},{value:"instrumentation-koa",paraId:10},{value:" needs to be introduced before ",paraId:10},{value:"Koa",paraId:10},{value:" is instantiated, but although NocoBase's ",paraId:10},{value:"Application",paraId:10},{value:" is based on ",paraId:10},{value:"Koa",paraId:10},{value:", the telemetry module is initialized after the ",paraId:10},{value:"Application",paraId:10},{value:" is instantiated, so it cannot be applied.",paraId:10},{value:"References:",paraId:12},{value:"https://opentelemetry.io/docs/instrumentation/js/libraries/",paraId:13},{value:`import { Plugin } from '@nocobase/server';
import {
  PeriodicExportingMetricReader,
  ConsoleMetricExporter,
} from '@opentelemetry/sdk-metrics';

class MetricReaderPlugin extends Plugin {
  afterAdd() {
    this.app.on('beforeLoad', (app) => {
      app.telemetry.metric.registerReader(
        'console',
        () =>
          new PeriodicExportingMetricReader({
            exporter: new ConsoleMetricExporter(),
          }),
      );
    });
  }
}
`,paraId:14,tocIndex:6},{value:`import { Plugin } from '@nocobase/server';
import {
  BatchSpanProcessor,
  ConsoleSpanExporter,
} from '@opentelemetry/sdk-trace-base';

class TraceSpanProcessorPlugin extends Plugin {
  afterAdd() {
    this.app.on('beforeLoad', (app) => {
      app.telemetry.trace.registerProcessor(
        'console',
        () => new BatchSpanProcessor(new ConsoleSpanExporter()),
      );
    });
  }
}
`,paraId:15,tocIndex:7},{value:"References:",paraId:16,tocIndex:7},{value:"https://opentelemetry.io/docs/instrumentation/js/exporters",paraId:17,tocIndex:7}]}}]);
