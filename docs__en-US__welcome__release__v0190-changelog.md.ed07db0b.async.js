"use strict";(self.webpackChunknocobase_docs=self.webpackChunknocobase_docs||[]).push([[12102],{156812:function(i,o,a){a.r(o);var s=a(572269),u=a(793359),x=a(861788),p=a(719977),h=a(20190),t=a(24268),_=a(496057),m=a(585939),v=a(28484),I=a(635206),g=a(375553),j=a(156266),f=a(572333),b=a(841118),E=a(39297),y=a(868526),P=a(605019),d=a(614651),l=a(280936),r=a(667294),n=a(918511),e=a(785893);function c(){return(0,e.jsx)(d.dY,{children:(0,e.jsx)(r.Suspense,{fallback:(0,e.jsx)(l.Z,{}),children:(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)("div",{className:"markdown",children:[(0,e.jsxs)("h1",{id:"v0192024-01-08",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#v0192024-01-08",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"v0.19\uFF1A2024-01-08"]}),(0,e.jsxs)("h2",{id:"new-features",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#new-features",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"New features"]}),(0,e.jsxs)("h3",{id:"telemetry",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#telemetry",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"Telemetry"]}),(0,e.jsxs)("ul",{children:[(0,e.jsxs)("li",{children:[n.texts[0].value,(0,e.jsx)("a",{href:"https://docs.nocobase.com/development/server/telemetry",children:n.texts[1].value})]}),(0,e.jsxs)("li",{children:[n.texts[2].value,(0,e.jsx)("a",{href:"https://docs.nocobase.com/api/telemetry/telemetry",children:n.texts[3].value})]}),(0,e.jsxs)("li",{children:[n.texts[4].value,(0,e.jsx)("a",{href:"https://docs.nocobase.com/plugins/telemetry-prometheus",children:n.texts[5].value})]})]}),(0,e.jsxs)("h3",{id:"application-backup-and-restore",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#application-backup-and-restore",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"Application backup and restore"]}),(0,e.jsx)("ul",{children:(0,e.jsxs)("li",{children:[n.texts[6].value,(0,e.jsx)("a",{href:"https://docs.nocobase.com/plugins/backup-restore",children:n.texts[7].value})]})}),(0,e.jsxs)("h2",{id:"kernel-optimizations",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#kernel-optimizations",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"Kernel optimizations"]}),(0,e.jsxs)("h3",{id:"command-line-optimizations",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#command-line-optimizations",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"Command line optimizations"]}),(0,e.jsxs)("p",{children:[n.texts[8].value,(0,e.jsx)("code",{children:n.texts[9].value}),n.texts[10].value]}),(0,e.jsx)(t.Z,{lang:"typescript",children:n.texts[11].value}),(0,e.jsx)("p",{children:n.texts[12].value}),(0,e.jsx)("p",{children:(0,e.jsx)("img",{src:"https://static-docs.nocobase.com/20240115141900.png",alt:"20240115141900"})}),(0,e.jsx)("p",{children:n.texts[13].value}),(0,e.jsxs)("ul",{children:[(0,e.jsxs)("li",{children:[(0,e.jsx)("code",{children:n.texts[14].value}),n.texts[15].value]}),(0,e.jsxs)("li",{children:[(0,e.jsx)("code",{children:n.texts[16].value}),n.texts[17].value]}),(0,e.jsxs)("li",{children:[(0,e.jsx)("code",{children:n.texts[18].value}),n.texts[19].value]})]}),(0,e.jsx)("p",{children:n.texts[20].value}),(0,e.jsx)(t.Z,{lang:"typescript",children:n.texts[21].value}),(0,e.jsxs)("h3",{id:"installation-process-optimization",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#installation-process-optimization",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"Installation process optimization"]}),(0,e.jsx)("p",{children:(0,e.jsx)("img",{src:"https://static-docs.nocobase.com/20240115141914.png",alt:"20240115141914"})}),(0,e.jsxs)("h3",{id:"startup-process-optimization",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#startup-process-optimization",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"Startup process optimization"]}),(0,e.jsx)("p",{children:(0,e.jsx)("img",{src:"https://static-docs.nocobase.com/20240115141922.png",alt:"20240115141922"})}),(0,e.jsxs)("h3",{id:"upgrade-process-optimization",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#upgrade-process-optimization",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"Upgrade process optimization"]}),(0,e.jsx)("p",{children:(0,e.jsx)("img",{src:"https://static-docs.nocobase.com/20240115141933.png",alt:"20240115141933"})}),(0,e.jsx)("p",{children:n.texts[22].value}),(0,e.jsxs)("ul",{children:[(0,e.jsxs)("li",{children:[(0,e.jsx)("p",{children:n.texts[23].value}),(0,e.jsxs)("ul",{children:[(0,e.jsx)("li",{children:n.texts[24].value}),(0,e.jsx)("li",{children:n.texts[25].value}),(0,e.jsx)("li",{children:n.texts[26].value})]})]}),(0,e.jsxs)("li",{children:[(0,e.jsx)("p",{children:n.texts[27].value}),(0,e.jsxs)("ul",{children:[(0,e.jsx)("li",{children:n.texts[28].value}),(0,e.jsx)("li",{children:n.texts[29].value}),(0,e.jsx)("li",{children:n.texts[30].value})]})]}),(0,e.jsx)("li",{children:(0,e.jsx)("p",{children:n.texts[31].value})})]}),(0,e.jsx)(t.Z,{lang:"typescript",children:n.texts[32].value}),(0,e.jsxs)("h3",{id:"add-the-create-migration-command",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#add-the-create-migration-command",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"Add the create-migration command"]}),(0,e.jsx)("p",{children:n.texts[33].value}),(0,e.jsx)(t.Z,{lang:"bash",children:n.texts[34].value}),(0,e.jsx)("p",{children:n.texts[35].value}),(0,e.jsx)(t.Z,{lang:"bash",children:n.texts[36].value}),(0,e.jsxs)("p",{children:[n.texts[37].value,(0,e.jsx)("code",{children:n.texts[38].value}),n.texts[39].value,(0,e.jsx)("code",{children:n.texts[40].value}),n.texts[41].value,(0,e.jsx)("code",{children:n.texts[42].value}),n.texts[43].value]}),(0,e.jsx)(t.Z,{lang:"typescript",children:n.texts[44].value}),(0,e.jsxs)("h3",{id:"the-plugins-convention-based-directories",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#the-plugins-convention-based-directories",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"The plugin's convention-based directories"]}),(0,e.jsx)(t.Z,{lang:"bash",children:n.texts[45].value}),(0,e.jsx)("p",{children:n.texts[46].value}),(0,e.jsxs)("p",{children:[n.texts[47].value,(0,e.jsx)("code",{children:n.texts[48].value}),n.texts[49].value,(0,e.jsx)("code",{children:n.texts[50].value}),n.texts[51].value]}),(0,e.jsxs)("ul",{children:[(0,e.jsxs)("li",{children:[(0,e.jsx)("code",{children:n.texts[52].value}),n.texts[53].value]}),(0,e.jsxs)("li",{children:[(0,e.jsx)("code",{children:n.texts[54].value}),n.texts[55].value]})]}),(0,e.jsx)(t.Z,{lang:"typescript",children:n.texts[56].value}),(0,e.jsxs)("h2",{id:"breaking-changes",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#breaking-changes",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"Breaking changes"]}),(0,e.jsxs)("h3",{id:"collections-commands-migrations-configuration-changes-to-convention-based-directories",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#collections-commands-migrations-configuration-changes-to-convention-based-directories",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"Collections, commands, migrations configuration changes to convention-based directories"]}),(0,e.jsxs)("p",{children:[n.texts[57].value,(0,e.jsx)("code",{children:n.texts[58].value}),n.texts[59].value]}),(0,e.jsx)(t.Z,{lang:"diff",children:n.texts[60].value}),(0,e.jsxs)("p",{children:[n.texts[61].value,(0,e.jsx)("code",{children:n.texts[62].value}),n.texts[63].value]}),(0,e.jsx)(t.Z,{lang:"diff",children:n.texts[64].value}),(0,e.jsxs)("p",{children:[n.texts[65].value,(0,e.jsx)("code",{children:n.texts[66].value}),n.texts[67].value]}),(0,e.jsx)(t.Z,{lang:"diff",children:n.texts[68].value}),(0,e.jsxs)("p",{children:[n.texts[69].value,(0,e.jsx)("code",{children:n.texts[70].value}),n.texts[71].value]}),(0,e.jsx)(t.Z,{lang:"typescript",children:n.texts[72].value}),(0,e.jsxs)("p",{children:[n.texts[73].value,(0,e.jsx)("code",{children:n.texts[74].value}),n.texts[75].value]}),(0,e.jsx)(t.Z,{lang:"diff",children:n.texts[76].value}),(0,e.jsx)("p",{children:n.texts[77].value}),(0,e.jsx)(t.Z,{lang:"diff",children:n.texts[78].value}),(0,e.jsxs)("p",{children:[n.texts[79].value,(0,e.jsx)("code",{children:n.texts[80].value}),n.texts[81].value]}),(0,e.jsx)(t.Z,{lang:"typescript",children:n.texts[82].value})]})})})})}o.default=c},918511:function(i,o,a){a.r(o),a.d(o,{texts:function(){return s}});const s=[{value:"Development documentation: ",paraId:0,tocIndex:2},{value:"https://docs.nocobase.com/development/server/telemetry",paraId:0,tocIndex:2},{value:"Kernel API: ",paraId:0,tocIndex:2},{value:"https://docs.nocobase.com/api/telemetry/telemetry",paraId:0,tocIndex:2},{value:"Prometheus plugin: ",paraId:0,tocIndex:2},{value:"https://docs.nocobase.com/plugins/telemetry-prometheus",paraId:0,tocIndex:2},{value:"Plugin documentation: ",paraId:1,tocIndex:3},{value:"https://docs.nocobase.com/plugins/backup-restore",paraId:1,tocIndex:3},{value:"For NocoBase 0.19 and above, plugin customized commands must be placed in the plugin's ",paraId:2,tocIndex:5},{value:"src/server/commands/*.ts",paraId:2,tocIndex:5},{value:" directory with the following contents:",paraId:2,tocIndex:5},{value:`export default function(app) {
  app.command('custom1').action();
}
`,paraId:3,tocIndex:5},{value:"The execution flow of the command line:",paraId:4,tocIndex:5},{value:"Special configuration of Command",paraId:5,tocIndex:5},{value:"ipc()",paraId:6,tocIndex:5},{value:" When the app is running, the command line sends commands via ipc to operate the running app instance, when ipc() is not configured, a new app instance will be created and then the operation will be executed (it will not interfere with the running app instance)",paraId:6,tocIndex:5},{value:"auth()",paraId:6,tocIndex:5},{value:" performs database verification, if the database configuration is incorrect, this command will not be executed.",paraId:6,tocIndex:5},{value:"preload()",paraId:6,tocIndex:5},{value:" whether to preload the application configuration, that is, execute app.load()",paraId:6,tocIndex:5},{value:"This can be configured according to the actual usage of the command, examples are as follows:",paraId:7,tocIndex:5},{value:`app.command('a').ipc().action()
app.command('a').auth().action()
app.command('a').preload().action()
`,paraId:8,tocIndex:5},{value:"The upgrade migrations are categorized into beforeLoad, afterSync, and afterLoad:",paraId:9,tocIndex:8},{value:"beforeLoad: Executed before the loading of each module, divided into three stages:",paraId:10,tocIndex:8},{value:"Before loading kernel modules",paraId:11,tocIndex:8},{value:"Before loading preset plugins",paraId:11,tocIndex:8},{value:"Before loading other plugins",paraId:11,tocIndex:8},{value:"afterSync: Executed after the synchronization of data table configurations with the database, divided into three stages:",paraId:12,tocIndex:8},{value:"After synchronizing kernel tables with the database",paraId:13,tocIndex:8},{value:"After synchronizing preset plugin tables with the database",paraId:13,tocIndex:8},{value:"After synchronizing other plugin tables with the database",paraId:13,tocIndex:8},{value:"afterLoad: Executed only after the complete loading of the application.",paraId:14,tocIndex:8},{value:`export default class extends Migration {
  // When to perform the migration
  on = 'beforeLoad';
  // Execute only when the following app version number is met.
  appVersion = '<=0.13.0-alpha.5';
  // Execute only when the following plugin version number is met.
  pluginVersion = '<=0.13.0-alpha.5';
  // Upgrade script.
  async up() {}
}
`,paraId:15,tocIndex:8},{value:"Creates a migration file",paraId:16,tocIndex:9},{value:`yarn nocobase create-migration -h

Usage: nocobase create-migration [options] <name>

Options:
  --pkg <pkg>  package name
  --on [on]    Options include beforeLoad, afterSync and afterLoad
  -h, --help   display help for command
`,paraId:17,tocIndex:9},{value:"Example",paraId:18,tocIndex:9},{value:`$ yarn nocobase create-migration update-ui --pkg=@nocobase/plugin-client

2024-01-07 17:33:13 [info ] add app main into supervisor     
2024-01-07 17:33:13 [info ] migration file in /nocobase/packages/plugins/@nocobase/plugin-client/src/server/migrations/20240107173313-update-ui.ts
\u2728  Done in 5.02s.
`,paraId:19,tocIndex:9},{value:"A migration file will be generated in ",paraId:20,tocIndex:9},{value:"src/server/migrations",paraId:20,tocIndex:9},{value:" of the plugin package ",paraId:20,tocIndex:9},{value:"@nocobase/plugin-client",paraId:20,tocIndex:9},{value:" as ",paraId:20,tocIndex:9},{value:"20240107173313-update-ui.ts",paraId:20,tocIndex:9},{value:" with the following initial contents:",paraId:20,tocIndex:9},{value:`import { Migration } from '@nocobase/server';

export default class extends Migration {
  on = 'afterLoad'; // 'beforeLoad' | 'afterSync' | 'afterLoad'
  appVersion = '<0.18.0-alpha.10';

  async up() {
    // coding
  }
}
`,paraId:21,tocIndex:9},{value:`|- /plugin-sample-hello
  |- /dist             # Directory for compiled plugin
  |- /src              # Source code for the plugin
    |- /client
      |- plugin.ts
      |- index.ts      # Client-side entry point
    |- /locale         # Conventional directory for shared multilingual files between frontend and backend
    |- /swagger        # Conventional directory for Swagger documentation
    |- /server
      |- collections   # Conventional directory for plugin's data table configurations
      |- commands      # Conventional directory for custom commands
      |- migrations    # Conventional directory for migration files
      |- plugin.ts     # Plugin class
      |- index.ts      # Server-side entry point
    |- index.ts
  |- .npmignore
  |- client.d.ts
  |- client.js
  |- package.json
  |- server.d.ts
  |- server.js
`,paraId:22,tocIndex:10},{value:"Testing process optimization",paraId:23,tocIndex:10},{value:"Provided more user-friendly ",paraId:24,tocIndex:10},{value:"createMockServer()",paraId:24,tocIndex:10},{value:" and ",paraId:24,tocIndex:10},{value:"startMockServer()",paraId:24,tocIndex:10},{value:" methods for writing test cases:",paraId:24,tocIndex:10},{value:"createMockServer()",paraId:25,tocIndex:10},{value:" Quickly creates and starts an application.",paraId:25,tocIndex:10},{value:"startMockServer()",paraId:25,tocIndex:10},{value:" Quickly starts an application (without reinstalling).",paraId:25,tocIndex:10},{value:`import { createMockServer } from '@nocobase/server';

describe('test example', () => {
  let app: MockServer;

  beforeEach(async () => {
    app = await createMockServer({
      plugins: ['nocobase'],
    });
  });

  afterEach(async () => {
    await app.destroy();
  });

  test('case1', async () => {
    // coding...
  });
});
`,paraId:26,tocIndex:10},{value:"Example 1: Collections loaded by importCollections, the code is deleted directly, and the collections configuration file must be placed in the ",paraId:27,tocIndex:12},{value:"src/server/collections",paraId:27,tocIndex:12},{value:" directory.",paraId:27,tocIndex:12},{value:`export class AuthPlugin extends Plugin {
  async load() {
-   await this.importCollections(resolve(__dirname, 'collections'));
  }
}
`,paraId:28,tocIndex:12},{value:"Example 2: Collections loaded through this.db.import, the code is directly deleted, the collections configuration file must be placed in the ",paraId:29,tocIndex:12},{value:"src/server/collections",paraId:29,tocIndex:12},{value:" directory",paraId:29,tocIndex:12},{value:`export class AuthPlugin extends Plugin {
  async load() {
-   await this.db.import({
-     directory: resolve(__dirname, 'collections')
-   });
  }
}
`,paraId:30,tocIndex:12},{value:"Example 3: A collection defined by db.collection() is recommended to be placed in the ",paraId:31,tocIndex:12},{value:"src/server/collections",paraId:31,tocIndex:12},{value:" directory.",paraId:31,tocIndex:12},{value:`export class AuthPlugin extends Plugin {
  async load() {
-   this.db.collection({
-     name: 'examples',
-   });
  }
}
`,paraId:32,tocIndex:12},{value:"Add a new ",paraId:33,tocIndex:12},{value:"src/server/collections/examples.ts",paraId:33,tocIndex:12},{value:" file with the following contents:",paraId:33,tocIndex:12},{value:`import { defineCollection } from '@nocobase/database';

export default defineCollection({
  name: 'examples',
});
`,paraId:34,tocIndex:12},{value:"Example 4: Remove db.addMigrations() and place the migration file in the ",paraId:35,tocIndex:12},{value:"src/server/migrations",paraId:35,tocIndex:12},{value:" directory.",paraId:35,tocIndex:12},{value:`export class AuthPlugin extends Plugin {
  async load() {
-   this.db.addMigrations({
-     namespace: 'auth',
-     directory: resolve(__dirname, 'migrations'),
-     context: {
-       plugin: this,
-     },
-   });
  }
}
`,paraId:36,tocIndex:12},{value:"Example 5: Customizing the command line",paraId:37,tocIndex:12},{value:`export class MyPlugin extends Plugin {
  load() {
-   this.app
-      .command('echo')
-      .option('-v, --version');
-      .action(async ([options]) => {
-        console.log('Hello World!');
-        if (options.version) {
-          console.log('Current version:', app.getVersion());
-        }
-      });
-  }
}
`,paraId:38,tocIndex:12},{value:"Add a new ",paraId:39,tocIndex:12},{value:"src/server/collections/echo.ts",paraId:39,tocIndex:12},{value:" file with the following contents:",paraId:39,tocIndex:12},{value:`export default function(app) {
  app
    .command('echo')
    .option('-v, --version');
    .action(async ([options]) => {
      console.log('Hello World!');
      if (options.version) {
        console.log('Current version:', await app.version.get());
      }
    });
}
`,paraId:40,tocIndex:12}]}}]);
